{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/「クロージャは関数と環境のペア」とは？（JavaScript）/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://sititou70.github.io"}},"markdownRemark":{"excerpt":"本記事はRecruit Engineers Advent Calendar 2023のxx日目です． はじめに クロージャは「関数と環境のペア」と説明されます。 クロージャ（クロージャー、英語: closure…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 651px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/566007376866e5cae189b6c99d0e61f1/dfb18/top.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.20890937019969%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'257\\'%20viewBox=\\'0%200%20400%20257\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M74%2091l-1%2032a239%20239%200%2001-32-11l-1%205v5H0v5h40v10l32-12c2%200%202%202%202%2032l1%2032h60v68h6v-68h61l1-2V61l-65-1H74v31m130-30v65l1%2063h128v-62h67v-5h-66l-1-31V61l-64-1-65%201M77%20125v61h123V63H77v62m130%200v61h123V63H207v62m-80%201v17h3c2%200%202%200%202-7v-7h10c8%200%209%200%209-2s-1-2-9-2h-10v-12h10c8%200%2010-1%2010-2%200-2-1-2-12-2h-13v17m128%200v17h14c13%200%2014%200%2014-2s-1-2-12-2h-11v-6l1-5%2010-1c9%200%2010%200%2010-2%200-1-2-2-11-2h-10v-10h11c10%200%2011%200%2011-2s-1-2-13-2h-14v17\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/566007376866e5cae189b6c99d0e61f1/737bd/top.webp 651w\"\n              sizes=\"(max-width: 651px) 100vw, 651px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/566007376866e5cae189b6c99d0e61f1/dfb18/top.png 651w\"\n            sizes=\"(max-width: 651px) 100vw, 651px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/566007376866e5cae189b6c99d0e61f1/dfb18/top.png\"\n            alt=\"クロージャを表す画像。2つの正方形が左右にペアになっており、左の正方形の中にはF、右の正方形の中にはEと書かれている。\"\n            title=\"クロージャを表す画像。2つの正方形が左右にペアになっており、左の正方形の中にはF、右の正方形の中にはEと書かれている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>本記事は<a href=\"https://adventar.org/\">Recruit Engineers Advent Calendar 2023</a>のxx日目です．</p>\n<h2 id=\"はじめに\" style=\"position:relative;\"><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\" aria-label=\"はじめに permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>はじめに</h2>\n<p>クロージャは「関数と環境のペア」と説明されます。</p>\n<blockquote>\n<p>クロージャ（クロージャー、英語: closure）、関数閉包はプログラミング言語における関数オブジェクトの一種。……（中略）…… <strong>関数とそれを評価する環境のペア</strong> であるともいえる。</p>\n<p>出典：<a href=\"https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%B8%E3%83%A3\">クロージャ - Wikipedia</a>、強調と中略は筆者による</p>\n</blockquote>\n<blockquote>\n<p>クロージャは、組み合わされた（囲まれた） <strong>関数と、その周囲の状態（レキシカル環境）への参照の組み合わせ</strong> です。</p>\n<p>出典：<a href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Closures\">クロージャ - JavaScript | MDN</a>、強調は筆者による</p>\n</blockquote>\n<p>本記事は、これらの説明を理解するために調べたことのまとめです。</p>\n<h2 id=\"サンプルプログラム\" style=\"position:relative;\"><a href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\" aria-label=\"サンプルプログラム permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>サンプルプログラム</h2>\n<p>説明のために以下のプログラムを使用します。クロージャの説明で定番のやつですね。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeCounter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> cnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    cnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> counter1 <span class=\"token operator\">=</span> <span class=\"token function\">makeCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> counter2 <span class=\"token operator\">=</span> <span class=\"token function\">makeCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">counter1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">counter2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">counter1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span></code></pre></div>\n<h2 id=\"sicpでの説明\" style=\"position:relative;\"><a href=\"#sicp%E3%81%A7%E3%81%AE%E8%AA%AC%E6%98%8E\" aria-label=\"sicpでの説明 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SICPでの説明</h2>\n<p><a href=\"https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-4.html\">SICP（計算機プログラムの構造と解釈：Structure and Interpretation of Computer Programs）</a>は、計算機科学の古典であり、MITのプログラミング入門講義で教科書として使用されていた本です。</p>\n<p>SICPにおける説明がわかりやすいので紹介します。この本で使用されている言語はSchemeですが、JavaScriptに置き換えて説明します。また、本記事の後半の説明に合わせて、一部の用語を言い換えています。</p>\n<h3 id=\"step-1グローバル環境の作成\" style=\"position:relative;\"><a href=\"#step-1%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"step 1グローバル環境の作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 1：グローバル環境の作成</h3>\n<p>プログラムを実行するにあたって、次のようなグローバル環境が作成されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b29f7275107ff6f852042ae9aead24b7/3a76f/env1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.3076923076923%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'433\\'%20viewBox=\\'0%200%20400%20433\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M179%2028l-7%208%207%208%206%207-6%206-7%208c0%202%2012%2014%2014%2014l8-6%206-7%208%207%207%207%208-7%207-8-7-7-7-7%207-8%207-7-7-8-8-7-7%207-7%207-7-7-8-7-7%207m21%2056a331%20331%200%2001-9%2026h4l3%201v25h-63l-70%201c-16%202-30%2013-36%2028l-3%208-1%2093%201%2099c3%2019%2019%2035%2038%2038h274c17-3%2032-16%2036-34%203-8%203-190%201-198-5-18-20-32-38-34l-71-1h-63v-26h4l3-1-10-25M62%20140c-16%203-30%2017-33%2033l-1%20101%201%2096%203%206c5%2012%2016%2021%2029%2024%2010%202%20270%202%20280-1%2014-3%2026-14%2031-28%202-7%202-194%200-202-2-7-9-16-16-21-12-9%201-8-152-9l-142%201m30%2027l-1%2014c0%2013%200%2014%202%2014s2-1%202-14-1-17-3-14m29%200l-1%2014c0%2013%200%2014%202%2014l2-1h3c5%202%208%200%2010-5%203-10-3-18-11-14-2%201-2%201-2-3%200-5-1-6-3-5m42%2014c0%2013%200%2014%202%2014%202-1%203-27%201-28-3-2-3-1-3%2014m-95-12c-4%202-6%205-7%2011-1%2010%204%2016%2015%2015%208-1%2010-3%2010-9v-4h-6c-7%200-8%202-2%203%206%200%206%204%200%206-9%203-16-5-12-15%202-5%2010-6%2014-2%203%202%205%201%204-2-2-4-11-5-16-3m114%2013v13h11l10-1c0-2-2-2-8-2h-8l-1-5v-4h7c7%200%208%200%208-2s-1-2-7-2h-7v-7l7-1c6%200%208%200%208-2l-10-1h-10v14m-80-7c-4%203-5%2013-1%2018%203%203%209%203%2013%200%203-4%203-13%200-17-3-2-9-3-12-1m42%201l-2%203h4c1-3%206-2%207%200%201%203%201%203-4%203-5%201-8%203-8%207%200%205%208%208%2011%204h3l3%202c3%200%203-2%202-3-2%200-2-2-2-6%200-6-1-10-3-11-2-2-8-1-11%201m63%209c0%209%200%2010%202%2010s2-1%202-8c0-8%200-8%202-9%205-2%206-1%206%208%200%207%201%209%202%209%203%200%203-17%200-19-1-2-7-3-9-1h-1l-3-1-1%2011m19-10l3%2010c3%208%204%2010%206%2010s3-1%204-3l5-18c-2-1-4%201-6%208s-4%2010-4%207c0-5-4-15-6-15l-2%201m-122%203c-5%206%201%2018%207%2013%201-2%202-11%200-13h-7m22%200c-2%203-2%208-1%2011%202%204%207%204%208%200%202-8-3-16-7-11\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b29f7275107ff6f852042ae9aead24b7/2da83/env1.webp 325w\"\n              sizes=\"(max-width: 325px) 100vw, 325px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b29f7275107ff6f852042ae9aead24b7/3a76f/env1.png 325w\"\n            sizes=\"(max-width: 325px) 100vw, 325px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b29f7275107ff6f852042ae9aead24b7/3a76f/env1.png\"\n            alt=\"四角が1つある。四角の中にGlobal Envと書かれている。次に区切り線があり、その下は空欄である。四角から矢印が出ており、バツ印を指している。\"\n            title=\"四角が1つある。四角の中にGlobal Envと書かれている。次に区切り線があり、その下は空欄である。四角から矢印が出ており、バツ印を指している。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>環境とは、「束縛の集合」と「外側の環境への参照」のペアです。この環境には「Global Env」という名前がついており、区切り線の上に書かれています。</p>\n<p>束縛とは、「変数」と「値」のペアです。束縛の集合は区切り線の下に書かれます。現状は束縛はありません。</p>\n<p>矢印はグローバル環境の外側の環境を表します。グローバル環境に外側は無いため、バツ印を指しています。</p>\n<h3 id=\"step-2makecounter-の評価\" style=\"position:relative;\"><a href=\"#step-2makecounter-%E3%81%AE%E8%A9%95%E4%BE%A1\" aria-label=\"step 2makecounter の評価 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 2：<code class=\"language-text\">makeCounter</code> の評価</h3>\n<p>はじめに、グローバル環境で関数（アロー関数）を評価し、結果を <code class=\"language-text\">makeCounter</code> へ代入しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeCounter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> cnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    cnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>このプログラムを実行したあとは次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/27b1008138a65f466810678ed14d0f9c/ac011/env2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.79120879120879%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'135\\'%20viewBox=\\'0%200%20400%20135\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M56%209c-2%202-2%202-1%204%202%202%202%203%200%205-1%202-1%202%201%204s2%202%204%201c2-2%203-2%205%200%202%201%202%201%204-1s2-2%201-4l-2-2%202-3c1-2%201-2-1-4s-2-2-4-1c-2%202-3%202-5%201-2-2-2-2-4%200m152%2013v8h23l23-1h2a1831%201831%200%2000135%201c2%200%202-1%202-7v-8H208v7m-15-4l-22%201-21%201v21h-15v8c0%206%200%207-2%207-3-2-6-2-6-1l-5%201c-3%200-4%200-5-2l-1-2v2l-2%202h-3v27h-5l-6-1c-2-1-4%200-4%202s3%204%204%202l7-1h6V71c0-12%200-14%202-14l1%2030c0%2016%201%2023%201%2014%200-17%200-18%205-15h3l29-1h28V72h7l-8-1h-14V43l14-1h14v15l1%2015V41h-45V21h21l21%201c1%201%208-1%208-2l-2-1-4-2-2%201M61%2029v5l1%204v4H40c-12%200-2%201%2023%201%2024%200%2034-1%2022-1H63v-4l1-4v-5l-2-3-1%203m75%2028c0%208-1%2011-1%207%200-6%200-7-2-7-3%202-6%202-6%201l-5-1h-5v13c0%2014%200%2015%205%2012h3l28%201h27V72h-44l14-1h15V43l-15-1h-14v15\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/27b1008138a65f466810678ed14d0f9c/f4a91/env2.webp 728w,\n/static/27b1008138a65f466810678ed14d0f9c/e357c/env2.webp 1041w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/27b1008138a65f466810678ed14d0f9c/beb58/env2.png 728w,\n/static/27b1008138a65f466810678ed14d0f9c/ac011/env2.png 1041w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/27b1008138a65f466810678ed14d0f9c/beb58/env2.png\"\n            alt=\"先程の図のGlobal Envの区切り線の下にmakeCounterという項目が追加されている。makeCounterからは矢印が伸びて、正方形が2つくっついた物を指している。左の正方形の中にはFと書かれており、そこから矢印が伸びて「() =&gt; { let cnt = 0; ... }」というテキストを指している。右の正方形の中にはEと書かれていて、そこから矢印が伸びてGlobal Envの箱を指している。\"\n            title=\"先程の図のGlobal Envの区切り線の下にmakeCounterという項目が追加されている。makeCounterからは矢印が伸びて、正方形が2つくっついた物を指している。左の正方形の中にはFと書かれており、そこから矢印が伸びて「() =&gt; { let cnt = 0; ... }」というテキストを指している。右の正方形の中にはEと書かれていて、そこから矢印が伸びてGlobal Envの箱を指している。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>関数を評価するとクロージャができます。正方形の2つのペアがクロージャです。</p>\n<p>左のFと書かれた正方形は、関数本体への参照です。参照先が具体的に何なのかは言語の処理系によって異なりますが、例えばASTだったりバイトコードだったりします。</p>\n<p>右のEと書かれた正方形は、クロージャが作成されたときの環境への参照です。今回は関数をグローバル環境で評価したので、グローバル環境を指しています。</p>\n<p>評価結果であるクロージャをグローバル環境の <code class=\"language-text\">makeCounter</code> に代入します。グローバル環境に <code class=\"language-text\">makeCounter</code> とクロージャの束縛が追加されました。</p>\n<h3 id=\"step-3makecounter-の適用counter1-の定義\" style=\"position:relative;\"><a href=\"#step-3makecounter-%E3%81%AE%E9%81%A9%E7%94%A8counter1-%E3%81%AE%E5%AE%9A%E7%BE%A9\" aria-label=\"step 3makecounter の適用counter1 の定義 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3：<code class=\"language-text\">makeCounter</code> の適用（<code class=\"language-text\">counter1</code> の定義）</h3>\n<p>次に、グローバル環境で <code class=\"language-text\">makeCounter</code> を呼び出し（適用し）、その結果を <code class=\"language-text\">counter1</code> に代入しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> counter1 <span class=\"token operator\">=</span> <span class=\"token function\">makeCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>グローバル環境で <code class=\"language-text\">makeCounter</code> を評価すると、それがクロージャであるとわかります。したがって、<code class=\"language-text\">makeCounter()</code> はクロージャを呼び出しています。</p>\n<h4 id=\"step-31新しい環境の作成\" style=\"position:relative;\"><a href=\"#step-31%E6%96%B0%E3%81%97%E3%81%84%E7%92%B0%E5%A2%83%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"step 31新しい環境の作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.1：新しい環境の作成</h4>\n<p>クロージャが呼び出されると、クロージャの環境を外側の環境とする新しい環境が作成され、そこでクロージャの関数が評価されます。</p>\n<p>新しい環境が作成された結果は次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ae7e56a18aac1c15a57cc1224426487d/ac011/env3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.56043956043956%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'158\\'%20viewBox=\\'0%200%20400%20158\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M56%209c-2%202-2%202-1%204%202%202%202%203%200%205-1%202-1%202%201%204s2%202%204%201c2-2%203-2%205%200%202%201%202%201%204-1s2-2%201-4l-2-2%202-3c1-2%201-2-1-4s-2-2-4-1c-2%202-3%202-5%201-2-2-2-2-4%200m152%2013v8h23l23-1h2a1831%201831%200%2000135%201c2%200%202-1%202-7v-8H208v7m-15-4l-22%201-21%201-1%2010v11h-14v8c0%206%200%207-2%206h-6l-5%201c-3%200-4%200-5-2l-1-2v2l-2%202h-3v27h-5l-6-1c-2-1-4%200-4%202s3%204%204%202l7-1h6V71c0-12%200-14%202-14l1%2030c0%2016%201%2023%201%2014%200-17%200-18%205-15h3l79-1h79v3l1%203%201-4v-3l-52-1h-51V72h7l-8-1h-14V43l14-1h14v15l1%2015V41h-45V21h21l21%201c1%201%208-1%208-2l-2-1-4-2-2%201M61%2029v5l1%204v4H40c-12%200-2%201%2023%201%2024%200%2034-1%2022-1H63v-4l1-4v-5l-2-3-1%203m75%2028c0%208-1%2011-1%207%200-6%200-7-2-7-3%202-6%202-6%201l-5-1h-5v26h2l4-2%202%201%2028%201h27V72h-44l14-1h15V43l-15-1h-14v15\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ae7e56a18aac1c15a57cc1224426487d/f4a91/env3.webp 728w,\n/static/ae7e56a18aac1c15a57cc1224426487d/e357c/env3.webp 1041w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ae7e56a18aac1c15a57cc1224426487d/beb58/env3.png 728w,\n/static/ae7e56a18aac1c15a57cc1224426487d/ac011/env3.png 1041w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ae7e56a18aac1c15a57cc1224426487d/beb58/env3.png\"\n            alt=\"先程の図に加えて新たにEnv 1という環境が書かれている。Env 1の下に区切り線があり、その下に空白がある。Env 1の環境からは矢印が伸び、Global Envの環境を指している。\"\n            title=\"先程の図に加えて新たにEnv 1という環境が書かれている。Env 1の下に区切り線があり、その下に空白がある。Env 1の環境からは矢印が伸び、Global Envの環境を指している。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>「クロージャの環境」はグローバル環境を指しているため、それを外側の環境として指すEnv 1という環境が作成されました。</p>\n<p>これ以降は、Env 1でクロージャの関数を評価していくことになります。</p>\n<h4 id=\"step-32cnt-の定義\" style=\"position:relative;\"><a href=\"#step-32cnt-%E3%81%AE%E5%AE%9A%E7%BE%A9\" aria-label=\"step 32cnt の定義 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.2：<code class=\"language-text\">cnt</code> の定義</h4>\n<p>Env 1で、<code class=\"language-text\">makeCounter</code> の最初プログラムを評価します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> cnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>結果は次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c14c79392b37ee707a957f143c898b8c/ac011/env4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.56043956043956%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'158\\'%20viewBox=\\'0%200%20400%20158\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M56%209c-2%202-2%202-1%204%202%202%202%203%200%205-1%202-1%202%201%204s2%202%204%201c2-2%203-2%205%200%202%201%202%201%204-1s2-2%201-4l-2-2%202-3c1-2%201-2-1-4s-2-2-4-1c-2%202-3%202-5%201-2-2-2-2-4%200m152%2013v8h23l23-1h2a1831%201831%200%2000135%201c2%200%202-1%202-7v-8H208v7m-15-4l-22%201-21%201-1%2010v11h-14v8c0%206%200%207-2%206h-6l-5%201c-3%200-4%200-5-2l-1-2v2l-2%202h-3v27h-5l-6-1c-2-1-4%200-4%202s3%204%204%202l7-1h6V71c0-12%200-14%202-14l1%2030c0%2016%201%2023%201%2014%200-17%200-18%205-15h3l79-1h79v3l1%203%201-4v-3l-52-1h-51V72h7l-8-1h-14V43l14-1h14v15l1%2015V41h-45V21h21l21%201c1%201%208-1%208-2l-2-1-4-2-2%201M61%2029v5l1%204v4H40c-12%200-2%201%2023%201%2024%200%2034-1%2022-1H63v-4l1-4v-5l-2-3-1%203m75%2028c0%208-1%2011-1%207%200-6%200-7-2-7-3%202-6%202-6%201l-5-1h-5v26h2l4-2%202%201%2028%201h27V72h-44l14-1h15V43l-15-1h-14v15\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c14c79392b37ee707a957f143c898b8c/f4a91/env4.webp 728w,\n/static/c14c79392b37ee707a957f143c898b8c/e357c/env4.webp 1041w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c14c79392b37ee707a957f143c898b8c/beb58/env4.png 728w,\n/static/c14c79392b37ee707a957f143c898b8c/ac011/env4.png 1041w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c14c79392b37ee707a957f143c898b8c/beb58/env4.png\"\n            alt=\"先程の図に加えて、Env 1にcnt: 0という束縛が増えている。\"\n            title=\"先程の図に加えて、Env 1にcnt: 0という束縛が増えている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h4 id=\"step-33-counterの作成\" style=\"position:relative;\"><a href=\"#step-33-counter%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"step 33 counterの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 3.3: counterの作成</h4>\n<p><code class=\"language-text\">makeCounter</code> の最後プログラムでは、関数を評価し、結果を <code class=\"language-text\">return</code> して <code class=\"language-text\">counter1</code> に代入しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  cnt<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>関数を評価すると、クロージャができます。</p>\n<p>クロージャは、「関数本体への参照」と「クロージャが作成されたときの環境（ここではEnv 1）への参照」です。</p>\n<p>したがって、結果は次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21ef57976fe763356e150a728ce24518/ac011/env5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.87912087912088%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'184\\'%20viewBox=\\'0%200%20400%20184\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M55%209l-2%202%202%203%202%202-2%202-2%203%203%202%202%202%202-2%202-2%203%202c2%202%202%202%204%201%202-3%203-4%200-6v-4c3-2%202-3%200-6-2-1-2-1-4%201l-3%202-1-2c-3-3-3-2-6%200m153%2014v7h23l23-1h1l70%201h68V16H208v7m-15-4l-22%201-21%201-1%2010v11h-14v7c0%208%201%207-6%205l-2%201-5%201c-4%200-5%200-5-2l-1-2v2l-2%202h-3v28h-5l-5-1-2-1c-3%201-3%204%200%205l2-1%206-1h6V71c0-11%200-14%202-14l1%2021v21l-20-1H75c-2-3-5%200-4%202%200%202%204%203%205%201l20-1h20v9l1%209v-18h10l11%201v18h11l12%201c0%201%203%201%206-1%202%200%202%201%202%207l1%207v-15c0-9-1-12-1-7v7l-4-1c-3-2-3-2-4%200l-11%201h-11V99h-21l-1-7c0-8-1-7%206-5l2-1%2079-1h79v6h-10c-6%200-1%201%2011%201%2013%200%2017-1%2011-1h-10l-1-4v-3H182V72h14V42h-23l-15%201h7v28h-29V43h15V21h21l21%201h4c5-1%204-3-1-4l-3%201m-27%2038v14h29V43h-29v14m-48%201l-1%2026%204-2h4l28%201h27V72h-45V57l-4%202c-3%201-4%201-4-1%200-1-8-2-9%200m139%2050v10l-4-2c-4-1-4-1-4%201l-9%201h-9l-1-8v-7h-30c-17%200-24%201-16%201h15v15l1%2014%201-14v-15h28v15c0%208%201%2011%201%207v-7h10l9%201%202%201%204-2c2%200%202%200%202%2010a227%20227%200%20000-22m-41%2057v7h68a728%20728%200%200077%200h5v-14H216v7\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/21ef57976fe763356e150a728ce24518/f4a91/env5.webp 728w,\n/static/21ef57976fe763356e150a728ce24518/e357c/env5.webp 1041w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/21ef57976fe763356e150a728ce24518/beb58/env5.png 728w,\n/static/21ef57976fe763356e150a728ce24518/ac011/env5.png 1041w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/21ef57976fe763356e150a728ce24518/beb58/env5.png\"\n            alt=\"先程の図に加えて、Global Envにcounter1の束縛が増えている。counter1からはクロージャ（2つの正方形のペア）への矢印が伸びている。そのクロージャの関数（左の正方形）からは「() =&gt; { cnt++; ... };」というテキストへの矢印が、環境（右の正方形）からはEnv 1への矢印が伸びている。\"\n            title=\"先程の図に加えて、Global Envにcounter1の束縛が増えている。counter1からはクロージャ（2つの正方形のペア）への矢印が伸びている。そのクロージャの関数（左の正方形）からは「() =&gt; { cnt++; ... };」というテキストへの矢印が、環境（右の正方形）からはEnv 1への矢印が伸びている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"step-4makecounter-の適用counter2-の定義\" style=\"position:relative;\"><a href=\"#step-4makecounter-%E3%81%AE%E9%81%A9%E7%94%A8counter2-%E3%81%AE%E5%AE%9A%E7%BE%A9\" aria-label=\"step 4makecounter の適用counter2 の定義 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 4：<code class=\"language-text\">makeCounter</code> の適用（<code class=\"language-text\">counter2</code> の定義）</h3>\n<p>同様に <code class=\"language-text\">counter2</code> が定義されます。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> counter2 <span class=\"token operator\">=</span> <span class=\"token function\">makeCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上記のプログラム実行後は次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79b7f4cd3b890807c03e68359b4d5fb8/ac011/env6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.0989010989011%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'304\\'%20viewBox=\\'0%200%20400%20304\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M56%209c-2%202-2%202-1%204%202%202%202%203%200%205-1%202-1%202%201%204s2%202%204%201c2-2%203-2%205%200%202%201%202%201%204-1s2-2%201-4l-2-2%202-3c1-2%201-2-1-4s-2-2-4-1c-2%202-3%202-5%201-2-2-2-2-4%200m152%2013v8h23l23-1h2a1831%201831%200%2000135%201c2%200%202-1%202-7v-8H208v7m-15-4l-22%201-21%201v21h-15v8c0%206%200%207-2%206h-6l-5%201c-3%200-4%200-5-2l-1-2v2l-2%202h-3v27h-5l-6-1c-2-1-4%200-4%202s3%204%204%202l7-1h6V71c0-12%200-14%202-14l1%2021v20H96l-22-1h-3v4h3l22-1h20v8l1%209v-17h21v19h11l12%201h3c5-2%205-1%205%206v7h15v29h9l9%201c1%201%207-1%207-2l-3-2h-4l-8%201h-9v-27h45v-14h10l9%201%202%201c6-3%206-3%206%208%200%206%201%201%201-11s-1-17-1-11c0%2011%200%2011-6%208l-2%201-9%201h-10v-14h-61v7c0%208%200%208-6%205l-2%201-11%201h-11V98h-22v-6c0-7%201-8%205-6h3l79-1h79v3l1%203%201-4v-3l-52-1h-51V72h7l-8-1h-14V43l14-1h14v15l1%2015V41h-45V21h21l21%201c1%201%208-1%208-2l-2-1-4-2-2%201M61%2029v5l1%204v4H40c-12%200-2%201%2023%201%2024%200%2034-1%2022-1H63v-4l1-4v-5l-2-3-1%203m75%2028c0%208-1%2011-1%207%200-6%200-7-2-7-3%202-6%202-6%201l-5-1h-5v26h2l4-2%202%201%2028%201h27V72h-44l14-1h15V43l-15-1h-14v15m34%2061v14h29v-28h-29v14m31%200v14h28v-28h-28v14m-131-7l1%203%201%206v5H19l21%201c21%200%2022%200%2021%202v6l1%2035v34h10v19l1%2019h43a357%20357%200%200149%201l4-2v15h15v29h9l9%201c1%201%207-1%207-2l-3-2h-4l-8%201h-9v-27h45v-14h10l9%201%202%201c6-3%206-3%206%208%200%206%201%201%201-11s-1-17-1-11c0%2011%200%2011-6%208l-2%201-9%201h-10v-14h-61v7c0%208%200%208-6%205l-2%201-43%201H74v-36h209v5l1%205%201-5v-5l-106-1H74v-76h16l17-1H74v-5l1-7c1-3-4-4-5-2m-7%2017c2%203%202%206%201%206l-1%2034v34h9v-76h-5c-3%200-4%200-4%202m154%2029l-1%207c0%206%200%207%202%207l2-1h1l73%201h72v-14l-75-1-74%201m-47%2083v14h29v-28h-29v14m31%200v14h28v-28h-28v14m16%2039l-1%207v7h4l6-1h1a1769%201769%200%2000134%201h5v-14l-75-1-74%201\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/79b7f4cd3b890807c03e68359b4d5fb8/f4a91/env6.webp 728w,\n/static/79b7f4cd3b890807c03e68359b4d5fb8/e357c/env6.webp 1041w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/79b7f4cd3b890807c03e68359b4d5fb8/beb58/env6.png 728w,\n/static/79b7f4cd3b890807c03e68359b4d5fb8/ac011/env6.png 1041w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/79b7f4cd3b890807c03e68359b4d5fb8/beb58/env6.png\"\n            alt=\"先程の図に加えて、Env 2という環境が追加されている。Env 2にはcnt: 0という束縛があり、Global Envに向かって矢印が伸びている。Global Envにはcounter2という束縛が追加されている。counter2からは新しいクロージャに向かって矢印が伸びている。新しいクロージャの関数は「() =&gt; { cnt++; ... };」というテキストを、環境はEnv 2を指している。\"\n            title=\"先程の図に加えて、Env 2という環境が追加されている。Env 2にはcnt: 0という束縛があり、Global Envに向かって矢印が伸びている。Global Envにはcounter2という束縛が追加されている。counter2からは新しいクロージャに向かって矢印が伸びている。新しいクロージャの関数は「() =&gt; { cnt++; ... };」というテキストを、環境はEnv 2を指している。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"step-5counterの呼び出し\" style=\"position:relative;\"><a href=\"#step-5counter%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97\" aria-label=\"step 5counterの呼び出し permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step 5：counterの呼び出し</h3>\n<p>次に、グローバル環境で <code class=\"language-text\">counter1</code> を呼び出した結果を表示します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">counter1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span></code></pre></div>\n<p><code class=\"language-text\">counter1()</code> はクロージャを呼び出しています。</p>\n<p>クロージャが呼び出されると、クロージャの環境を外側の環境とする新しい環境が作成され、そこでクロージャの関数が評価されます。</p>\n<p>したがって、まず次のようなEnv 3が作成されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/34eaa7c287c75ab28b98ad602156c343/f0ccd/env7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.68681318681318%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'303\\'%20viewBox=\\'0%200%20400%20303\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M55%209l-2%202%202%203%202%202-2%202-2%203%202%202%203%202%202-2%202-2%202%202%203%202%202-2%202-3-2-2-2-3%202-2%202-2-2-2-2-2-2%202-3%202-1-2c-3-3-3-2-6%200m152%2014c0%206%201%209%203%206h1l2%201%203-1h1a2788%202788%200%2000172%201c2%200%202-1%202-7v-7H207v7m-15-4l-21%201h-22v21h-7l-7%201-1%207c0%206%200%207-2%206h-6l-7%201-8%201-1%2013%201%2013h-6l-6-1h-3v4h3l7-1h6V71c0-13%200-14%202-14s2%201%202%2021v20H96l-22-1c-1-2-4%200-4%202s2%203%204%202l22-1h20v7l1%207v-14h20v18h11l12%201h4l4-1v7c0%205%201%202%201-7v-15l-1%207c0%206%200%207-2%207-3-2-6-2-6-1l-11%201h-11V98h-21v-7c0-7%200-7%206-4l2-1%2078-1h78v2c0%203%200%203-9%203l10%201%2010-1h-9v-7H180V72h15V42l-1%2014v15h-28V43l14-1%2015-1h-45V21h21l21%201h4c4-2%204-2-1-4-2-1-3-1-3%201M60%2031v3l1%204v4H40l-22%201a674%20674%200%200066-1H63v-4l1-4c1-1-1-7-2-7l-2%204m75%2012v15l1%2013h28V43l-14-1-15%201m-18%2027c0%2012%200%2013%202%2013%203-2%206-2%206-1l27%201h27V72h-44l-1-8c0-6%200-7-2-7-3%202-6%202-6%201l-4-1h-5v13m225%201v7h-9l-8%201-1%2019v19h-4l-3-1c0-1-3-1-6%201-2%200-2-1-2-10l-1%2011c0%2011%201%2016%201%2010v-10l4%201h4l5-1h4V79h8l8%201v7c1%205%201%203%201-8V64l-1%207M71%20110v5l1%205v4H17l22%201c24%200%2023%200%2021%205v3l1%2034v35h5l6%201v37h44a418%20418%200%200149%201l3-2v15h15v29h9l9%201h4c4-2%204-2%200-4h-4l-8%201h-9v-27h45v-14h10l9%201h4c5-2%205-2%200-4h-4l-9%201h-10v-14h-61v7c0%208%200%208-6%205l-2%201-43%201H73v-36h208v10h-10c-6%200-1%201%2011%201s17-1%2011-1h-10v-11H73v-38l1-37%2017-1c14%200%2018-1%2019-2s1-1%200%200l-20%201H73v-4l1-5c3-2%200-6-3-5m-8%2017l1%203v3l-1%2034v34h9v-75l-5-1c-3%200-4%200-4%202m152%2036v7h68a720%20720%200%200076%200h5v-14H215v7m-46%2076v14h29v-28h-29v14m31%200v14h28v-28h-28v14m15%2045c0%206%200%208%202%208l1-2h1a149%20149%200%200044%201l44%201a410%20410%200%200051%200h6v-14l-75-1h-74v7\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/34eaa7c287c75ab28b98ad602156c343/f4a91/env7.webp 728w,\n/static/34eaa7c287c75ab28b98ad602156c343/8c33c/env7.webp 1047w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/34eaa7c287c75ab28b98ad602156c343/beb58/env7.png 728w,\n/static/34eaa7c287c75ab28b98ad602156c343/f0ccd/env7.png 1047w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/34eaa7c287c75ab28b98ad602156c343/beb58/env7.png\"\n            alt=\"先程の図に加えて、Env 3という環境が追加されている。この環境に束縛はなく、Env 1に矢印が伸びている。\"\n            title=\"先程の図に加えて、Env 3という環境が追加されている。この環境に束縛はなく、Env 1に矢印が伸びている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>次に、Env 3で <code class=\"language-text\">cnt++;</code> を評価します。Env 3に 変数 <code class=\"language-text\">cnt</code> の束縛はないため、外側の環境である Env 1に探しに行きます。そこで <code class=\"language-text\">cnt</code> が見つかるため、Env 1の <code class=\"language-text\">cnt</code> をインクリメントして、次のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9306fb549385c7a693a1e7fbc99e9e56/f0ccd/env8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.68681318681318%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'303\\'%20viewBox=\\'0%200%20400%20303\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M55%209l-2%202%202%203%202%202-2%202-2%203%202%202%203%202%202-2%202-2%202%202%203%202%202-2%202-3-2-2-2-3%202-2%202-2-2-2-2-2-2%202-3%202-1-2c-3-3-3-2-6%200m152%2014c0%206%201%209%203%206h1l2%201%203-1h1a2788%202788%200%2000172%201c2%200%202-1%202-7v-7H207v7m-15-4l-21%201h-22v21h-7l-7%201-1%207c0%206%200%207-2%206h-6l-7%201-8%201-1%2013%201%2013h-6l-6-1h-3v4h3l7-1h6V71c0-13%200-14%202-14s2%201%202%2021v20H96l-22-1c-1-2-4%200-4%202s2%203%204%202l22-1h20v7l1%207v-14h20v18h11l12%201h4l4-1v7c0%205%201%202%201-7v-15l-1%207c0%206%200%207-2%207-3-2-6-2-6-1l-11%201h-11V98h-21v-7c0-7%200-7%206-4l2-1%2078-1h78v2c0%203%200%203-9%203l10%201%2010-1h-9v-7H180V72h15V42l-1%2014v15h-28V43l14-1%2015-1h-45V21h21l21%201h4c4-2%204-2-1-4-2-1-3-1-3%201M60%2031v3l1%204v4H40l-22%201a674%20674%200%200066-1H63v-4l1-4c1-1-1-7-2-7l-2%204m75%2012v15l1%2013h28V43l-14-1-15%201m-18%2027c0%2012%200%2013%202%2013%203-2%206-2%206-1l27%201h27V72h-44l-1-8c0-6%200-7-2-7-3%202-6%202-6%201l-4-1h-5v13m225%201v7h-9l-8%201-1%2019v19h-4l-3-1c0-1-3-1-6%201-2%200-2-1-2-10l-1%2011c0%2011%201%2016%201%2010v-10l4%201h4l5-1h4V79h8l8%201v7c1%205%201%203%201-8V64l-1%207M71%20110v5l1%205v4H17l22%201c24%200%2023%200%2021%205v3l1%2034v35h5l6%201v37h44a418%20418%200%200149%201l3-2v15h15v29h9l9%201h4c4-2%204-2%200-4h-4l-8%201h-9v-27h45v-14h10l9%201h4c5-2%205-2%200-4h-4l-9%201h-10v-14h-61v7c0%208%200%208-6%205l-2%201-43%201H73v-36h208v10h-10c-6%200-1%201%2011%201s17-1%2011-1h-10v-11H73v-38l1-37%2017-1c14%200%2018-1%2019-2s1-1%200%200l-20%201H73v-4l1-5c3-2%200-6-3-5m-8%2017l1%203v3l-1%2034v34h9v-75l-5-1c-3%200-4%200-4%202m152%2036v7h68a720%20720%200%200076%200h5v-14H215v7m-46%2076v14h29v-28h-29v14m31%200v14h28v-28h-28v14m15%2045c0%206%200%208%202%208l1-2h1a149%20149%200%200044%201l44%201a410%20410%200%200051%200h6v-14l-75-1h-74v7\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9306fb549385c7a693a1e7fbc99e9e56/f4a91/env8.webp 728w,\n/static/9306fb549385c7a693a1e7fbc99e9e56/8c33c/env8.webp 1047w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9306fb549385c7a693a1e7fbc99e9e56/beb58/env8.png 728w,\n/static/9306fb549385c7a693a1e7fbc99e9e56/f0ccd/env8.png 1047w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9306fb549385c7a693a1e7fbc99e9e56/beb58/env8.png\"\n            alt=\"先程の図とほぼ同じだが、Env 1のcntの値が1になっている。\"\n            title=\"先程の図とほぼ同じだが、Env 1のcntの値が1になっている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>最後に、Env 3で <code class=\"language-text\">return cnt;</code> を評価します。先ほどと同じように <code class=\"language-text\">cnt</code> を探索すると、Env 1の束縛が見つかるため、最終的に <code class=\"language-text\">1</code> が <code class=\"language-text\">return</code> され、<code class=\"language-text\">console.log</code> によって表示されます。</p>\n<p>同じように、 <code class=\"language-text\">counter2</code> を呼び出した場合は、Env 2の <code class=\"language-text\">cnt</code> がインクリメントされます。</p>\n<p>最終的に、すべてのサンプルプログラムの実行が終わった時点では、次の図のようになっています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2568b5f605f2ccb2244109f983c231ef/f0ccd/env9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.68681318681318%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'303\\'%20viewBox=\\'0%200%20400%20303\\'%20preserveAspectRatio=\\'none\\'%3e%3cpath%20d=\\'M55%209l-2%202%202%203%202%202-2%202-2%203%202%202%203%202%202-2%202-2%202%202%203%202%202-2%202-3-2-2-2-3%202-2%202-2-2-2-2-2-2%202-3%202-1-2c-3-3-3-2-6%200m152%2014c0%206%201%209%203%206h1l2%201%203-1h1a2788%202788%200%2000172%201c2%200%202-1%202-7v-7H207v7m-15-4l-21%201h-22v21h-7l-7%201-1%207c0%206%200%207-2%206h-6l-7%201-8%201-1%2013%201%2013h-6l-6-1h-3v4h3l7-1h6V71c0-13%200-14%202-14s2%201%202%2021v20H96l-22-1c-1-2-4%200-4%202s2%203%204%202l22-1h20v7l1%207v-14h20v18h11l12%201h4l4-1v7c0%205%201%202%201-7v-15l-1%207c0%206%200%207-2%207-3-2-6-2-6-1l-11%201h-11V98h-21v-7c0-7%200-7%206-4l2-1%2078-1h78v2c0%203%200%203-9%203l10%201%2010-1h-9v-7H180V72h15V42l-1%2014v15h-28V43l14-1%2015-1h-45V21h21l21%201h4c4-2%204-2-1-4-2-1-3-1-3%201M60%2031v3l1%204v4H40l-22%201a674%20674%200%200066-1H63v-4l1-4c1-1-1-7-2-7l-2%204m75%2012v15l1%2013h28V43l-14-1-15%201m-18%2027c0%2012%200%2013%202%2013%203-2%206-2%206-1l27%201h27V72h-44l-1-8c0-6%200-7-2-7-3%202-6%202-6%201l-4-1h-5v13m225%201v7h-9l-8%201-1%2019v19h-4l-3-1c0-1-3-1-6%201-2%200-2-1-2-10l-1%2011c0%2011%201%2016%201%2010v-10l4%201h4l4-1h3v6l1%206h17v7l1%208%201-1-1-16-1-7v7h-16V79h8l8%201v7c1%205%201%203%201-8%200-15-1-20-1-8m-144%2046v15h-15c-8%200-11%201-7%201h7v28h8l10%201h5l3-1-4-2h-4l-9%201h-8v-27h45l-15-1h-14v-15l-1-14-1%2014m-127-7v5l1%205v4H16l23%201c24%200%2023%200%2021%205v3l1%2034v35h5l6%201v37h44a418%20418%200%200149%201l3-2v15h15v29h9l9%201h4c4-2%204-2%200-4h-4l-8%201h-9v-27h45v-14h10l9%201h4c5-2%205-2%200-4h-4l-9%201h-10v-14h-61v7c0%208%200%208-6%205l-2%201-43%201H73v-36h208v10h-10c-6%200-1%201%2011%201s17-1%2011-1h-10v-11H73v-38l1-37%2017-1c14%200%2018-1%2019-2s1-1%200%200l-20%201H73v-4l1-5c3-2%200-6-3-5m-8%2017l1%203v3l-1%2034v34h9v-75l-5-1c-3%200-4%201-4%202m152%2036v7h68a720%20720%200%200076%200h5v-14H215v7m127%2059v7h-9l-8%201-1%204c0%204%200%204-4%204l-3-1-2-1c-6%203-6%203-6-8l-1%2011c0%2011%201%2016%201%2010v-10l4%202h4l5-1c3%200%204-1%204-5v-4h16v7l1%207v-11c0-15-1-20-1-12m-173%2017v14h29v-28h-29v14m31%200v14h28v-28h-28v14m15%2045c0%206%200%208%202%208l1-2h1a147%20147%200%200044%201l44%201a410%20410%200%200051%200h6v-14l-75-1h-74v7\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2568b5f605f2ccb2244109f983c231ef/f4a91/env9.webp 728w,\n/static/2568b5f605f2ccb2244109f983c231ef/8c33c/env9.webp 1047w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2568b5f605f2ccb2244109f983c231ef/beb58/env9.png 728w,\n/static/2568b5f605f2ccb2244109f983c231ef/f0ccd/env9.png 1047w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2568b5f605f2ccb2244109f983c231ef/beb58/env9.png\"\n            alt=\"先程の図に加えて、Env 4、Env 5が追加されている。いずれも束縛はない。Env 4からはEnv 2へ矢印が伸びている。Env 5からはEnv 2へ矢印が伸びている。また、Env 1のcntの値は2に、Env 2のcntの値は1になっている。\"\n            title=\"先程の図に加えて、Env 4、Env 5が追加されている。いずれも束縛はない。Env 4からはEnv 2へ矢印が伸びている。Env 5からはEnv 2へ矢印が伸びている。また、Env 1のcntの値は2に、Env 2のcntの値は1になっている。\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"sicpの説明まとめ\" style=\"position:relative;\"><a href=\"#sicp%E3%81%AE%E8%AA%AC%E6%98%8E%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"sicpの説明まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SICPの説明まとめ</h3>\n<p>クロージャは、</p>\n<ul>\n<li>関数の評価結果</li>\n<li>関数と環境のペア\n<ul>\n<li>関数：関数本体への参照。具体的に何なのかは処理系によって異なる</li>\n<li>環境：クロージャが作成されたときの環境への参照</li>\n</ul>\n</li>\n<li>呼び出したとき、\n<ol>\n<li>新しい環境を作成し、その「外側の環境」をクロージャの環境にする</li>\n<li>新しい環境でクロージャの関数を評価する</li>\n</ol>\n</li>\n</ul>\n<p>環境とは、「束縛の集合」と「外側の環境への参照」のペア。</p>\n<p>束縛とは、「変数」と「値」のペア。</p>\n<h2 id=\"javascriptでは\" style=\"position:relative;\"><a href=\"#javascript%E3%81%A7%E3%81%AF\" aria-label=\"javascriptでは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScriptでは</h2>\n<p>SICPの説明はSchemeを前提にしていたので、実際のJavaScriptの挙動を確かめるために<a href=\"https://tc39.es/ecma262/\">ECMAScript</a>を参照してみましょう。</p>\n<h3 id=\"クロージャの作成評価\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E4%BD%9C%E6%88%90%E8%A9%95%E4%BE%A1\" aria-label=\"クロージャの作成評価 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クロージャの作成（評価）</h3>\n<p>アロー関数の評価は、<a href=\"https://tc39.es/ecma262/#sec-arrow-function-definitions-runtime-semantics-evaluation\">15.3.5 Runtime Semantics: Evaluation</a>から見ていくと良さそうです。</p>\n<p>以下、重要な部分のみ抜粋します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 15.3.5 Runtime Semantics: Evaluation\nArrowFunction : ArrowParameters => ConciseBody\n  1. Return InstantiateArrowFunctionExpression of ArrowFunction.\n\n# 15.3.4 Runtime Semantics: InstantiateArrowFunctionExpression\nArrowFunction : ArrowParameters => ConciseBody\n  // 現在の環境をenvとおく\n  2. Let env be the LexicalEnvironment of the running execution context.\n\n  // OrdinaryFunctionCreateを呼び出す（envも渡している）。その結果をclosureとおく\n  5. Let closure be OrdinaryFunctionCreate(%Function.prototype%, sourceText, ArrowParameters, ConciseBody, LEXICAL-THIS, env, privateEnv).\n\n  // closureを返す\n  7. Return closure.\n\n# 10.2.3 OrdinaryFunctionCreate ( functionPrototype, sourceText, ParameterList, Body, thisMode, env, privateEnv )\n  // 関数オブジェクト作成し、Fとおく\n  2. Let F be OrdinaryObjectCreate(functionPrototype, internalSlotsList).\n\n  // Fに関数本体をセットする\n  6. Set F.[[ECMAScriptCode]] to Body.\n\n  // Fに現在の環境をセットする\n  13. Set F.[[Environment]] to env.\n\n  // Fを返す（アロー関数の評価結果となる）\n  23. Return F.</code></pre></div>\n<p>というわけで、SICPのモデルと同じようなことをJavaScriptでも行っているとわかりました。</p>\n<p>ここで、内部スロット<code class=\"language-text\">F.[[Environment]]</code> と <code class=\"language-text\">F.[[ECMAScriptCode]]</code> の説明を見てみます。</p>\n<blockquote>\n<ul>\n<li>[[Environment]]\n<ul>\n<li>Type：an Environment Record</li>\n<li>説明：関数が閉包されたEnvironment Record。関数のコードを評価する際の外部環境として使用されます。</li>\n</ul>\n</li>\n<li>[[ECMAScriptCode]]\n<ul>\n<li>Type：a Parse Node</li>\n<li>説明：関数の本体を定義するソース・テキストのルート解析ノード。</li>\n</ul>\n</li>\n</ul>\n<p>出典：<a href=\"https://tc39.es/ecma262/#sec-ecmascript-function-objects\">10.2 ECMAScript Function Objects, ECMAScript</a>、翻訳はDeepLのものを筆者が改変したもの</p>\n</blockquote>\n<p>思ったとおりですね。</p>\n<p>また、Environment Recordの説明は以下のようになっています。</p>\n<blockquote>\n<p>Environment Recordは、（中略）識別子と特定の変数および関数との関連付けを定義するために使用される仕様タイプです。通常、（中略）FunctionDeclarationやBlockStatement、TryStatementのCatch節など（中略）が評価されるたびに、そのコードによって作成される識別子の束縛を記録する新しいEnvironment Recordが作成されます。</p>\n<p>すべてのEnvironment Recordには、[[OuterEnv]]フィールドがあり、これは NULL または外部のEnvironment Recordへの参照です。</p>\n<p>出典：<a href=\"https://tc39.es/ecma262/#sec-environment-records\">9.1 Environment Records, ECMAScript</a>、翻訳はDeepLのものを筆者が改変したもの</p>\n</blockquote>\n<p>これも想像どおりです。</p>\n<p>Environment Recordは、先程の説明における環境にそのまま相当すると考えられます。</p>\n<p>ちなみに、<code class=\"language-text\">OrdinaryFunctionCreate</code> はアロー関数だけではなく、</p>\n<ul>\n<li><code class=\"language-text\">function</code> による（非同期）関数の評価</li>\n<li>（非同期）メソッドの評価</li>\n<li>getter / setterの評価</li>\n<li>（非同期）ジェネレータの評価</li>\n</ul>\n<p>でも使用されているようです。</p>\n<p>しがたって、今回のサンプルプログラムではアロー関数を使用しましたが、他の書き方でもクロージャが生成されるのは変わらないということになります。</p>\n<p>「JavaScriptのほとんどの関数はクロージャ」と言われる理由がわかります。</p>\n<h3 id=\"クロージャの呼び出し適用\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E9%81%A9%E7%94%A8\" aria-label=\"クロージャの呼び出し適用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クロージャの呼び出し（適用）</h3>\n<p>関数呼び出しの評価は、<a href=\"https://tc39.es/ecma262/#sec-function-calls-runtime-semantics-evaluation\">13.3.6.1 Runtime Semantics: Evaluation</a>から見ていくと良さそうです。</p>\n<p>以下、重要な部分のみ抜粋します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 13.3.6.1 Runtime Semantics: Evaluation\nCallExpression : CallExpression Arguments\n  5. Return ? EvaluateCall(func, ref, Arguments, tailCall).\n\n# 13.3.6.2 EvaluateCall ( func, ref, arguments, tailPosition )\n  7. Return ? Call(func, thisValue, argList).\n\n# 7.3.14 Call ( F, V [ , argumentsList ] )\n  3. Return ? F.[[Call]](V, argumentsList).\n\n# 10.2.1 [[Call]] ( thisArgument, argumentsList )\n  2. Let calleeContext be PrepareForOrdinaryCall(F, undefined).\n\n# 10.2.1.1 PrepareForOrdinaryCall ( F, newTarget )\n  7. Let localEnv be NewFunctionEnvironment(F, newTarget).\n\n# 9.1.2.4 NewFunctionEnvironment ( F, newTarget )\n  // 新しいEnvironment Recordを作成し、envとおく\n  1. Let env be a new Function Environment Record containing no bindings.\n\n  // envの外側の環境をクロージャの環境にする\n  6. Set env.[[OuterEnv]] to F.[[Environment]].</code></pre></div>\n<p>というわけで、クロージャの呼び出し時に、その環境を外側の環境とする新しい環境が作成されているとわかりました。</p>\n<h2 id=\"v8では\" style=\"position:relative;\"><a href=\"#v8%E3%81%A7%E3%81%AF\" aria-label=\"v8では permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>V8では</h2>\n<p>最後に、実際のJSエンジン内部でクロージャがどのように実現されているかふんわり眺めてみましょう。</p>\n<h3 id=\"バイトコードを見てみる\" style=\"position:relative;\"><a href=\"#%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"バイトコードを見てみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>バイトコードを見てみる</h3>\n<p>はじめに、 <code class=\"language-text\">makeCounter</code> のバイトコードを見てみます。<a href=\"https://v8.dev/docs/ignition\">バイトコードおよびインタプリタについての説明</a>は公式サイトに譲ります。ここでは、「V8がソースコードから生成したやることリスト」くらいの認識で行きます。</p>\n<p>ともかく、<code class=\"language-text\">--print-bytecode</code> オプションを使用して見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> <span class=\"token parameter variable\">-v</span>\nv18.3.0\n\n$ <span class=\"token function\">node</span> --print-bytecode --print-bytecode-filter<span class=\"token operator\">=</span>makeCounter sample.js\n<span class=\"token punctuation\">[</span>generated bytecode <span class=\"token keyword\">for</span> function: makeCounter <span class=\"token punctuation\">(</span>0x01c7f8fc9cc1 <span class=\"token operator\">&lt;</span>SharedFunctionInfo makeCounter<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">..</span>.\nBytecode age: <span class=\"token number\">0</span>\n   <span class=\"token number\">20</span> E<span class=\"token operator\">></span> 0x1c7f8fca6c8 @    <span class=\"token number\">0</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">83</span> 00 01          CreateFunctionContext <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>, <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n         0x1c7f8fca6cb @    <span class=\"token number\">3</span> <span class=\"token builtin class-name\">:</span> 1a fa             PushContext r0\n         0x1c7f8fca6cd @    <span class=\"token number\">5</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>                LdaTheHole\n         0x1c7f8fca6ce @    <span class=\"token number\">6</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             StaCurrentContextSlot <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">40</span> S<span class=\"token operator\">></span> 0x1c7f8fca6d0 @    <span class=\"token number\">8</span> <span class=\"token builtin class-name\">:</span> 0c                LdaZero\n   <span class=\"token number\">40</span> E<span class=\"token operator\">></span> 0x1c7f8fca6d1 @    <span class=\"token number\">9</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">25</span> 02             StaCurrentContextSlot <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">45</span> S<span class=\"token operator\">></span> 0x1c7f8fca6d3 @   <span class=\"token number\">11</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">80</span> 01 00 02       CreateClosure <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>, <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>, <span class=\"token comment\">#2</span>\n   <span class=\"token number\">91</span> S<span class=\"token operator\">></span> 0x1c7f8fca6d7 @   <span class=\"token number\">15</span> <span class=\"token builtin class-name\">:</span> a9                Return\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>ふむり。</p>\n<p><code class=\"language-text\">CreateFunctionContext</code> が気になります。関数呼び出し時に作成するものということで、Contextは、これまでの環境やEnvironment Recordに相当するものではないかという予想が立ちます。その後の <code class=\"language-text\">PushContext</code> は、コードを実行する環境を、作成した新しい環境に切り替えているのではないかと考えました。</p>\n<p><code class=\"language-text\">LdaZero</code> は <code class=\"language-text\">let cnt = 0;</code> の <code class=\"language-text\">0</code> に対応してそうですね。<code class=\"language-text\">CreateClosure</code> はそのまんまの意味だと思います。</p>\n<h3 id=\"デバッグプリントしてみる\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%97%E3%83%AA%E3%83%B3%E3%83%88%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"デバッグプリントしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>デバッグプリントしてみる</h3>\n<p>次に、<code class=\"language-text\">--allow-natives-syntax</code> の <code class=\"language-text\">%DebugPrint</code> を使って、クロージャが内部でどのように表現されているのかをデバッグプリントしてみます。</p>\n<p>サンプルコードの最後に <code class=\"language-text\">%DebugPrint(counter1);</code> を追加して、次のコマンドを実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> --allow-natives-syntax sample.js\nDebugPrint: 0x2d73c590c5f9: <span class=\"token punctuation\">[</span>Function<span class=\"token punctuation\">]</span>\n - map: 0x11b664d813b9 <span class=\"token operator\">&lt;</span>Map<span class=\"token punctuation\">(</span>HOLEY_ELEMENTS<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>FastProperties<span class=\"token punctuation\">]</span>\n - prototype: 0x20596e7cb2e9 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x358d345f99a1<span class=\"token punctuation\">)</span><span class=\"token operator\">></span>\n - elements: 0x1fd612d41329 <span class=\"token operator\">&lt;</span>FixedArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>HOLEY_ELEMENTS<span class=\"token punctuation\">]</span>\n - <span class=\"token keyword\">function</span> prototype: <span class=\"token operator\">&lt;</span>no-prototype-slot<span class=\"token operator\">></span>\n<span class=\"token punctuation\">..</span>.\n - context: 0x2d73c590c5d1 <span class=\"token operator\">&lt;</span>FunctionContext<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<details>\n  <summary>V8の開発環境を構築します。</summary>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> <span class=\"token environment constant\">$HOME</span>\n<span class=\"token function\">mkdir</span> ws <span class=\"token comment\"># ワークスペースを作成</span>\n<span class=\"token builtin class-name\">cd</span> ws\n\n<span class=\"token function\">git</span> clone https://chromium.googlesource.com/chromium/tools/depot_tools.git <span class=\"token parameter variable\">--depth</span> <span class=\"token number\">1</span>\n<span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token environment constant\">$PATH</span>:<span class=\"token environment constant\">$HOME</span>/ws/depot_tools/\"</span>\n\nfetch v8\n<span class=\"token builtin class-name\">cd</span> v8\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> instal ccache</code></pre></div>\n<p>ccacheを導入するために以下のように変更します。</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">diff --git a/.gn b/.gn\nindex 3a73ff4e2a1..572d1e3caf6 100644\n<span class=\"token coord\">--- a/.gn</span>\n<span class=\"token coord\">+++ b/.gn</span>\n@@ -27,6 +27,7 @@ no_check_targets = [\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>default_args = {\n<span class=\"token prefix unchanged\"> </span>  # Disable rust dependencies.\n<span class=\"token prefix unchanged\"> </span>  enable_rust = false\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  cc_wrapper = \"ccache\"\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>}\n</span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span># These are the list of GN files that run exec_script. This whitelist exists</span></code></pre></div>\n</details>\n<p>V8のリポジトリをVS Codeで開き、<code class=\"language-text\">- function prototype:</code>で全文検索します。すると1箇所だけヒットします。</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">JSFunction</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">JSFunctionPrint</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>ostream<span class=\"token operator\">&amp;</span> os<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Isolate<span class=\"token operator\">*</span> isolate <span class=\"token operator\">=</span> <span class=\"token function\">GetIsolate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">JSObjectPrintHeader</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Function\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  os <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"\\n - function prototype: \"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ここにヒット</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">has_prototype_slot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<blockquote>\n<p>出典：<a href=\"https://github.com/v8/v8/blob/a619087d49b84eb2f98c7c13d5329c34eca17bde/src/diagnostics/objects-printer.cc#L1849\">v8/src/diagnostics/objects-printer.cc at a619087d49b84eb2f98c7c13d5329c34eca17bde · v8/v8</a>、翻訳はDeepLのものを筆者が改変したもの</p>\n</blockquote>\n<p>これは <code class=\"language-text\">JSFunction</code> をデバッグプリントするためのコードなので、 <code class=\"language-text\">counter1</code> は <code class=\"language-text\">JSFunction</code> という構造で表現されているはずです。</p>\n<h3 id=\"重要そうな構造の定義を眺めてみる\" style=\"position:relative;\"><a href=\"#%E9%87%8D%E8%A6%81%E3%81%9D%E3%81%86%E3%81%AA%E6%A7%8B%E9%80%A0%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%82%92%E7%9C%BA%E3%82%81%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"重要そうな構造の定義を眺めてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>重要そうな構造の定義を眺めてみる</h3>\n<p>というわけで、 <code class=\"language-text\">JSFunction</code> の定義に飛んで周辺を見てみますと、</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// JSFunctionはJavaScriptのfunctionsを表す</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">JSFunction</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">TorqueGeneratedJSFunction</span><span class=\"token operator\">&lt;</span>\n                       <span class=\"token class-name\">JSFunction</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JSFunctionOrBoundFunctionOrWrappedFunction</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token comment\">// [context]: このfunctionのcontext</span>\n  <span class=\"token keyword\">inline</span> Tagged<span class=\"token operator\">&lt;</span>Context<span class=\"token operator\">></span> <span class=\"token function\">context</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token comment\">// [code]: 生成されたこの関数のコードオブジェクト。</span>\n  <span class=\"token comment\">// foo() や new foo() など、関数が呼び出されたときに実行されます。</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function\">DECL_ACCESSORS</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">,</span> Tagged<span class=\"token operator\">&lt;</span>Code<span class=\"token operator\">></span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>出典：<a href=\"https://github.com/v8/v8/blob/a619087d49b84eb2f98c7c13d5329c34eca17bde/src/objects/js-function.h#L89\">v8/src/objects/js-function.h at a619087d49b84eb2f98c7c13d5329c34eca17bde · v8/v8</a>、翻訳はDeepLのものを筆者が改変したもの</p>\n</blockquote>\n<p>なんとなく関数（<code class=\"language-text\">[code]</code>）と環境（<code class=\"language-text\">[context]</code>）のペアであるように見えます。なんとなくですけど。</p>\n<p><code class=\"language-text\">Context</code> の定義周辺も見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// JSFunctionsは(context, function code)のペアであり、これはクロージャとも呼ばれる。</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token comment\">// [ previous       ]  前のコンテキストへの参照</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Context</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">TorqueGeneratedContext</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Context</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HeapObject</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\n  <span class=\"token comment\">//...</span>\n\n  <span class=\"token keyword\">inline</span> Tagged<span class=\"token operator\">&lt;</span>Context<span class=\"token operator\">></span> <span class=\"token function\">previous</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>出典：<a href=\"https://github.com/v8/v8/blob/a619087d49b84eb2f98c7c13d5329c34eca17bde/src/objects/contexts.h#L396\">v8/src/objects/contexts.h at a619087d49b84eb2f98c7c13d5329c34eca17bde · v8/v8</a>、翻訳はDeepLのものを筆者が改変したもの</p>\n</blockquote>\n<p>正直、C++筋がへなちょこなのと、マクロが多用されていることから、コードの意味は一切わかりませんでした。</p>\n<p>ただコメントから察するに、JSFunctionはクロージャ、contextは環境で合っているようです。そして、<code class=\"language-text\">previous</code> は外側の環境への参照ではないかを当たりをつけました。</p>\n<h3 id=\"より詳しくデバッグプリントしてみる\" style=\"position:relative;\"><a href=\"#%E3%82%88%E3%82%8A%E8%A9%B3%E3%81%97%E3%81%8F%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%97%E3%83%AA%E3%83%B3%E3%83%88%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"より詳しくデバッグプリントしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>より詳しくデバッグプリントしてみる</h3>\n<p>先程の <code class=\"language-text\">JSFunctionPrint</code> は <code class=\"language-text\">context</code> の内容を詳しく表示してくれません。</p>\n<p>一方で、<code class=\"language-text\">objects-printer.cc</code> を散歩していると <code class=\"language-text\">ContextPrint</code> という、いかにも <code class=\"language-text\">context</code> の内容を表示してくれそうな処理を見つけました。</p>\n<p>というわけで、<code class=\"language-text\">JSFunctionPrint</code> を改造して、<code class=\"language-text\">context</code> とその外側の環境に関する詳しい情報を表示するようにしてみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">diff --git a/src/diagnostics/objects-printer.cc b/src/diagnostics/objects-printer.cc\nindex 51c4d991d17..3d9c03d64a7 100644\n<span class=\"token coord\">--- a/src/diagnostics/objects-printer.cc</span>\n<span class=\"token coord\">+++ b/src/diagnostics/objects-printer.cc</span>\n@@ -1905,6 +1905,12 @@ void JSFunction::JSFunctionPrint(std::ostream&amp; os) {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>  } else {\n<span class=\"token prefix unchanged\"> </span>    os &lt;&lt; \"not available\\n\";\n<span class=\"token prefix unchanged\"> </span>  }\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>\n<span class=\"token prefix inserted\">+</span>  os &lt;&lt; \"\\n --- context ---\\n\";\n<span class=\"token prefix inserted\">+</span>  context()->ContextPrint(os);\n<span class=\"token prefix inserted\">+</span>\n<span class=\"token prefix inserted\">+</span>  os &lt;&lt; \"\\n --- previous context ---\\n\";\n<span class=\"token prefix inserted\">+</span>  context()->previous()->ContextPrint(os);\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>}\n</span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>void SharedFunctionInfo::PrintSourceCode(std::ostream&amp; os) {</span></code></pre></div>\n<p>また、サンプルコードの最後に<code class=\"language-text\">%DebugPrint(counter2);</code> も追加します。</p>\n<p>そしてV8をビルドし、実行してみると、</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ ./tools/dev/gm.py x64.release <span class=\"token operator\">&amp;&amp;</span> ./out/x64.release/d8 --allow-natives-syntax <span class=\"token punctuation\">..</span>/sample.js\n\n<span class=\"token comment\"># counter1 (0x3b160004aa55) のデバッグプリント</span>\nDebugPrint: 0x3b160004aa55: <span class=\"token punctuation\">[</span>Function<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># count1の環境</span>\n0x10580004aa4d: <span class=\"token punctuation\">[</span>Context<span class=\"token punctuation\">]</span>\n - elements:\n           <span class=\"token number\">0</span>: 0x3b160019a04d <span class=\"token operator\">&lt;</span>ScopeInfo FUNCTION_SCOPE<span class=\"token operator\">></span>\n           <span class=\"token number\">1</span>: 0x3b160019a031 <span class=\"token operator\">&lt;</span>ScriptContext<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n           <span class=\"token number\">2</span>: <span class=\"token number\">2</span> <span class=\"token comment\"># cntの値</span>\n\n<span class=\"token comment\"># count1の環境の外側の環境（グローバル環境）</span>\n0x3b160019a031: <span class=\"token punctuation\">[</span>Context<span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> OldSpace\n - elements:\n           <span class=\"token number\">0</span>: 0x3b1600199eb1 <span class=\"token operator\">&lt;</span>ScopeInfo SCRIPT_SCOPE<span class=\"token operator\">></span>\n           <span class=\"token number\">1</span>: 0x3b1600183c79 <span class=\"token operator\">&lt;</span>NativeContext<span class=\"token punctuation\">[</span><span class=\"token number\">284</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n           <span class=\"token number\">2</span>: 0x3b160004aa19 <span class=\"token operator\">&lt;</span>JSFunction makeCounter <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x3b1600199ee9<span class=\"token punctuation\">)</span><span class=\"token operator\">></span>\n           <span class=\"token number\">3</span>: 0x3b160004aa55 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x3b160019a07d<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token comment\"># counter1</span>\n           <span class=\"token number\">4</span>: 0x3b160004aa85 <span class=\"token operator\">&lt;</span>JSFunction <span class=\"token punctuation\">(</span>sfi <span class=\"token operator\">=</span> 0x3b160019a07d<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token comment\"># counter2</span>\n\n<span class=\"token comment\"># counter2 (0x3b160004aa85) のデバッグプリント</span>\nDebugPrint: 0x3b160004aa85: <span class=\"token punctuation\">[</span>Function<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># count2の環境</span>\n0x3b160004aa71: <span class=\"token punctuation\">[</span>Context<span class=\"token punctuation\">]</span>\n - elements:\n           <span class=\"token number\">0</span>: 0x3b160019a04d <span class=\"token operator\">&lt;</span>ScopeInfo FUNCTION_SCOPE<span class=\"token operator\">></span>\n           <span class=\"token number\">1</span>: 0x3b160019a031 <span class=\"token operator\">&lt;</span>ScriptContext<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n           <span class=\"token number\">2</span>: <span class=\"token number\">1</span> <span class=\"token comment\"># cntの値</span>\n\n<span class=\"token comment\"># count2の環境の外側の環境（グローバル環境）</span>\n0x3b160019a031: <span class=\"token punctuation\">[</span>Context<span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> OldSpace\n<span class=\"token comment\"># 以下counter1のデバッグプリントと同じ</span></code></pre></div>\n<p>まず、<code class=\"language-text\">counter1</code> の <code class=\"language-text\">context</code> における <code class=\"language-text\">elements</code> の部分に束縛の情報が表示されています。<code class=\"language-text\">counter1</code>の環境なので、<code class=\"language-text\">2</code>が表示されていますね。一方で、<code class=\"language-text\">counter2</code> の方を見ると <code class=\"language-text\">1</code> が表示されています。</p>\n<p>そして、<code class=\"language-text\">previous context</code> は、どちらのカウンタのデバッグプリントでもグローバル環境が表示されています。 <code class=\"language-text\">elements</code> を見ると、<code class=\"language-text\">makeCounter</code> や、2つの <code class=\"language-text\">JSFunction</code> の束縛が表示されています。これらは、それぞれ <code class=\"language-text\">counter1</code> と <code class=\"language-text\">counter2</code> にアドレスが一致します。</p>\n<h3 id=\"v8でのまとめ\" style=\"position:relative;\"><a href=\"#v8%E3%81%A7%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"v8でのまとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>V8でのまとめ</h3>\n<p>アロー関数の評価結果は <code class=\"language-text\">JSFunction</code> でした。これは関数（<code class=\"language-text\">[code]</code>）と環境（<code class=\"language-text\">[context]</code>）のペアであり、クロージャに相当します。</p>\n<p><code class=\"language-text\">context</code> は束縛の集合と、外側の環境への参照（<code class=\"language-text\">previous</code>）を持っているようです。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>SICP、ECMAScript、V8を調べることで、それぞれにクロージャ、環境、束縛に相当する構造があることを確認しました。</p>\n<p>ことの発端は、<a href=\"https://blog.recruit.co.jp/rtc/2023/08/10/recruit-bootcamp-2023/\">会社の新人向けJavaScript研修</a>にサポート講師として参加した際、新人の方からの「クロージャとは何ですか？」という質問に、僕がうまく回答できなかったことでした。</p>\n<p>こういう素朴な疑問が、理解を深めるきっかけになったのは良かったです。研修というのは、新人だけでなく、講師の知見を広げる場でもあるんだなぁと感じるところです。</p>\n<p>今回取り扱ったようなことについてもっと知りたい場合は、<a href=\"https://www.youtube.com/watch?v=dO1aqPBJCPg&#x26;t=1365s\">Gerald Jay Sussman氏（SICPの著者の1人）による環境モデルの講義動画</a>がおすすめです。僕は英語力が終わっているので、字幕の翻訳機能で見ました。</p>\n<p>手を動かしたい場合は、SICPの4章がおすすめです。環境モデルを含めたメタ循環評価器（ある言語で実装された、その言語自身の評価器）を作ることで理解が深まりますし、非決定性計算や論理プログラミングといった馴染みのないパラダイムに対して、環境モデルがどのように適用されるかというのは、むずかしいですが興味深いと感じました。</p>\n<p>最後に，本記事は<a href=\"https://adventar.org/\">Recruit Engineers Advent Calendar 2023</a>のxx日目の記事でした。昨日は〜〜でした．明日は〜〜です．楽しみですね！</p>","frontmatter":{"title":"「クロージャは関数と環境のペア」とは？（JavaScript）","date":"2023/11/23"},"fields":{"slug":"/「クロージャは関数と環境のペア」とは？（JavaScript）/"},"id":"6a82c7c5-6fcb-5305-b890-9794dc955422"},"firstImage":{"imageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/566007376866e5cae189b6c99d0e61f1/9b7f3/top.png","srcSet":"/static/566007376866e5cae189b6c99d0e61f1/e82f0/top.png 163w,\n/static/566007376866e5cae189b6c99d0e61f1/7230e/top.png 326w,\n/static/566007376866e5cae189b6c99d0e61f1/9b7f3/top.png 651w","sizes":"(min-width: 651px) 651px, 100vw"},"sources":[{"srcSet":"/static/566007376866e5cae189b6c99d0e61f1/f5d5d/top.webp 163w,\n/static/566007376866e5cae189b6c99d0e61f1/9696a/top.webp 326w,\n/static/566007376866e5cae189b6c99d0e61f1/4628f/top.webp 651w","type":"image/webp","sizes":"(min-width: 651px) 651px, 100vw"}]},"width":651,"height":418}}}},"relatedMarkdownRemarks":{"posts":[{"id":"5dba01b8-593d-5295-b135-16df1c6295e5","frontmatter":{"draft":null}},{"id":"84bf9a79-dd68-55d1-a1b3-60ffd3784554","frontmatter":{"draft":null}},{"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a","frontmatter":{"draft":null}},{"id":"9f02de74-61a0-5daf-a048-1c1022e08fe4","frontmatter":{"draft":null}},{"id":"73ab4455-f04d-5320-bf3a-90b9f7441d13","frontmatter":{"draft":null}},{"id":"a091877c-69b8-59f9-8963-1af334fd573c","frontmatter":{"draft":null}},{"id":"89ddbcc0-ed71-5a69-9d55-9677eab3e6cf","frontmatter":{"draft":null}},{"id":"75696ec6-74a3-5046-8a3c-f39b36d92311","frontmatter":{"draft":null}},{"id":"27f10a38-0ecb-539f-a717-7e40a41bbd10","frontmatter":{"draft":null}},{"id":"29b79017-f96d-5b04-8d01-5b8ee761ebed","frontmatter":{"draft":null}},{"id":"1162dccb-e1bf-576d-a5c6-0993394feb0a","frontmatter":{"draft":true}},{"id":"0116f663-28d1-507a-b5ab-b189801dd408","frontmatter":{"draft":true}},{"id":"c2db052c-95c6-5094-935b-9eb39f5c762a","frontmatter":{"draft":null}},{"id":"3a3c4125-9986-53bb-8b96-ae29936c96ab","frontmatter":{"draft":null}},{"id":"d29b4513-0609-5cfc-af49-817467dbed1f","frontmatter":{"draft":null}},{"id":"c5e2431a-cf05-5024-b833-e1c69f680d44","frontmatter":{"draft":null}},{"id":"82d43655-ea2a-52cd-97a3-16b7b28ad150","frontmatter":{"draft":null}},{"id":"be594923-185e-5cca-95b6-5267b3c9fc8c","frontmatter":{"draft":null}},{"id":"01deffb8-0d62-54c6-9e41-20832cbc3c6e","frontmatter":{"draft":null}},{"id":"067a602f-4581-5707-b896-73190dd8c889","frontmatter":{"draft":null}},{"id":"0c5568c9-6d87-56ed-ab0e-caeb9c1aafa4","frontmatter":{"draft":null}},{"id":"1086a735-7173-58cc-a813-c540a563aedf","frontmatter":{"draft":false}},{"id":"12222bfa-2e8e-51ee-99d8-8a19902351f5","frontmatter":{"draft":null}},{"id":"1509de3c-7308-5e40-a885-f5ebdb089774","frontmatter":{"draft":null}},{"id":"2cfd9e33-b4e1-53e4-884d-d8a6760f3387","frontmatter":{"draft":true}},{"id":"2f30c3f1-0d66-590b-8dba-7836df701d46","frontmatter":{"draft":null}},{"id":"3908aafc-c8d3-5c67-821f-0866592449f2","frontmatter":{"draft":true}},{"id":"3b696b96-130d-50de-a673-dc1367f32387","frontmatter":{"draft":null}},{"id":"46a22c41-5455-557c-85d4-973a6e2220ee","frontmatter":{"draft":null}},{"id":"48c65a15-67ca-57d0-9edc-ebcb868f7ad2","frontmatter":{"draft":true}},{"id":"49cf25c1-03f6-575e-8c2f-638ccd6198ea","frontmatter":{"draft":null}},{"id":"4d43646f-8aa6-52b6-b0b6-5160f0be2b05","frontmatter":{"draft":null}},{"id":"4ed3b747-2001-54f4-9661-3acab89ce275","frontmatter":{"draft":null}},{"id":"4edc1b46-b395-5783-af6a-818b8fc9c2dc","frontmatter":{"draft":null}},{"id":"50951bb1-eb92-5663-a3d8-8f35f73a1322","frontmatter":{"draft":null}},{"id":"50d3cc2a-de7a-5b9a-a8d8-754415fe4d94","frontmatter":{"draft":null}},{"id":"5888c50d-8414-5e8f-b0dc-28a31b29053d","frontmatter":{"draft":null}},{"id":"63f3c7ad-6c59-52b5-9816-78fd348955ff","frontmatter":{"draft":true}},{"id":"69a4aa90-b728-522c-b34f-abee49825c45","frontmatter":{"draft":true}},{"id":"73d6ab42-b3e6-5663-a175-b1f3d69c29e1","frontmatter":{"draft":null}},{"id":"75550af2-8134-5467-a07d-abbb5a4f6b7c","frontmatter":{"draft":true}},{"id":"7778d041-a5bf-536a-a36f-c0dbc5e08ac7","frontmatter":{"draft":true}},{"id":"78349b16-6e41-5fef-ae38-bcdc5ff297ef","frontmatter":{"draft":true}},{"id":"7a8fc278-a847-5b68-8b74-a83193ba3f55","frontmatter":{"draft":null}},{"id":"7d6499d9-277c-5f07-b8b1-98ae40c50c42","frontmatter":{"draft":null}},{"id":"7d79eb4b-cd4a-5621-a67a-91d9a24dce05","frontmatter":{"draft":null}},{"id":"871ac696-39ea-5c64-94f3-5dc4b73b5770","frontmatter":{"draft":true}},{"id":"8b3e46c2-1a1e-5af0-8900-7972c7285d15","frontmatter":{"draft":null}},{"id":"8f7b1b24-7738-5b97-bfb6-fd763f11a664","frontmatter":{"draft":true}},{"id":"961ec1e6-3f2b-59d9-a33f-dad76cf67f47","frontmatter":{"draft":null}},{"id":"97f01467-e3a1-58e1-b2a4-db77354cc1a3","frontmatter":{"draft":null}},{"id":"9f24363b-ee3e-54bf-8a18-46ea3b269bea","frontmatter":{"draft":null}},{"id":"a190aac4-0483-5e02-b1d3-261f3b5f313a","frontmatter":{"draft":null}},{"id":"a6c64123-b824-5224-8027-90eb12040396","frontmatter":{"draft":null}},{"id":"b4251348-b618-5b5b-a2c8-e4c6b2431b83","frontmatter":{"draft":true}},{"id":"bfee69af-7d7f-5d87-9680-d2e9b60f8416","frontmatter":{"draft":null}},{"id":"c2249b7b-b97e-5cf4-8ea9-8024e96851b7","frontmatter":{"draft":true}},{"id":"c6def021-b8da-5dbe-ad3e-811d9286424d","frontmatter":{"draft":true}},{"id":"c7a5adfb-149b-5469-ba35-7421e2101951","frontmatter":{"draft":null}},{"id":"cbdf3192-973c-5d87-9cf1-bb9110e9a169","frontmatter":{"draft":null}},{"id":"d4d1afa4-f2f9-5942-ae36-2826fb938af5","frontmatter":{"draft":null}},{"id":"db26c6b9-37b4-5cc4-b1ec-c61dc667863e","frontmatter":{"draft":null}},{"id":"dd0c41cf-0a03-5b89-b5a2-f64859aeae63","frontmatter":{"draft":null}},{"id":"e322eac2-bd89-5347-b20d-d050d303a6be","frontmatter":{"draft":null}},{"id":"e376b2d4-df91-5b82-af7a-a8d02763e922","frontmatter":{"draft":true}},{"id":"e4fb8478-b1ad-59eb-95e8-8c5e0500d3f4","frontmatter":{"draft":true}},{"id":"e83330dc-2312-5ae6-95fa-53e86909f42b","frontmatter":{"draft":true}},{"id":"eba9aa6a-6e21-5f1b-a0eb-7b6bfb1e04f1","frontmatter":{"draft":null}},{"id":"ebae7878-c4ee-505e-81e2-3d3fc47ea826","frontmatter":{"draft":true}},{"id":"ed7af7f9-75f5-59be-9063-de564576eed7","frontmatter":{"draft":true}},{"id":"f06a6ae0-e961-504c-8dab-a60489c0557a","frontmatter":{"draft":true}},{"id":"f49ce388-e81c-5425-af59-9902f125c20f","frontmatter":{"draft":null}},{"id":"f5a25ce1-67a6-51b2-9bf1-f9fbacb41ad1","frontmatter":{"draft":true}},{"id":"fd6eab68-17d3-5395-8b2b-54a6efe43ebb","frontmatter":{"draft":null}}]}},"pageContext":{"id":"6a82c7c5-6fcb-5305-b890-9794dc955422"}},"staticQueryHashes":["1530353647","2576926420","63159454"]}