{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/ざっくりホーア論理/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://sititou70.github.io"}},"markdownRemark":{"excerpt":"階乗を計算する関数があります。 この関数が正しく動くことをホーア論理でざっくり証明します。そのための…","html":"<p>階乗を計算する関数があります。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fact</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 120</span></code></pre></div>\n<p>この関数が正しく動くことをホーア論理でざっくり証明します。そのための1つの方法は、関数の各時点で成り立つ条件を、コメントとして書いていくことです。</p>\n<p>例えば、<code class=\"language-text\">return</code>の直前では<code class=\"language-text\">y</code>の中身が<code class=\"language-text\">n</code>の階乗になっていてほしいです。なので以下のように書きます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { y = n! }</span></span>  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>今回は簡単のために、このプログラミング言語で扱える値は0以上の整数だけと仮定します。</p>\n<p>そうすると、<code class=\"language-text\">n</code>の階乗はいつでも計算できます。したがって、関数の先頭で必要な条件は特にありません。</p>\n<p>ここでは<code class=\"language-text\">{ True }</code>と書いておきましょう。常に成り立つアサーション<code class=\"language-text\">assert(true)</code>があるようなイメージです。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { True }</span></span>  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>次にわかりやすいのは、冒頭の2つの代入文の後の条件です。<code class=\"language-text\">x</code>の値が<code class=\"language-text\">n</code>、<code class=\"language-text\">y</code>の値が<code class=\"language-text\">1</code>になっていてほしいです。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { x = n かつ y = 1 }</span></span>  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ここで、1ステップ前、つまり<code class=\"language-text\">let y = 1;</code>の実行前には、どんな条件が成り立てば良いかを考えます。</p>\n<p><code class=\"language-text\">let y = 1;</code>という代入文は、実行すると<code class=\"language-text\">y</code>を<code class=\"language-text\">1</code>に上書きします。なので、「実行後の条件で、すべての<code class=\"language-text\">y</code>を<code class=\"language-text\">1</code>に戻した条件」が、実行前にも成り立てば良さそうです。したがって以下のようになります。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span></span>  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>同様に、<code class=\"language-text\">let x = n;</code>の実行前は以下のようになります。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span></span>  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ここで、2つの条件が連続していることに注目します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// { True }</span>\n<span class=\"token comment\">// { n = n かつ 1 = 1 }</span></code></pre></div>\n<p>2つの条件が連続しているときは、前の行の条件を仮定したときに、後の行の条件が成り立てばOKです。</p>\n<p>今回の例だと、Trueを仮定したときに（つまり無条件で）<code class=\"language-text\">n = n かつ 1 = 1</code>が成り立つのでOKです。</p>\n<p>このことを</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// { True }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { n = n かつ 1 = 1 }</span></code></pre></div>\n<p>と書くことにしましょう。<code class=\"language-text\">-></code>は「ならば」と読みます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// -></span></span>  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>次に、ループの前、途中、後で常に成り立つ条件、ループ不変条件（Loop invariant）を考えます。</p>\n<p>今回のループ不変条件は、<code class=\"language-text\">y * x! = n!</code>です。</p>\n<p>ループを進めるにしたがって、<code class=\"language-text\">y</code>は増加し、<code class=\"language-text\">x</code>は減少していきます。これらをうまいこと組み合わせると、お互いでバランスをとって一定になるといった感じです。</p>\n<p>まず、ループの前で不変条件が成り立つことを確認します。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { y * x! = n! }</span></span>  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ここで、<code class=\"language-text\">x = n かつ y = 1</code>を仮定すると、<code class=\"language-text\">y * x! = n!</code>は、<code class=\"language-text\">1 * n! = n!</code>となるので確かに成り立っています。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// -></span></span>  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>次に、ループのBodyの先頭で成り立つ条件を考えます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ここで成り立つ条件を考える</span></span>    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>とりあえず、ループの1回目でここに入ってきた場合を考えてみましょう。まず、変数の状態はループ前から変化していないので、不変条件が成り立ちます。加えて、ここに入ってきたということは<code class=\"language-text\">x !== 0</code>が真であったということですから、<code class=\"language-text\">x</code>が<code class=\"language-text\">0</code>でないことも成り立ちます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span></span>    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ここで、ループのBodyの末尾でも不変条件が成り立つことを示したいです。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ここでも{ y * x! = n! }が成り立ってほしい</span></span>  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>なぜなら、1回目以降も不変条件が成り立つ（保存される）ことを示せるからです。ある回のBodyの先頭で不変条件が成り立つことは、その前回のBodyの末尾で不変条件が成り立つことから言えます。</p>\n<p>というわけで、Bodyの末尾に不変条件を書いて、それが成り立つことを確認します。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// { y * x! = n! }</span></span>  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>直前は代入文なので、先程と同じように実行後の条件の<code class=\"language-text\">x</code>を<code class=\"language-text\">x - 1</code>に戻します。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// { y * (x - 1)! = n! }</span></span>    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>さらに、<code class=\"language-text\">y</code>を<code class=\"language-text\">y * x</code>に戻します。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// { (y * x) * (x - 1)! = n! }</span></span>    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * (x - 1)! = n! }</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>条件が2つ連続しているので、前者を仮定して後者が言えるか確かめます。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { y * (x * (x - 1)!) = n! }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { (y * x) * (x - 1)! = n! }</span></code></pre></div>\n<p>大丈夫そうですね。</p>\n<p><code class=\"language-text\">x! = x * (x - 1)!</code>の変形がポイントです。例えば<code class=\"language-text\">5! = 5 * 4! = 5 * (4 * 3 * 2 * 1)</code>みたいな感じです。</p>\n<p>注意したいのは、<code class=\"language-text\">x != 0</code>という仮定のおかげで<code class=\"language-text\">(x - 1)!</code>と書けるということです。この仮定がないと、<code class=\"language-text\">x</code>は<code class=\"language-text\">0</code>であるかもしれず、それだと<code class=\"language-text\">-1</code>の階乗が出てきてしまうのでダメです。</p>\n<p>さて、ループの前でも、途中でも不変条件が成り立つ（保存される）ので、ループの後でも成り立つと言えます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { y * (x * (x - 1)!) = n! }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { (y * x) * (x - 1)! = n! }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * (x - 1)! = n! }</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { y * x! = n! }</span></span>  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>さらに、ループを抜けたということは<code class=\"language-text\">x !== 0</code>が偽であったということなので、追加で以下のようになります。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { y * (x * (x - 1)!) = n! }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { (y * x) * (x - 1)! = n! }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * (x - 1)! = n! }</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// { y * x! = n! かつ !(x != 0) }</span></span>  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>条件が連続しているので、前者を仮定して後者を示します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// { y * x! = n! かつ !(x != 0) }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { y * x! = n! かつ x = 0 }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { y * 0! = n! }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { y * 1 = n! }</span>\n<span class=\"token comment\">// -></span>\n<span class=\"token comment\">// { y = n! }</span></code></pre></div>\n<p>というわけでこの関数では、Trueを仮定し（つまり無条件で）、<code class=\"language-text\">return</code>の直前まで実行されたならば、<code class=\"language-text\">y = n!</code>が成り立っています。</p>\n<p>これで証明完了です。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fact</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// { True }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { n = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ 1 = 1 }</span>\n  <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// { x = n かつ y = 1 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// { y * x! = n! かつ x != 0 }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { y * (x * (x - 1)!) = n! }</span>\n    <span class=\"token comment\">// -></span>\n    <span class=\"token comment\">// { (y * x) * (x - 1)! = n! }</span>\n    y <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * (x - 1)! = n! }</span>\n    x <span class=\"token operator\">=</span> x <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// { y * x! = n! }</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// { y * x! = n! かつ !(x != 0) }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * x! = n! かつ x = 0 }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * 0! = n! }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y * 1 = n! }</span>\n  <span class=\"token comment\">// -></span>\n  <span class=\"token comment\">// { y = n! }</span>\n  <span class=\"token keyword\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"形式化\" style=\"position:relative;\"><a href=\"#%E5%BD%A2%E5%BC%8F%E5%8C%96\" aria-label=\"形式化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>形式化</h2>\n<p>この関数はあらゆる入力に対して正しく振る舞うことが示されたので、すぐにリリースできます。テスト工程は必要ありません。</p>\n<p><em>いやいや、式変形や場合分けに間違いがあるかもしれないじゃないか！</em></p>\n<p><em>貴様の頭の中でやった証明など信用ならん！！</em></p>\n<p>という方には、Coqをおすすめします。以下は、今回のプログラムをCoqで形式化し、証明しているところです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48795ecf645d2e0ae5fcc41275a7b71f/cb051/coq_ss.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.31868131868132%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVR42l1T2W7cMBDblzRp4kOWJeuwZPlA1ns3vV6L/v9PsZRdoEAfBpI1sxwOOXtQdsJsPY7BwBkH6ya8vEp8eql5NngtJE+Bz28NtE1o9YCy7vD0XOLp5W9s92qLg9QBNYuSixiXhHAaYZYJZp4hfY+3QsHGBWpeobqIajAoWkPQ/0IY1NLh0LKo7QIkQcW5h/v9Dvt9QrsO6M4JVU/m0wnq+hXDcET106D6YtAmD5nBPb8NT7IWbZ8BB4JFKIa/BjiCNaGHIDs1kJHpEJcb/OMDJjfNuQyW8473zkMov7ETKgMaMqFugd31JWH8dYd0I6QMHHGAUpGAV3SXO4qhhVh7tDFC9j3q5CDHHs3Et0TpWo5s/AyVQf20PehwhB8vfCM7aVFxlG66oH6/QpBtSQkKqVE2HU9Gs0fZ7DoeMtVGBWQt813HK8L82HQtKHZRadi0Qq53ODuiPlqUjgaI3OyfIRW/N8AsZgbMK5EZmn7ZtHgjUAbMLqflAnv7gCDj4qZR3fib2aEOllpnQnar3QANR1UmbTpmhl08Qfcr4nQm+ARpArrxhPZ0haKL5ZmsL2xGhys6rI1HSO+QNCbv58G4GbsxHIcM3PINaf0BF5atYy7S8Yiapgn+ASTFVyGis9yObd0ol9lXr2osDsv6YHJnmXU0NEWTreD4uVi0Hi2108w3sYeMO6B1acs3lCev3e6Bxx84mBiuS1VmBwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/48795ecf645d2e0ae5fcc41275a7b71f/f4a91/coq_ss.webp 728w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/2158a/coq_ss.webp 1600w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/48795ecf645d2e0ae5fcc41275a7b71f/beb58/coq_ss.png 728w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/cb051/coq_ss.png 1600w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/48795ecf645d2e0ae5fcc41275a7b71f/beb58/coq_ss.png\"\n            alt=\"今回のプログラムをCoqで証明しているところ\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>右に表示されてるのが示すべき条件で、その示し方を左に書いた命令（タクティク）で指示しています。</p>\n<p>式変形や場合分けはCoqがやってくれます。また、簡単な部分については自動で解決してくれます。</p>\n<p>UATはCoqのチェックが通ることを確認したら完了ですね（？）</p>\n<p>まぁ一方で形式化のコストがかかるんですけれども</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>なぜかホーア論理をざっくり勉強したので、備忘のために階乗の関数をざっくり証明しました。</p>\n<p>プログラムはメモリの状態を次々に変化させます。それらの状態で成り立つ条件を追いかけることで、最終的に示したい性質が導かれることを確認しました。</p>\n<p>今回取り上げたのはホーア論理のさわりの部分だけです。</p>\n<p>この考え方を発展させていくことで、より多くのプログラム、例えばポインタを使ったプログラムなどに対しても証明を与えられるのだそうです。</p>\n<p>すごいですね</p>\n<h3 id=\"参考文献\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-label=\"参考文献 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考文献</h3>\n<ul>\n<li><a href=\"http://proofcafe.org/sf/Hoare_J.html\">Hoare_J, ソフトウェアの基礎</a>\n<ul>\n<li>ホーア論理の基礎に触れながら、Coqを使って形式化も行います。この本そのものもCoq（のドキュメント生成ツールであるcoqdoc）で書かれています。</li>\n</ul>\n</li>\n<li><a href=\"https://group-mmm.org/~ichiro/talks/komabaSogo.pdf\">Hoare 論理によるプログラム検証入門</a>\n<ul>\n<li>学部1年生向けにCoqを説明するための資料とのことで、とてもわかりやすいです。</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"ざっくりホーア論理","date":"2024/09/28"},"fields":{"slug":"/ざっくりホーア論理/"},"id":"0bc9da5c-36cb-5e74-8b2f-bf514edbb710"},"firstImage":{"imageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080818","images":{"fallback":{"src":"/static/48795ecf645d2e0ae5fcc41275a7b71f/1624f/coq_ss.png","srcSet":"/static/48795ecf645d2e0ae5fcc41275a7b71f/aeb79/coq_ss.png 400w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/47126/coq_ss.png 800w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/1624f/coq_ss.png 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"},"sources":[{"srcSet":"/static/48795ecf645d2e0ae5fcc41275a7b71f/dff21/coq_ss.webp 400w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/b2a35/coq_ss.webp 800w,\n/static/48795ecf645d2e0ae5fcc41275a7b71f/e9d78/coq_ss.webp 1600w","type":"image/webp","sizes":"(min-width: 1600px) 1600px, 100vw"}]},"width":1600,"height":900}}}},"relatedMarkdownRemarks":{"posts":[{"id":"f49ce388-e81c-5425-af59-9902f125c20f","frontmatter":{"draft":null}},{"id":"0eb7c2e2-bc0d-5850-be29-02c94c05d548","frontmatter":{"draft":null}},{"id":"20366208-22bf-510a-af74-94a17da941af","frontmatter":{"draft":null}},{"id":"fc7ce496-d3b3-5f39-a04e-8e2dfb960626","frontmatter":{"draft":null}},{"id":"5dba01b8-593d-5295-b135-16df1c6295e5","frontmatter":{"draft":null}},{"id":"2cfd9e33-b4e1-53e4-884d-d8a6760f3387","frontmatter":{"draft":true}},{"id":"75696ec6-74a3-5046-8a3c-f39b36d92311","frontmatter":{"draft":null}},{"id":"3d71b3f9-8d6b-58a4-b6cb-8293daf99d74","frontmatter":{"draft":null}},{"id":"eba9aa6a-6e21-5f1b-a0eb-7b6bfb1e04f1","frontmatter":{"draft":null}},{"id":"4efc4f86-56aa-5ff4-8994-3946583906ad","frontmatter":{"draft":null}},{"id":"50d3cc2a-de7a-5b9a-a8d8-754415fe4d94","frontmatter":{"draft":null}},{"id":"84bf9a79-dd68-55d1-a1b3-60ffd3784554","frontmatter":{"draft":null}},{"id":"9f1931f9-74a8-534b-8eab-3952e6520ab8","frontmatter":{"draft":null}},{"id":"32eca2a3-4169-543c-9c2b-2c11988b3ffb","frontmatter":{"draft":null}},{"id":"f920a8a8-f5fe-57c9-8792-95c93d2b74eb","frontmatter":{"draft":null}},{"id":"29b79017-f96d-5b04-8d01-5b8ee761ebed","frontmatter":{"draft":null}},{"id":"49cf25c1-03f6-575e-8c2f-638ccd6198ea","frontmatter":{"draft":null}},{"id":"1162dccb-e1bf-576d-a5c6-0993394feb0a","frontmatter":{"draft":true}},{"id":"7a8fc278-a847-5b68-8b74-a83193ba3f55","frontmatter":{"draft":null}},{"id":"a091877c-69b8-59f9-8963-1af334fd573c","frontmatter":{"draft":null}},{"id":"f0a0e8a2-4d0b-510e-98c2-233ad96f11c2","frontmatter":{"draft":null}},{"id":"4d43646f-8aa6-52b6-b0b6-5160f0be2b05","frontmatter":{"draft":null}},{"id":"871ac696-39ea-5c64-94f3-5dc4b73b5770","frontmatter":{"draft":true}},{"id":"0116f663-28d1-507a-b5ab-b189801dd408","frontmatter":{"draft":true}},{"id":"01deffb8-0d62-54c6-9e41-20832cbc3c6e","frontmatter":{"draft":null}},{"id":"067a602f-4581-5707-b896-73190dd8c889","frontmatter":{"draft":null}},{"id":"0c5568c9-6d87-56ed-ab0e-caeb9c1aafa4","frontmatter":{"draft":null}},{"id":"1086a735-7173-58cc-a813-c540a563aedf","frontmatter":{"draft":false}},{"id":"12222bfa-2e8e-51ee-99d8-8a19902351f5","frontmatter":{"draft":null}},{"id":"1509de3c-7308-5e40-a885-f5ebdb089774","frontmatter":{"draft":null}},{"id":"27f10a38-0ecb-539f-a717-7e40a41bbd10","frontmatter":{"draft":null}},{"id":"2f30c3f1-0d66-590b-8dba-7836df701d46","frontmatter":{"draft":null}},{"id":"3908aafc-c8d3-5c67-821f-0866592449f2","frontmatter":{"draft":true}},{"id":"3a3c4125-9986-53bb-8b96-ae29936c96ab","frontmatter":{"draft":null}},{"id":"3b696b96-130d-50de-a673-dc1367f32387","frontmatter":{"draft":null}},{"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a","frontmatter":{"draft":null}},{"id":"46a22c41-5455-557c-85d4-973a6e2220ee","frontmatter":{"draft":null}},{"id":"48c65a15-67ca-57d0-9edc-ebcb868f7ad2","frontmatter":{"draft":true}},{"id":"4ed3b747-2001-54f4-9661-3acab89ce275","frontmatter":{"draft":null}},{"id":"4edc1b46-b395-5783-af6a-818b8fc9c2dc","frontmatter":{"draft":null}},{"id":"5010f43b-fdb5-5b2b-8f0c-3b7434219588","frontmatter":{"draft":null}},{"id":"50951bb1-eb92-5663-a3d8-8f35f73a1322","frontmatter":{"draft":null}},{"id":"5888c50d-8414-5e8f-b0dc-28a31b29053d","frontmatter":{"draft":null}},{"id":"63f3c7ad-6c59-52b5-9816-78fd348955ff","frontmatter":{"draft":true}},{"id":"69a4aa90-b728-522c-b34f-abee49825c45","frontmatter":{"draft":true}},{"id":"6b318bb6-2c5f-5f38-93c7-5ed1cca1fff8","frontmatter":{"draft":null}},{"id":"73ab4455-f04d-5320-bf3a-90b9f7441d13","frontmatter":{"draft":null}},{"id":"73d6ab42-b3e6-5663-a175-b1f3d69c29e1","frontmatter":{"draft":null}},{"id":"75550af2-8134-5467-a07d-abbb5a4f6b7c","frontmatter":{"draft":true}},{"id":"7778d041-a5bf-536a-a36f-c0dbc5e08ac7","frontmatter":{"draft":true}},{"id":"78349b16-6e41-5fef-ae38-bcdc5ff297ef","frontmatter":{"draft":true}},{"id":"7d6499d9-277c-5f07-b8b1-98ae40c50c42","frontmatter":{"draft":true}},{"id":"7d79eb4b-cd4a-5621-a67a-91d9a24dce05","frontmatter":{"draft":null}},{"id":"82d43655-ea2a-52cd-97a3-16b7b28ad150","frontmatter":{"draft":null}},{"id":"89ddbcc0-ed71-5a69-9d55-9677eab3e6cf","frontmatter":{"draft":null}},{"id":"8b3e46c2-1a1e-5af0-8900-7972c7285d15","frontmatter":{"draft":null}},{"id":"8f7b1b24-7738-5b97-bfb6-fd763f11a664","frontmatter":{"draft":true}},{"id":"961ec1e6-3f2b-59d9-a33f-dad76cf67f47","frontmatter":{"draft":null}},{"id":"97f01467-e3a1-58e1-b2a4-db77354cc1a3","frontmatter":{"draft":null}},{"id":"9f02de74-61a0-5daf-a048-1c1022e08fe4","frontmatter":{"draft":null}},{"id":"9f24363b-ee3e-54bf-8a18-46ea3b269bea","frontmatter":{"draft":null}},{"id":"a190aac4-0483-5e02-b1d3-261f3b5f313a","frontmatter":{"draft":null}},{"id":"a6c64123-b824-5224-8027-90eb12040396","frontmatter":{"draft":null}},{"id":"addc6dab-2819-51f8-a0f5-c48cb138eef1","frontmatter":{"draft":null}},{"id":"b4251348-b618-5b5b-a2c8-e4c6b2431b83","frontmatter":{"draft":true}},{"id":"be594923-185e-5cca-95b6-5267b3c9fc8c","frontmatter":{"draft":null}},{"id":"bfee69af-7d7f-5d87-9680-d2e9b60f8416","frontmatter":{"draft":null}},{"id":"c2249b7b-b97e-5cf4-8ea9-8024e96851b7","frontmatter":{"draft":true}},{"id":"c2db052c-95c6-5094-935b-9eb39f5c762a","frontmatter":{"draft":null}},{"id":"c5e2431a-cf05-5024-b833-e1c69f680d44","frontmatter":{"draft":null}},{"id":"c6def021-b8da-5dbe-ad3e-811d9286424d","frontmatter":{"draft":true}},{"id":"c7a5adfb-149b-5469-ba35-7421e2101951","frontmatter":{"draft":null}},{"id":"cbdf3192-973c-5d87-9cf1-bb9110e9a169","frontmatter":{"draft":null}},{"id":"d29b4513-0609-5cfc-af49-817467dbed1f","frontmatter":{"draft":null}},{"id":"d4d1afa4-f2f9-5942-ae36-2826fb938af5","frontmatter":{"draft":null}},{"id":"db26c6b9-37b4-5cc4-b1ec-c61dc667863e","frontmatter":{"draft":null}},{"id":"dd0c41cf-0a03-5b89-b5a2-f64859aeae63","frontmatter":{"draft":null}},{"id":"e322eac2-bd89-5347-b20d-d050d303a6be","frontmatter":{"draft":null}},{"id":"e376b2d4-df91-5b82-af7a-a8d02763e922","frontmatter":{"draft":true}},{"id":"e4fb8478-b1ad-59eb-95e8-8c5e0500d3f4","frontmatter":{"draft":true}},{"id":"e83330dc-2312-5ae6-95fa-53e86909f42b","frontmatter":{"draft":true}},{"id":"ebae7878-c4ee-505e-81e2-3d3fc47ea826","frontmatter":{"draft":true}},{"id":"ed7af7f9-75f5-59be-9063-de564576eed7","frontmatter":{"draft":true}},{"id":"f06a6ae0-e961-504c-8dab-a60489c0557a","frontmatter":{"draft":true}},{"id":"f5a25ce1-67a6-51b2-9bf1-f9fbacb41ad1","frontmatter":{"draft":true}},{"id":"fd6eab68-17d3-5395-8b2b-54a6efe43ebb","frontmatter":{"draft":null}}]}},"pageContext":{"id":"0bc9da5c-36cb-5e74-8b2f-bf514edbb710"}},"staticQueryHashes":["1800451590","2576926420","63159454"],"slicesMap":{}}