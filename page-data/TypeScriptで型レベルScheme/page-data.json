{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/TypeScriptで型レベルScheme/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://sititou70.github.io"}},"markdownRemark":{"excerpt":"TypeScriptの型システムでSchemeインタプリタを作りました。 リポジトリ Playground できること 趣味のために作ったので実用性は全く考えていませんが、type-challengesをいくつか解くくらいはできます。 Reverse（難易度：Medium） Slice（難易度：Extreme…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/492a7fdcbf45fb86aa5c5085b38e17b1/d35b3/top.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAgT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAcMkMK7CeWf/xAAaEAEAAgMBAAAAAAAAAAAAAAABAAMEERMx/9oACAEBAAEFAu+lyCF1gEPJ/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/AWf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIQISL/2gAIAQEABj8C0xHME1Tr/8QAHBAAAQMFAAAAAAAAAAAAAAAAAQAhMRARQVFx/9oACAEBAAE/IXFjYdBCXpQiNwFSiF//2gAMAwEAAgADAAAAEBMv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EIjH/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EKrX/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBgWHB0f/aAAgBAQABPxAYKByyeoBvVb9NQLNMW/cMVNGLm5zYdS3BJl0+Z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/492a7fdcbf45fb86aa5c5085b38e17b1/f4a91/top.webp 728w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/e8d41/top.webp 1980w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/492a7fdcbf45fb86aa5c5085b38e17b1/83881/top.jpg 728w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/d35b3/top.jpg 1980w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/492a7fdcbf45fb86aa5c5085b38e17b1/83881/top.jpg\"\n            alt=\"実家近くから撮影した初日の入りです。日の出はタイミングを逃してうまく撮れませんでした。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>TypeScriptの型システムで<a href=\"https://ja.wikipedia.org/wiki/Scheme\">Scheme</a>インタプリタを作りました。</p>\n<ul>\n<li><a href=\"https://github.com/sititou70/ts-type-level-scheme\">リポジトリ</a></li>\n<li><a href=\"https://www.typescriptlang.org/play?#code/JYWwDg9gTgLgBDAnmApnA3nAygYwBYohoC+cAZlBCHAEQwDOAtEqowDYoBuKbj9+hFDQDcAKFEs0AMWAAjADwA7OCgAeMFIoAm9OIoCuIWSigA+OAF44AbVFxaxgObBFNADTj7t+-ZpaUZC5CHj42NIGy7rSuALoedj7eobQ4ENruCaHW1jQWUTSubnAADHElcZmJOXlFBVEAjGWNIck5PPTBYQDUUTkRvTSM+YVwjWV9cgNDtSMATDELMZVL9hUJE5FFiksxYhLIaBEA+sWW2AJE8jIKxaamYgD0Dz4AegD8+6jkckf1Z7gES7XeT1O6PZ72d6fQ4-Wb-C4oK5yeSzMGiJ6vD6Sb6yI4AZnhgMRwLxaIxkKxBxxRwALITBEiFDSyRC4FDsccAKz0oHIzkszHQ6kANh5xORwoFFNEQA\">Playground</a></li>\n</ul>\n<h2 id=\"できること\" style=\"position:relative;\"><a href=\"#%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%93%E3%81%A8\" aria-label=\"できること permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>できること</h2>\n<p>趣味のために作ったので実用性は全く考えていませんが、<a href=\"https://github.com/type-challenges/type-challenges/blob/main/README.ja.md\">type-challenges</a>をいくつか解くくらいはできます。</p>\n<h3 id=\"reverse難易度medium\" style=\"position:relative;\"><a href=\"#reverse%E9%9B%A3%E6%98%93%E5%BA%A6medium\" aria-label=\"reverse難易度medium permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/type-challenges/type-challenges/tree/main/questions/03192-medium-reverse\">Reverse（難易度：Medium）</a></h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Scheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ts-type-level-scheme\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Reverse<span class=\"token operator\">&lt;</span>array <span class=\"token keyword\">extends</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"begin\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"reverse\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"null?\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"reverse\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cdr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cons\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"reverse\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> array<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Reverse<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">]</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res = [undefined, null, true, \"a\", 1]</span></code></pre></div>\n<h3 id=\"slice難易度extreme\" style=\"position:relative;\"><a href=\"#slice%E9%9B%A3%E6%98%93%E5%BA%A6extreme\" aria-label=\"slice難易度extreme permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/type-challenges/type-challenges/blob/main/questions/00216-extreme-slice/README.md\">Slice（難易度：Extreme）</a></h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Scheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ts-type-level-scheme\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Slice<span class=\"token operator\">&lt;</span>\n  array <span class=\"token keyword\">extends</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  start <span class=\"token keyword\">extends</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>\n  end <span class=\"token keyword\">extends</span> <span class=\"token builtin\">number</span>\n<span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"begin\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"slice\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"end\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"idx\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"null?\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token string\">\"and\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;=\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"idx\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"idx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"end\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"cdr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"append\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"+\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"idx\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cdr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"+\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"idx\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"slice\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> array<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Slice<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res = [3, 4]</span></code></pre></div>\n<h3 id=\"sort難易度extreme\" style=\"position:relative;\"><a href=\"#sort%E9%9B%A3%E6%98%93%E5%BA%A6extreme\" aria-label=\"sort難易度extreme permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://github.com/type-challenges/type-challenges/blob/main/questions/00741-extreme-sort/README.md\">Sort（難易度：Extreme）</a></h3>\n<p>挿入ソートです。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Scheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ts-type-level-scheme\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Sort<span class=\"token operator\">&lt;</span>array <span class=\"token keyword\">extends</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> desc <span class=\"token keyword\">extends</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"begin\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"sort\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"desc\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"insert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"cond\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"null?\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"append\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"desc\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\">\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">\"append\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"append\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"else\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span>\n              <span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">[</span><span class=\"token string\">\"cdr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">[</span><span class=\"token string\">\"append\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"null?\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cdr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"insert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"car\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rest\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"sort\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"quote\"</span><span class=\"token punctuation\">,</span> array<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> desc<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res1</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Sort<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res1 = []</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res2</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Sort<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res2 = [1]</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res3</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Sort<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res3 = [2, 4, 5, 6, 6, 6, 7, 8, 9]</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res4</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Sort<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res4 = [3, 2, 1]</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">res5</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Sort<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type res5 = [3, 2, 1, 0, 0, 0, 0]</span></code></pre></div>\n<h3 id=\"このように\" style=\"position:relative;\"><a href=\"#%E3%81%93%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB\" aria-label=\"このように permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>このように</h3>\n<p>複雑な型演算であってもSchemeでお手軽に実現できます。</p>\n<h3 id=\"実行時エラー\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC\" aria-label=\"実行時エラー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実行時エラー</h3>\n<p>コードがおかしい場合はそれなりにエラーが返ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Scheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ts-type-level-scheme\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">error1</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span><span class=\"token string\">\"foo\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type error1 = \"Unbound variable: foo\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">error2</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"begin\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type error2 = \"Apply: unknown procedure type\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">error3</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span><span class=\"token keyword\">undefined</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type error3 = \"Eval: unknown expression type\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">error4</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"cond\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type error4 = \"CondToIf: clauses are required\"</span></code></pre></div>\n<p>あくまでそれなりなので、変なエラーや型が返る場合もあります。しょうがないね。</p>\n<h3 id=\"良かった点\" style=\"position:relative;\"><a href=\"#%E8%89%AF%E3%81%8B%E3%81%A3%E3%81%9F%E7%82%B9\" aria-label=\"良かった点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>良かった点</h3>\n<p>まず、自動フォーマットが良かったです。先程のコードはすべてPrettierがフォーマットした結果だったのですが、Schemeのコードとして見てもわりと読みやすいと思います。そのため、コーディングの体験は意外に良かったです。シンボルをいちいちダブルクォートして<code class=\"language-text\">,</code>を打つのは面倒でしたが。</p>\n<p>次に、レキシカルスコープによるブロック構造のありがたみを（改めて）実感しました。ローカルな手続きをブロック内に定義できるのは、素の型パズルと比べるとだいぶ体験が良かったです。</p>\n<h2 id=\"制限\" style=\"position:relative;\"><a href=\"#%E5%88%B6%E9%99%90\" aria-label=\"制限 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>制限</h2>\n<p>以下の特殊形式のみ使用できます。</p>\n<ul>\n<li><code class=\"language-text\">quote</code></li>\n<li><code class=\"language-text\">define</code></li>\n<li><code class=\"language-text\">if</code></li>\n<li><code class=\"language-text\">lambda</code></li>\n<li><code class=\"language-text\">cond</code></li>\n<li><code class=\"language-text\">begin</code></li>\n</ul>\n<p>特に、<code class=\"language-text\">set!</code>、<code class=\"language-text\">set-car!</code>、<code class=\"language-text\">set-cdr!</code>といった、代入を行う特殊形式はサポートしていません。実装が大変そうだったのと、あまり必要になる感じがしなかったからです。</p>\n<p>数値は、0を含む自然数のみ使用できます。<a href=\"https://sititou70.github.io/TypeScript%E3%81%AE%E5%9E%8B%E3%81%A7%E7%B4%A0%E6%95%B0%E3%82%92%E6%B1%82%E3%82%81%E3%81%9F%E3%81%84/\">TypeScriptの型で素数を求めたい</a>で作ったやつを組み込みました。<a href=\"https://sititou70.github.io/TypeScript%E3%81%AE%E5%9E%8B%E3%81%A7%E5%85%A8%E5%8A%A0%E7%AE%97%E5%99%A8%E3%81%8B%E3%82%89%E6%B5%AE%E5%8B%95%E5%B0%8F%E6%95%B0%E7%82%B9%E6%95%B0%EF%BC%8C%E3%81%9D%E3%81%97%E3%81%A6%E2%88%9A2/\">TypeScriptの型で全加算器から浮動小数点数，そして√2</a>では、負の数や小数も作りましたが、そこまでは必要ないだろうと思って組み込みませんでした。</p>\n<p>以下の基本手続きのみ使用できます。</p>\n<ul>\n<li><code class=\"language-text\">+</code></li>\n<li><code class=\"language-text\">-</code></li>\n<li><code class=\"language-text\">*</code></li>\n<li><code class=\"language-text\">/</code></li>\n<li><code class=\"language-text\">remainder</code></li>\n<li><code class=\"language-text\">=</code></li>\n<li><code class=\"language-text\">&lt;</code></li>\n<li><code class=\"language-text\">&lt;=</code></li>\n<li><code class=\"language-text\">></code></li>\n<li><code class=\"language-text\">>=</code></li>\n<li><code class=\"language-text\">and</code></li>\n<li><code class=\"language-text\">or</code></li>\n<li><code class=\"language-text\">null?</code></li>\n<li><code class=\"language-text\">cons</code></li>\n<li><code class=\"language-text\">car</code></li>\n<li><code class=\"language-text\">cdr</code></li>\n<li><code class=\"language-text\">list</code></li>\n<li><code class=\"language-text\">append</code></li>\n</ul>\n<p>TS2589（<code class=\"language-text\">Type instantiation is excessively deep and possibly infinite.</code>）により、あまり重い計算はできません。</p>\n<details>\n<summary>どのくらい重い計算ができるのかやってみます</summary>\n<p>フィボナッチ数を計算してみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Scheme <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ts-type-level-scheme\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Fib<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">extends</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"begin\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"fib\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"n\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"define\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cnt\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"if\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"=\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"+\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"iter\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"n\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token string\">\"fib\"</span><span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">fib_19</span> <span class=\"token operator\">=</span> Scheme<span class=\"token operator\">&lt;</span>Fib<span class=\"token operator\">&lt;</span><span class=\"token number\">19</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//   ^? type fib_19 = 4181</span></code></pre></div>\n<p>19番目のフィボナッチ数までは求められますが、20番目を求めようとするとエラーになります。</p>\n<p>カンですが、主に内部の数値表現がネックになっているっぽいので、2進表現や10進表現を実装すればもっと計算できるようになると思います。カンですが。</p>\n</details>\n<h2 id=\"実装\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E8%A3%85\" aria-label=\"実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装</h2>\n<p><a href=\"https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-4.html\">SICP（計算機プログラムの構造と解釈）</a>のやつを愚直に実装しただけなので、あまり書くことがありません。</p>\n<p>それでも工夫が必要だったのは、環境の参照を実現する部分でした。例えば、クロージャは外側の環境への参照を保持する必要があります。しかし、TSの型システムには型への参照というものがありません（そらそう）。</p>\n<p>したがって、すべての環境を配列として保持し、その添字を参照として扱うことにしました。この配列をevalとapplyで持ち回り、必要なときに参照することにしました。</p>\n<p>これは代入操作を実装しなかった理由にも関係します。例えば<code class=\"language-text\">set-cdr!</code>を導入してしまうと、これを以下のように使うことで循環リストを作れてしまいます。</p>\n<blockquote>\n<div class=\"gatsby-highlight\" data-language=\"scheme\"><pre class=\"language-scheme\"><code class=\"language-scheme\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span>\n  <span class=\"token punctuation\">(</span><span class=\"token function\">last-pair</span> x<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">null?</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">cdr</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    x\n    <span class=\"token punctuation\">(</span><span class=\"token function\">last-pair</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">cdr</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span>\n  <span class=\"token punctuation\">(</span><span class=\"token function\">make-cycle</span> x<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token builtin\">set-cdr!</span> <span class=\"token punctuation\">(</span><span class=\"token function\">last-pair</span> x<span class=\"token punctuation\">)</span> x<span class=\"token punctuation\">)</span>\n  x\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>出典：<a href=\"https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-4.html\">SICP（計算機プログラムの構造と解釈）</a>、練習問題3.12および3.13</p>\n</blockquote>\n<p>しかし前述の通り、内部的に参照を表現するのはちょっと面倒です。おそらくペアを保存するメモリみたいなものを自前で作ってeval、applyで持ち回ればいけると思うのですがヤバいです。</p>\n<p>まぁ代入なんて無くてもプログラミングできるよねってことでサボりました。</p>\n<h2 id=\"感想\" style=\"position:relative;\"><a href=\"#%E6%84%9F%E6%83%B3\" aria-label=\"感想 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>感想</h2>\n<p>2023年12月31日16時くらいからやんわりと書き始め、2024年1月1日15時くらいに完成しました。evalを書きながら年を越したのは初めての体験でしたが、それなりにコードが動いて満足です。</p>\n<p>毎度のことですが、TS2589の限界を突破したりエラーを抑制するために、<a href=\"https://kgtkr.net/blog/2019/04/15/typescript-typelevelprogramming-error-suppression\">kgtkrさんのハック</a>や<a href=\"https://susisu.hatenablog.com/entry/2020/09/12/214343\">susisuさんのハック</a>を使わせていただきました。また、ビルドの設定周りで<a href=\"https://github.com/susisu/typefuck\">susisu/typefuck</a>を参考にさせていただきました。なんか<a href=\"https://susisu.hatenablog.com/entry/2020/03/10/125000\">記事のタイトルまで似てしまいました</a>が、これは偶然です。</p>\n<p>あまり脳を使わずに書いたのでたぶんバグがあります。見つけたらissueとかで教えてもらえると嬉しいです。</p>\n<p>ありがとうございました。</p>","frontmatter":{"title":"TypeScriptで型レベルScheme","date":"2024/01/02"},"fields":{"slug":"/TypeScriptで型レベルScheme/"},"id":"f920a8a8-f5fe-57c9-8792-95c93d2b74eb"},"firstImage":{"imageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#382818","images":{"fallback":{"src":"/static/492a7fdcbf45fb86aa5c5085b38e17b1/44fc8/top.jpg","srcSet":"/static/492a7fdcbf45fb86aa5c5085b38e17b1/e1b40/top.jpg 495w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/66421/top.jpg 990w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/44fc8/top.jpg 1980w","sizes":"(min-width: 1980px) 1980px, 100vw"},"sources":[{"srcSet":"/static/492a7fdcbf45fb86aa5c5085b38e17b1/58e63/top.webp 495w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/30125/top.webp 990w,\n/static/492a7fdcbf45fb86aa5c5085b38e17b1/fa87a/top.webp 1980w","type":"image/webp","sizes":"(min-width: 1980px) 1980px, 100vw"}]},"width":1980,"height":1131}}}},"relatedMarkdownRemarks":{"posts":[{"id":"3a3c4125-9986-53bb-8b96-ae29936c96ab","frontmatter":{"draft":null}},{"id":"29b79017-f96d-5b04-8d01-5b8ee761ebed","frontmatter":{"draft":null}},{"id":"84bf9a79-dd68-55d1-a1b3-60ffd3784554","frontmatter":{"draft":null}},{"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a","frontmatter":{"draft":null}},{"id":"89ddbcc0-ed71-5a69-9d55-9677eab3e6cf","frontmatter":{"draft":null}},{"id":"82d43655-ea2a-52cd-97a3-16b7b28ad150","frontmatter":{"draft":null}},{"id":"5dba01b8-593d-5295-b135-16df1c6295e5","frontmatter":{"draft":null}},{"id":"f49ce388-e81c-5425-af59-9902f125c20f","frontmatter":{"draft":null}},{"id":"0116f663-28d1-507a-b5ab-b189801dd408","frontmatter":{"draft":true}},{"id":"75696ec6-74a3-5046-8a3c-f39b36d92311","frontmatter":{"draft":null}},{"id":"c2db052c-95c6-5094-935b-9eb39f5c762a","frontmatter":{"draft":null}},{"id":"fc7ce496-d3b3-5f39-a04e-8e2dfb960626","frontmatter":{"draft":null}},{"id":"12222bfa-2e8e-51ee-99d8-8a19902351f5","frontmatter":{"draft":null}},{"id":"addc6dab-2819-51f8-a0f5-c48cb138eef1","frontmatter":{"draft":null}},{"id":"97f01467-e3a1-58e1-b2a4-db77354cc1a3","frontmatter":{"draft":null}},{"id":"3d71b3f9-8d6b-58a4-b6cb-8293daf99d74","frontmatter":{"draft":null}},{"id":"c6def021-b8da-5dbe-ad3e-811d9286424d","frontmatter":{"draft":true}},{"id":"0bc9da5c-36cb-5e74-8b2f-bf514edbb710","frontmatter":{"draft":null}},{"id":"871ac696-39ea-5c64-94f3-5dc4b73b5770","frontmatter":{"draft":true}},{"id":"01deffb8-0d62-54c6-9e41-20832cbc3c6e","frontmatter":{"draft":null}},{"id":"067a602f-4581-5707-b896-73190dd8c889","frontmatter":{"draft":null}},{"id":"0c5568c9-6d87-56ed-ab0e-caeb9c1aafa4","frontmatter":{"draft":null}},{"id":"1086a735-7173-58cc-a813-c540a563aedf","frontmatter":{"draft":false}},{"id":"1162dccb-e1bf-576d-a5c6-0993394feb0a","frontmatter":{"draft":true}},{"id":"1509de3c-7308-5e40-a885-f5ebdb089774","frontmatter":{"draft":null}},{"id":"27f10a38-0ecb-539f-a717-7e40a41bbd10","frontmatter":{"draft":null}},{"id":"2cfd9e33-b4e1-53e4-884d-d8a6760f3387","frontmatter":{"draft":true}},{"id":"2f30c3f1-0d66-590b-8dba-7836df701d46","frontmatter":{"draft":null}},{"id":"32eca2a3-4169-543c-9c2b-2c11988b3ffb","frontmatter":{"draft":null}},{"id":"3908aafc-c8d3-5c67-821f-0866592449f2","frontmatter":{"draft":true}},{"id":"3b696b96-130d-50de-a673-dc1367f32387","frontmatter":{"draft":null}},{"id":"46a22c41-5455-557c-85d4-973a6e2220ee","frontmatter":{"draft":null}},{"id":"48c65a15-67ca-57d0-9edc-ebcb868f7ad2","frontmatter":{"draft":true}},{"id":"49cf25c1-03f6-575e-8c2f-638ccd6198ea","frontmatter":{"draft":null}},{"id":"4d43646f-8aa6-52b6-b0b6-5160f0be2b05","frontmatter":{"draft":null}},{"id":"4ed3b747-2001-54f4-9661-3acab89ce275","frontmatter":{"draft":null}},{"id":"4edc1b46-b395-5783-af6a-818b8fc9c2dc","frontmatter":{"draft":null}},{"id":"4efc4f86-56aa-5ff4-8994-3946583906ad","frontmatter":{"draft":null}},{"id":"5010f43b-fdb5-5b2b-8f0c-3b7434219588","frontmatter":{"draft":null}},{"id":"50951bb1-eb92-5663-a3d8-8f35f73a1322","frontmatter":{"draft":null}},{"id":"50d3cc2a-de7a-5b9a-a8d8-754415fe4d94","frontmatter":{"draft":null}},{"id":"5888c50d-8414-5e8f-b0dc-28a31b29053d","frontmatter":{"draft":null}},{"id":"63f3c7ad-6c59-52b5-9816-78fd348955ff","frontmatter":{"draft":true}},{"id":"69a4aa90-b728-522c-b34f-abee49825c45","frontmatter":{"draft":true}},{"id":"6b318bb6-2c5f-5f38-93c7-5ed1cca1fff8","frontmatter":{"draft":null}},{"id":"73ab4455-f04d-5320-bf3a-90b9f7441d13","frontmatter":{"draft":null}},{"id":"73d6ab42-b3e6-5663-a175-b1f3d69c29e1","frontmatter":{"draft":null}},{"id":"75550af2-8134-5467-a07d-abbb5a4f6b7c","frontmatter":{"draft":true}},{"id":"7778d041-a5bf-536a-a36f-c0dbc5e08ac7","frontmatter":{"draft":true}},{"id":"78349b16-6e41-5fef-ae38-bcdc5ff297ef","frontmatter":{"draft":true}},{"id":"7a8fc278-a847-5b68-8b74-a83193ba3f55","frontmatter":{"draft":null}},{"id":"7d6499d9-277c-5f07-b8b1-98ae40c50c42","frontmatter":{"draft":true}},{"id":"7d79eb4b-cd4a-5621-a67a-91d9a24dce05","frontmatter":{"draft":null}},{"id":"8b3e46c2-1a1e-5af0-8900-7972c7285d15","frontmatter":{"draft":null}},{"id":"8f7b1b24-7738-5b97-bfb6-fd763f11a664","frontmatter":{"draft":true}},{"id":"961ec1e6-3f2b-59d9-a33f-dad76cf67f47","frontmatter":{"draft":null}},{"id":"9f02de74-61a0-5daf-a048-1c1022e08fe4","frontmatter":{"draft":null}},{"id":"9f24363b-ee3e-54bf-8a18-46ea3b269bea","frontmatter":{"draft":null}},{"id":"a091877c-69b8-59f9-8963-1af334fd573c","frontmatter":{"draft":null}},{"id":"a190aac4-0483-5e02-b1d3-261f3b5f313a","frontmatter":{"draft":null}},{"id":"a6c64123-b824-5224-8027-90eb12040396","frontmatter":{"draft":null}},{"id":"b4251348-b618-5b5b-a2c8-e4c6b2431b83","frontmatter":{"draft":true}},{"id":"be594923-185e-5cca-95b6-5267b3c9fc8c","frontmatter":{"draft":null}},{"id":"bfee69af-7d7f-5d87-9680-d2e9b60f8416","frontmatter":{"draft":null}},{"id":"c2249b7b-b97e-5cf4-8ea9-8024e96851b7","frontmatter":{"draft":true}},{"id":"c5e2431a-cf05-5024-b833-e1c69f680d44","frontmatter":{"draft":null}},{"id":"c7a5adfb-149b-5469-ba35-7421e2101951","frontmatter":{"draft":null}},{"id":"cbdf3192-973c-5d87-9cf1-bb9110e9a169","frontmatter":{"draft":null}},{"id":"d29b4513-0609-5cfc-af49-817467dbed1f","frontmatter":{"draft":null}},{"id":"d4d1afa4-f2f9-5942-ae36-2826fb938af5","frontmatter":{"draft":null}},{"id":"db26c6b9-37b4-5cc4-b1ec-c61dc667863e","frontmatter":{"draft":null}},{"id":"dd0c41cf-0a03-5b89-b5a2-f64859aeae63","frontmatter":{"draft":null}},{"id":"e322eac2-bd89-5347-b20d-d050d303a6be","frontmatter":{"draft":null}},{"id":"e376b2d4-df91-5b82-af7a-a8d02763e922","frontmatter":{"draft":true}},{"id":"e4fb8478-b1ad-59eb-95e8-8c5e0500d3f4","frontmatter":{"draft":true}},{"id":"e83330dc-2312-5ae6-95fa-53e86909f42b","frontmatter":{"draft":true}},{"id":"eba9aa6a-6e21-5f1b-a0eb-7b6bfb1e04f1","frontmatter":{"draft":null}},{"id":"ebae7878-c4ee-505e-81e2-3d3fc47ea826","frontmatter":{"draft":true}},{"id":"ed7af7f9-75f5-59be-9063-de564576eed7","frontmatter":{"draft":true}},{"id":"f06a6ae0-e961-504c-8dab-a60489c0557a","frontmatter":{"draft":true}},{"id":"f0a0e8a2-4d0b-510e-98c2-233ad96f11c2","frontmatter":{"draft":null}},{"id":"f5a25ce1-67a6-51b2-9bf1-f9fbacb41ad1","frontmatter":{"draft":true}},{"id":"fd6eab68-17d3-5395-8b2b-54a6efe43ebb","frontmatter":{"draft":null}}]}},"pageContext":{"id":"f920a8a8-f5fe-57c9-8792-95c93d2b74eb"}},"staticQueryHashes":["1800451590","2576926420","63159454"],"slicesMap":{}}