{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/Gitの内部表現から理解するSquash/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://sititou70.github.io"}},"markdownRemark":{"excerpt":"コミットはスナップショットであり差分ではないとすると、Squashは何をしているのでしょうか。 コミット（スナップショット）を「まとめる」とは具体的にどのような操作を指すのか、詳しく見ていきます。 おさらい：Gitの内部表現 Gitの内部表現についてざっくり思い出します。Gitオブジェクトは以下の…","html":"<p><a href=\"https://github.blog/jp/2021-01-06-commits-are-snapshots-not-diffs/\">コミットはスナップショットであり差分ではない</a>とすると、Squashは何をしているのでしょうか。</p>\n<p>コミット（スナップショット）を「まとめる」とは具体的にどのような操作を指すのか、詳しく見ていきます。</p>\n<h2 id=\"おさらいgitの内部表現\" style=\"position:relative;\"><a href=\"#%E3%81%8A%E3%81%95%E3%82%89%E3%81%84git%E3%81%AE%E5%86%85%E9%83%A8%E8%A1%A8%E7%8F%BE\" aria-label=\"おさらいgitの内部表現 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おさらい：Gitの内部表現</h2>\n<p>Gitの内部表現についてざっくり思い出します。Gitオブジェクトは以下の4種類です。</p>\n<ul>\n<li>コミット：ある時点におけるリポジトリ内のコンテンツのスナップショット</li>\n<li>ツリー：ディレクトリ</li>\n<li>ブロブ：ファイル</li>\n<li>タグ：今回は関係なし</li>\n</ul>\n<p>まず、以下のコマンドでサンプルリポジトリを作成します。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> sample-repo\n<span class=\"token builtin class-name\">cd</span> sample-repo\n\n<span class=\"token function\">git</span> init\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"sample 1\"</span> <span class=\"token operator\">></span> sample.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"sample commit 1\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"sample 2\"</span> <span class=\"token operator\">>></span> sample.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"sample commit 2\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"sample 3\"</span> <span class=\"token operator\">>></span> sample.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"sample commit 3\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span></code></pre></div>\n<h3 id=\"練習1最新のsampletxtを取り出す\" style=\"position:relative;\"><a href=\"#%E7%B7%B4%E7%BF%921%E6%9C%80%E6%96%B0%E3%81%AEsampletxt%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99\" aria-label=\"練習1最新のsampletxtを取り出す permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>練習1：最新の<code class=\"language-text\">sample.txt</code>を取り出す</h3>\n<p>ここから、Gitのコマンドを使用せずに最新の<code class=\"language-text\">sample.txt</code>を取り出してみます。事前に<a href=\"https://github.com/kevin-cantwell/zlib/releases\">zlibコマンド</a>をインストールしておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># masterブランチの最新のコミットのハッシュを得る</span>\n$ <span class=\"token function\">cat</span> .git/refs/heads/master\n74baa8be92503f4f88a4bd8edf2dd821b580e2ad\n\n<span class=\"token comment\"># コミットを表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/74/baa8be92503f4f88a4bd8edf2dd821b580e2ad zlib <span class=\"token parameter variable\">-d</span>\ncommit 1099tree ed176cbfe8f1eb764d312dcb9c7cee15b07a2a9f\nparent 6650da2873ce75b26e00e012d0c870756f487b4d\n<span class=\"token comment\"># ...省略...</span>\nsample commit <span class=\"token number\">3</span>\n\n<span class=\"token comment\"># 上記のコミットが指すツリー（tree ed176cbf...）を表示。これはリポジトリのルートディレクトリ</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/ed/176cbfe8f1eb764d312dcb9c7cee15b07a2a9f zlib <span class=\"token parameter variable\">-d</span> <span class=\"token operator\">|</span> xxd\n00000000: <span class=\"token number\">7472</span> <span class=\"token number\">6565</span> <span class=\"token number\">2033</span> <span class=\"token number\">3800</span> <span class=\"token number\">3130</span> <span class=\"token number\">3036</span> <span class=\"token number\">3434</span> <span class=\"token number\">2073</span>  tree <span class=\"token number\">38.100644</span> s\n00000010: 616d 706c 652e <span class=\"token number\">7478</span> <span class=\"token number\">7400</span> c5c9 c6c1 c47c  ample.txt<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token operator\">|</span>\n00000020: <span class=\"token number\">6545</span> ef2d cf29 e736 40d3 <span class=\"token number\">8608</span> <span class=\"token number\">2790</span>       eE.-.<span class=\"token punctuation\">)</span>.6@<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">\\</span>'.\n\n<span class=\"token comment\"># sample.txtのブロブ（上記のsample.txt\\0のあとに続くc5c9 c6c1...）を表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/c5/c9c6c1c47c6545ef2dcf29e73640d386082790 zlib <span class=\"token parameter variable\">-d</span>\nblob 27sample <span class=\"token number\">1</span>\nsample <span class=\"token number\">2</span>\nsample <span class=\"token number\">3</span></code></pre></div>\n<p>はい、取り出せました！それぞれのオブジェクトを図に表すと以下のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 498px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/39a147beb4e94bc96f027ccb4b55038a/5ae27/sample_repo1_graph1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 156.425702811245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFm0lEQVR42p1We1CUVRT/zJjpDycf2aQmD0tRUtFMy1TyhQtoxVCWKL4VzcmZbJzUmqbGsjJ8IhIL+ITdRUBkeQiCxFt0QOWhKCAOynMRVkRJhH38Oufug11T/+ib+XHOPffc3/e75567fBLoMRiNAv/3MdBSvXm9ZA3qdOjp7kbvkyfQ9ZjQQz6P2erMvi16zNDreq3kgvBqUwtmxKRgvCIJExRqjItKhFu0Gu40nkhwVyaJ8XiFWuS40TznmeaTMVWZjLy6+j7CzZn5kEIUeFuZAmdOSMjEu/HnMEqRAqfoJBGfn5IN15hUjCJ/dtLfmEzzztHJGHEyEdLeY/BXZ/YRBmbko5/8FNxiztLiZEyKS4d7XJpIZsJhZF1VqXA7dRbjCdPPZGIc2TFE7kjzUnAU/KyERgPWpOfCISIO75/OwLSEDLjHpmFARCzmJ2djVmKWUDsj8bwgcoxSC4J+oUpIf6nQPywG0qFo+CZmmAiba6qxJD4VUqgKg4+exhsnEoWigeQPP6kWeJNIxqh4u8kYdCwBA47EwyE8FhKR9aed2RHyn7W05SEnzmAu1WYKqfmQ1MwkDKXFXAYPdZaALCVH2DmU9woTssJnEa4315Dr50KHMlzUTo2BpORVAisUB0b1GktKh9CLXj9+Bg605mUmDHmKcEtmgajLBKodq5hKtRxLypxo+4Mi4+F6Kg3zqJ6TYtMxmogdqDyO9FKHw0q8RN0h7TmGgCSbU65t18I/+Tw849OwgOCTcA5ep9OF702+Z2wq5hJkFOO4N8His/UjdeXNrSZCI10ZPd8dglFnAAhGnV74xl6dSCq/WobSkiumG9Wjt+ZZoaera6B84pJeeEcpiZ/SK8UoKsy1iz3vkfR6PXaGnsWSrSexfJsCAYztCiw3g8f+NLdsW7SIB5BdQXblDiVWfa/E6h9UWPZdNHbsV6Prn27qw1YtRnrugotPEMZ8sldYJ68/MWphEBy9dsPN9wBcP92Hsb774eIdhNEfm3JGeP6OQTN3YojHLxhI9rVZP6GiugFSY0s7Jny2Dx+tCcf89ZGQbTyKxVsVWPj1cfhticLS7THwDDwiYos2Hxdxzp30RTCGzd0FJ9kfcCYBzrLfTITNGi2p2INpyw7DY7Ucs1bJMXNVGKYtPYx3/A7gPf8QfBAQircWBWHi5wcF2ey1EZgXGIk5ZN0XH8RI2W64EOG16kZITZp2seWpS0Ph+w1d8m8VRCinF4QKwukrwogkQqiY/OUhzFgpx5QlIeLFc9ZGEmEwBnv8iqEeP6O8qh5ST08vNu+Kw7x1YVgQKIdsgxzeG8PhRfDZFCH8BevDsGhTJHy+oviGcNN8YLjIXWjOWfejEh2dXea24Z9vo94MgxnUbwZTH1ZWXsO1ijJTqkHPzWMHkWc0WBoboiFNvH0NylanMxEWFhYiI8N0Vzlmm2O71q6xu7q60NraCu39+2jXatFO11ErbDtaWjTQaFpxn+faTbG2tja0mecePXpk/z+Fme/du4e7d+/i8uXLKC8vR0VFBcrKylBbW4vr16/j1q1bKC0tFX5VVZUYV1dXC+Lm5mZ7wt7eXqGmrq4OeXl5uHTpEvLz85GbmyuIL168iOLiYuTk5Ih5BpNzHhO2tLRYty5Z6sLbuH37tlicmpoq6lZUVCTU3Lx5Ew0NDaIsDx48EGABDC4DK3wmYWNjI0pKSoQCVsTbZ9VMyoQWIibp6OgQeCEhKywoKEBCQoLYLvuVlZW4ceMG6uvr0dnZaSW0xXMJWQXX5sKFC0IhHw4fVE1NjVjECp8meyYh/4RZFGZnZ0OlUiErK0scAivkk71z5w4ePnxot10Lmpqa+ggtDr+d1XDNuFW4Ldhn1QxWodFo/gOOcxns2sbSi0/ow6ebPpgY7NuOHz9+/FwYbb7c/gVup7RfL7elSwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39a147beb4e94bc96f027ccb4b55038a/26350/sample_repo1_graph1.webp 498w\"\n              sizes=\"(max-width: 498px) 100vw, 498px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39a147beb4e94bc96f027ccb4b55038a/5ae27/sample_repo1_graph1.png 498w\"\n            sizes=\"(max-width: 498px) 100vw, 498px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39a147beb4e94bc96f027ccb4b55038a/5ae27/sample_repo1_graph1.png\"\n            alt=\"矩形が縦に3つ並んでいる。一番上の矩形には「[commit(74baa8b)] tree ed176cb parent 6650da2 sample commit 3」と書かれている。そこから1つ下の矩形に矢印が伸びており、その矩形には「[tree(ed176cb)] sample.txt c5c9c6c」と書かれている。そこからさらに下の矩形へ矢印が伸びており、その矩形には「[blob(c5c9c6c)] sample 1 sample 2 sample 3」と書かれている。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ちなみに、それぞれのオブジェクトのハッシュは、そのsha1sumになっています。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># コミット</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/74/baa8be92503f4f88a4bd8edf2dd821b580e2ad zlib <span class=\"token parameter variable\">-d</span> <span class=\"token operator\">|</span> sha1sum\n74baa8be92503f4f88a4bd8edf2dd821b580e2ad  -\n\n<span class=\"token comment\"># ツリー</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/ed/176cbfe8f1eb764d312dcb9c7cee15b07a2a9f zlib <span class=\"token parameter variable\">-d</span> <span class=\"token operator\">|</span> sha1sum\ned176cbfe8f1eb764d312dcb9c7cee15b07a2a9f  -\n\n<span class=\"token comment\"># ブロブ</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/c5/c9c6c1c47c6545ef2dcf29e73640d386082790 zlib <span class=\"token parameter variable\">-d</span> <span class=\"token operator\">|</span> sha1sum\nc5c9c6c1c47c6545ef2dcf29e73640d386082790  -</code></pre></div>\n<h3 id=\"練習2最古のsampletxtを取り出す\" style=\"position:relative;\"><a href=\"#%E7%B7%B4%E7%BF%922%E6%9C%80%E5%8F%A4%E3%81%AEsampletxt%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99\" aria-label=\"練習2最古のsampletxtを取り出す permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>練習2：最古の<code class=\"language-text\">sample.txt</code>を取り出す</h3>\n<p>同じように、最も古い<code class=\"language-text\">sample.txt</code>を取り出してみます。まず最も古いコミットを見つけ出し、そこから同じようにツリー、ブロブへとたどっていきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># masterブランチの最新のコミットのハッシュを得る</span>\n$ <span class=\"token function\">cat</span> .git/refs/heads/master\n74baa8be92503f4f88a4bd8edf2dd821b580e2ad\n\n<span class=\"token comment\"># 最新のコミットを表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/74/baa8be92503f4f88a4bd8edf2dd821b580e2ad zlib <span class=\"token parameter variable\">-d</span>\ncommit 1099tree ed176cbfe8f1eb764d312dcb9c7cee15b07a2a9f\nparent 6650da2873ce75b26e00e012d0c870756f487b4d\n<span class=\"token comment\"># ...省略...</span>\nsample commit <span class=\"token number\">3</span>\n\n<span class=\"token comment\"># 上記の親のコミット（parent 6650da28...）を表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/66/50da2873ce75b26e00e012d0c870756f487b4d zlib <span class=\"token parameter variable\">-d</span>\ncommit 1099tree 73fd41472a3ba54da4d31f20ae22b8cf1c5460ea\nparent 96cf46184f9cd93945a0a0a4fefec137bf071fcc\n<span class=\"token comment\"># ...</span>\nsample commit <span class=\"token number\">2</span>\n\n<span class=\"token comment\"># 上記の親のコミット（parent 96cf4618...）を表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/96/cf46184f9cd93945a0a0a4fefec137bf071fcc zlib <span class=\"token parameter variable\">-d</span>\ncommit 1051tree 5dbf6b90bea3fd0c027fd0b1373fb131b49dc796\n<span class=\"token comment\"># 最初のコミットなのでparentの行が無い</span>\n<span class=\"token comment\"># ...</span>\nsample commit <span class=\"token number\">1</span>\n\n<span class=\"token comment\"># 上記のコミットが指すツリー（tree 5dbf6b90...）を表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/5d/bf6b90bea3fd0c027fd0b1373fb131b49dc796 zlib <span class=\"token parameter variable\">-d</span> <span class=\"token operator\">|</span> xxd\n00000000: <span class=\"token number\">7472</span> <span class=\"token number\">6565</span> <span class=\"token number\">2033</span> <span class=\"token number\">3800</span> <span class=\"token number\">3130</span> <span class=\"token number\">3036</span> <span class=\"token number\">3434</span> <span class=\"token number\">2073</span>  tree <span class=\"token number\">38.100644</span> s\n00000010: 616d 706c 652e <span class=\"token number\">7478</span> <span class=\"token number\">7400</span> dccd 42c5 <span class=\"token number\">8140</span>  ample.txt<span class=\"token punctuation\">..</span>.B<span class=\"token punctuation\">..</span>@\n00000020: 3fec 2ecf d3c3 e75c fff6 a744 667d       ?<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span>.Df<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># sample.txtのブロブ（上記のsample.txt\\0のあとに続くdccd 42c5...）を表示</span>\n$ <span class=\"token operator\">&lt;</span>.git/objects/dc/cd42c581403fec2ecfd3c3e75cfff6a744667d zlib <span class=\"token parameter variable\">-d</span>\nblob 9sample <span class=\"token number\">1</span></code></pre></div>\n<p>よし、取り出せました。</p>\n<p>各オブジェクトの参照の関係を図に表すと以下のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a450378c329ed6f22859885ac10e2b9/959db/sample_repo1_graph2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.58791208791209%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVR42n2ST0iTcRjH35PRNUoq6NBBopJAwijpENSlS10yk6ioU3RTojLokEVZkqWmTdDMslIp3Zziv5ySHSJF3dSpU+e7zf1127u5dzmd8On3vt574OH58+H7PL8fv5+U3EwTUJOEkn91DwuPpzbQbDocpVdeYcDlZdDto8+1gm01qrPxYFhn/YJZPBrzMh+NIRWNjLKn8TtHv3ZxWPjeD+3ktnaTTqUo6PlJpqi1fnZLNzvqWjnb3o+aTHLOOMD+pg4OfTFzRPCMuhYK+0aQblt+s6vhG1nNnbpQqvnMwfo2YpEIF00/yDC0sFvwfU1GpIomTn0yEgqtcrq1h51iQWZjOwc+mpDKG7jcaUFaiscZ9Prpc8p0zjoY9gcZXw3r1xrweDHMOKiemKJ6zEqFbRbzsltnWjTYHVT8maTOZqfcOoNlxY9U2/yL4qcmHpabuV9mpEjkD152EYqsUfl+mHvPTJSUid7zDopLjTyp6mVNXae0soeSF0LzrENEE0WP23ldP4R081Ebx/IrOXG1hpPX3ul5TkEVS+4Q+XebyblSpdd5NwxkX3pD3vVaAuE4Z24ZdM3xwrfkiph14RXn7zQghZUEHn+UhWUfVvsibl8EX1DRr6Wd0uNXBPMyNesUeYSgGKaZP6TgFjqtP7foweUNE46uIalqgsnxMaanrDgcc8jORRJr2yItTghms07gmLfjkp0kk6rOYrGo6I8zNzuDc2kBj1smlVpHSonvIcsufD4/iqIQE4+UFN9CM0WJYRkawmq1EQyGdI/Ht5cFAgHM5i5GR8eIRKI6S6gqEv+xra0t0uk0m5ubbGxsoC3Xas1UIZZlWR+sLdEOo/F/13+KxBLGdckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7a450378c329ed6f22859885ac10e2b9/f4a91/sample_repo1_graph2.webp 728w,\n/static/7a450378c329ed6f22859885ac10e2b9/0b22e/sample_repo1_graph2.webp 1572w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7a450378c329ed6f22859885ac10e2b9/beb58/sample_repo1_graph2.png 728w,\n/static/7a450378c329ed6f22859885ac10e2b9/959db/sample_repo1_graph2.png 1572w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7a450378c329ed6f22859885ac10e2b9/beb58/sample_repo1_graph2.png\"\n            alt=\"矩形が3×3のグリッド状に並んでいる。一番右上の矩形には「[commit(74baa8b)] tree ed176cb parent 6650da2 sample commit 3」と書かれている。そこから1つ下の矩形に矢印が伸びており、その矩形には「[tree(ed176cb)] sample.txt c5c9c6c」と書かれている。そこからさらに下の矩形へ矢印が伸びており、その矩形には「[blob(c5c9c6c)] sample 1 sample 2 sample 3」と書かれている。一番右上の矩形から1つ左の矩形に矢印が伸びており、「[commit(6650da2)] tree 73fd414 parent 96cf461 sample commit 2」と書かれている。そこから1つ下の矩形に矢印が伸びており、その矩形には「[tree(73fd414)] sample.txt 89db1e9」と書かれている。そこからさらに下の矩形へ矢印が伸びており、その矩形には「[blob(89db1e9)] sample 1 sample 2」と書かれている。右から2つ目のコミットからは、1つ左の矩形に矢印が伸びており、「[commit(96cf461)] tree 5dbf6b9 sample commit 1」と書かれている。そこから1つ下の矩形に矢印が伸びており、その矩形には「[tree(5dbf6b9)] sample.txt dccd42c」と書かれている。そこからさらに下の矩形へ矢印が伸びており、その矩形には「[blob(dccd42c)] sample 1」と書かれている。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"squashしてみる\" style=\"position:relative;\"><a href=\"#squash%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-label=\"squashしてみる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Squashしてみる</h2>\n<p>それではSquashしてみます。以下を実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">git</span> rebase <span class=\"token parameter variable\">-i</span> HEAD^^</code></pre></div>\n<p>するとエディタが開くので以下のようにして保存し閉じます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pick 6650da2 sample commit 2\nsquash 74baa8b sample commit 3</code></pre></div>\n<p>Squashによって新たに作成されるコミットのメッセージを編集するエディタが開くので、よしなに編集して保存して閉じます。</p>\n<p><code class=\"language-text\">git log</code>すると、たしかに<code class=\"language-text\">sample commit 2</code>と<code class=\"language-text\">sample commit 3</code>がまとめられているように見えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">commit a7e076b007b00e903f9ddac603770995fdd94923 (HEAD -> master)\nAuthor: Takuya Shizukuishi &lt;sititou70@gmail.com>\nDate:   Mon Mar 25 16:43:44 2024 +0900\n\n    sample commit 2\n    sample commit 3\n\ncommit 96cf46184f9cd93945a0a0a4fefec137bf071fcc\nAuthor: Takuya Shizukuishi &lt;sititou70@gmail.com>\nDate:   Mon Mar 25 16:43:40 2024 +0900\n\n    sample commit 1</code></pre></div>\n<p>新しく作成された最新のコミットの中身を見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token operator\">&lt;</span>.git/objects/a7/e076b007b00e903f9ddac603770995fdd94923 zlib <span class=\"token parameter variable\">-d</span>\ncommit 1116tree ed176cbfe8f1eb764d312dcb9c7cee15b07a2a9f\nparent 96cf46184f9cd93945a0a0a4fefec137bf071fcc\n<span class=\"token comment\"># ...</span>\nsample commit <span class=\"token number\">2</span>\nsample commit <span class=\"token number\">3</span></code></pre></div>\n<p><code class=\"language-text\">tree ed176cbf</code>には見覚えがありますね。今回のSquash前後のオブジェクトを図に表すと以下のようになります。</p>\n<p>Squash前：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a450378c329ed6f22859885ac10e2b9/959db/sample_repo1_graph2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.58791208791209%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVR42n2ST0iTcRjH35PRNUoq6NBBopJAwijpENSlS10yk6ioU3RTojLokEVZkqWmTdDMslIp3Zziv5ySHSJF3dSpU+e7zf1127u5dzmd8On3vt574OH58+H7PL8fv5+U3EwTUJOEkn91DwuPpzbQbDocpVdeYcDlZdDto8+1gm01qrPxYFhn/YJZPBrzMh+NIRWNjLKn8TtHv3ZxWPjeD+3ktnaTTqUo6PlJpqi1fnZLNzvqWjnb3o+aTHLOOMD+pg4OfTFzRPCMuhYK+0aQblt+s6vhG1nNnbpQqvnMwfo2YpEIF00/yDC0sFvwfU1GpIomTn0yEgqtcrq1h51iQWZjOwc+mpDKG7jcaUFaiscZ9Prpc8p0zjoY9gcZXw3r1xrweDHMOKiemKJ6zEqFbRbzsltnWjTYHVT8maTOZqfcOoNlxY9U2/yL4qcmHpabuV9mpEjkD152EYqsUfl+mHvPTJSUid7zDopLjTyp6mVNXae0soeSF0LzrENEE0WP23ldP4R081Ebx/IrOXG1hpPX3ul5TkEVS+4Q+XebyblSpdd5NwxkX3pD3vVaAuE4Z24ZdM3xwrfkiph14RXn7zQghZUEHn+UhWUfVvsibl8EX1DRr6Wd0uNXBPMyNesUeYSgGKaZP6TgFjqtP7foweUNE46uIalqgsnxMaanrDgcc8jORRJr2yItTghms07gmLfjkp0kk6rOYrGo6I8zNzuDc2kBj1smlVpHSonvIcsufD4/iqIQE4+UFN9CM0WJYRkawmq1EQyGdI/Ht5cFAgHM5i5GR8eIRKI6S6gqEv+xra0t0uk0m5ubbGxsoC3Xas1UIZZlWR+sLdEOo/F/13+KxBLGdckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7a450378c329ed6f22859885ac10e2b9/f4a91/sample_repo1_graph2.webp 728w,\n/static/7a450378c329ed6f22859885ac10e2b9/0b22e/sample_repo1_graph2.webp 1572w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7a450378c329ed6f22859885ac10e2b9/beb58/sample_repo1_graph2.png 728w,\n/static/7a450378c329ed6f22859885ac10e2b9/959db/sample_repo1_graph2.png 1572w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7a450378c329ed6f22859885ac10e2b9/beb58/sample_repo1_graph2.png\"\n            alt=\"練習2で示した図と同様\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Squash後：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/959db/sample_repo1_graph3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.58791208791209%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVR42pWSyWtTURjF39aV4sKdoEWXYhFxWNg/wIU7LUURdSEOi4qCdCUKKnFRaYtjiS0YQTsSm04LaWoLDiTUtukQ0hhfEpuXtC/v5SUvQ83w8yaGKjgUPzhw+O495x6+70p+3WAsFGHiq1LBW4FPMZU/VWmdlLC4Zjnz5h0XnB+4PP6RhtFJrHM+pPNj79nU3kXNiwFqbAOCd7OrsxdN08ik06RME7OKVMqs9NREgiM9I2zp6GOn0O0QkNps1A+NI12bdLP9uZ09r4bY2zXMZmsv+14OksvlKBaL5AsFClXk83lKomdmc9T1jLJV3N3W0V8xlZo7qXc4kdL5b6zmsgR1DV9UQV3LYQhsVMNymKcLPlpc07R7FrBMz+NcVpBabRNcvNXPVYudxtt9Fd54146RzFTHVfo5wyo3M2vcbBmh6Z6D63f6abK85orQ3beKhOdudFN7opVDpx5x+PRjwduoPd6Csmr81VDVTerOPuGg0OxveMCBkw/ZfayZo5eeIal6irCisfQlwsyCn1AkTiSm84vP79sWZ8qKTkjoPIsBvP4wwWUVVUsimWaK6Sk3c54ZfD4vcsCPmUr+w+zHS4mEzuzMFN7FeQKflwiHZLHILFJ5m7IcJBJR0HWdhGGQzmQ2NIxGozgcg7hcbuJxjVhspfLFJP6z1hcjxLIsV4wNEaIcphzuO7vqt9/u5Mj1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/f4a91/sample_repo1_graph3.webp 728w,\n/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/0b22e/sample_repo1_graph3.webp 1572w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/beb58/sample_repo1_graph3.png 728w,\n/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/959db/sample_repo1_graph3.png 1572w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a0a867a3b943ff4f1b1ad7c38ae4a2df/beb58/sample_repo1_graph3.png\"\n            alt=\"一番右上には矩形があり、「[commit(a7e076b)] tree ed176cb parent 96cf461 sample commit 3 sample commit 2」と書かれている。そこから下に矢印が出て「[tree(ed176cb)] sample.txt c5c9c6c」と書かれた矩形を指している。その矩形から更に下へ矢印が出て「[blob(c5c9c6c)] sample 1 sample 2 sample 3」と書かれた矩形を指している。右上の矩形から左に矢印が出て「[commit(96cf461)] tree 5dbf6b9 sample commit 1」と書かれた矩形を指している。その矩形から下に矢印が出て「[tree(5dbf6b9)] sample.txt dccd42c」と書かれた矩形を指している。その矩形から更に下家矢印が出て「[blob(dccd42c)] sample 1」と書かれた矩形を指している。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>唯一変化した、右上のa7e076bというコミットオブジェクトに注目します。parentは、Squash前は「sample commit 2」のコミットを指していましたが、Squash後は1つ前の「sample commit 1」を指しています。これは、単方向リストから要素を削除する操作に似ています。</p>\n<p>また、コミットメッセージがSquash対象のメッセージをつなげたものに変化しています。親との差分を考えると妥当ですね。</p>\n<p>逆に言うと、Squashによって変わったのはこの2点だけです。例えば、ed176cbのツリーはSquash前後で変化していません。Squash前後でリポジトリ内のコンテンツが変化していないため当たり前です。</p>\n<h2 id=\"squashマージ\" style=\"position:relative;\"><a href=\"#squash%E3%83%9E%E3%83%BC%E3%82%B8\" aria-label=\"squashマージ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Squashマージ</h2>\n<p>以下のスクリプトで通常のマージとSquashマージを比較します。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> sample-repo\n<span class=\"token builtin class-name\">cd</span> sample-repo\n\n<span class=\"token function\">git</span> init\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"initial\"</span> <span class=\"token operator\">></span> master.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"initial commit\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token function\">git</span> switch <span class=\"token parameter variable\">-c</span> feature\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"feature 1\"</span> <span class=\"token operator\">></span> feature.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"feature 1\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"feature 2\"</span> <span class=\"token operator\">>></span> feature.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"feature 2\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token function\">git</span> switch master\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"master 1\"</span> <span class=\"token operator\">>></span> master.txt\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"master 1\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">1</span>\n\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-r</span> sample-repo sample-repo-merge\n<span class=\"token builtin class-name\">cd</span> sample-repo-merge\n\n<span class=\"token function\">git</span> merge --no-edit feature\n\n<span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span>\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-r</span> sample-repo sample-repo-squash-merge\n<span class=\"token builtin class-name\">cd</span> sample-repo-squash-merge\n\n<span class=\"token function\">git</span> merge <span class=\"token parameter variable\">--squash</span> feature\n<span class=\"token function\">git</span> commit --no-edit</code></pre></div>\n<p>通常のマージを行った方の最新のコミットを見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">cat</span> .git/refs/heads/master\n6f6015e406a8e6df565442b40ff251df37daad6b\n$ <span class=\"token operator\">&lt;</span>.git/objects/6f/6015e406a8e6df565442b40ff251df37daad6b zlib <span class=\"token parameter variable\">-d</span>\ncommit 1154tree 9aaa8e3177b4053645ebb3971fcf719cfd577f91\nparent 2a87a08640d13b2433d07af6411c61974385dc3f\nparent d8e2caec977741c2112313a0cd871ad20a34e500\n<span class=\"token comment\"># ...</span>\nMerge branch <span class=\"token string\">'feature'</span></code></pre></div>\n<p>Squashマージの方の最新のコミットを見てみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">cat</span> .git/refs/heads/master\nd230284bac79100b48c4635dd38087ad494f4b2c\n$ <span class=\"token operator\">&lt;</span>.git/objects/d2/30284bac79100b48c4635dd38087ad494f4b2c zlib <span class=\"token parameter variable\">-d</span>\ncommit 1421tree 9aaa8e3177b4053645ebb3971fcf719cfd577f91\nparent 2a87a08640d13b2433d07af6411c61974385dc3f\n<span class=\"token comment\"># ...</span>\nSquashed commit of the following:\n<span class=\"token comment\"># ...コミットメッセージが続く...</span></code></pre></div>\n<p>先ほどと同様、両者の違いはparentとコミットメッセージのみです。通常マージの方はparentが2つ記録されていますが、Squashマージの方は1つしか記録されていません。</p>\n<p>図に表すと以下のようになります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66ff6afb142162d96a92fa10ed6c3906/6448e/sample_repo2_graph1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.04945054945055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4ElEQVR42m2Ry2sTYRTFBwRRQf8BNy5duXEjiFW3oriIIrgoLa4Kigj+Ad1VCu3CimkJaKUlsTWSljgxJakmk/Sl+IzpIy+bV1s1OmmaNOlMMj9nJi1U4oHDd+/3XQ7n3E8YXkwwspTE9i1GXN7EQEPT0GhCbTR4mVg1Zxwr381zW1GZSufp9M9yL/Se28F33PCG6PsYRThkdXBwYAShZ4hun6QrKJQqFSo6lVqV/O8/nHji5Mjgc4SH+lz/U0KxJN3Beb0f5fiwi2PG2wMbbQ4RoWN6lq7AAtdeS7z4EtXt1akpCqqqotXrVHYU7usu2n0zWDwBrnslUj9/Yf3wlTNuP5e8AS64fZxyebn1dg7BiKVpzYClcpk7b+a46pG4/CrAxQk/bj3uXT2SxRPk5lQYixggHEsgyyUeOefps0v0Ppum3x4mklxH0HZ3ZmCrtsPZMZGjtnEO7MbrkRY4bXdzeGgMYWDUvBOX4+SzG7R1WDnX/pjznYOcvNKLKC02He7BcDqT/8FkMmPSlUiT26og5db1Po1zJcVEfJWN4iZFWaZYKrNdVUxWayoN/QP/Efwf9tZhIJdMsPz5E0vRKJFIhGwm0zLfImjE309tX51bWyMWj5NKpchmsxQKhRbBv3wrG6HR/PgAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/66ff6afb142162d96a92fa10ed6c3906/f4a91/sample_repo2_graph1.webp 728w,\n/static/66ff6afb142162d96a92fa10ed6c3906/b67b4/sample_repo2_graph1.webp 1894w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/66ff6afb142162d96a92fa10ed6c3906/beb58/sample_repo2_graph1.png 728w,\n/static/66ff6afb142162d96a92fa10ed6c3906/6448e/sample_repo2_graph1.png 1894w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/66ff6afb142162d96a92fa10ed6c3906/beb58/sample_repo2_graph1.png\"\n            alt=\"右上に矩形があり、「[commit(6f6015e)] tree 9aaa8e3 parent 2a87a08 parent d8e2cae Merge branch ‘feature’」と書かれている。その矩形から下へ矢印が伸び、「[tree(9aaa8e3)] ...」と書かれた矩形を指している。右上の矩形から左方向に矢印が2本伸びている。1本は「[commit(2a87a08)] tree ... parent ... master 1」と書かれた矩形を指している。そこからさらに左方向へ矢印が伸び、「[commit(...)] tree ... parent ... initial commit」と書かれた矩形を指している。もう1本は「[commit(d8e2cae)] tree ... parent ... feature 2」と書かれた矩形を指している。そこから更に左方向へ矢印が伸び、「[commit(...)] tree ... parent ... feature 1」と書かれた矩形を指している。そこから更に左方向へ矢印が伸び、「[commit(...)] tree ... parent ... initial commit」と書かれた矩形を指している。右上の矩形から左に伸びる矢印のうち、2本目に吹き出しが付いていて、「Squashマージではこの参照が記録されない」と書かれている。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>通常のマージコミットには両方のparentが記録されるため、そこから<code class=\"language-text\">git log</code>するとfeatureブランチのコミットである「feature 2」や「feature 1」が表示されます。</p>\n<p>一方、Squashマージではfeature側のparentが記録されないため、そこから<code class=\"language-text\">git log</code>するとmaster側のコミットしか見えません。ログの見え方がスッキリするという利点がありますが、親への情報が失われてしまうという欠点があります。</p>\n<p>通常マージとSquashマージで、マージコミットが指すツリー（9aaa8e3）は同じです。通常マージでもSquashマージでも、マージ結果であるリポジトリのコンテンツに違いは無いからです。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Gitの内部表現からSquashを考えてみました。インタラクティブリベースのSquashは、単方向リストからの要素削除に似ていました。Squashマージは、一方のparentを記録しないことに対応するようでした。</p>\n<p>もちろん、Gitの実装が、実際に今回のような操作によってSquashを処理しているとは限りません。ちょっと実装を追ってみた感じだと、例えばインタラクティブリベースのSquashは、各コミットと親の差分を計算して、それを適用していくことで動作しているようでした。</p>\n<p>しかし、少なくとも内部表現がどのように変化するかを理解しておくことで、より自信をもってGitを使えるようになれそうです。</p>\n<p>ありがとうございました。</p>","frontmatter":{"title":"Gitの内部表現から理解するSquash","date":"2024/03/25"},"fields":{"slug":"/Gitの内部表現から理解するSquash/"},"id":"5010f43b-fdb5-5b2b-8f0c-3b7434219588"},"firstImage":{"imageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/39a147beb4e94bc96f027ccb4b55038a/c9746/sample_repo1_graph1.png","srcSet":"/static/39a147beb4e94bc96f027ccb4b55038a/7eefe/sample_repo1_graph1.png 125w,\n/static/39a147beb4e94bc96f027ccb4b55038a/ed788/sample_repo1_graph1.png 249w,\n/static/39a147beb4e94bc96f027ccb4b55038a/c9746/sample_repo1_graph1.png 498w","sizes":"(min-width: 498px) 498px, 100vw"},"sources":[{"srcSet":"/static/39a147beb4e94bc96f027ccb4b55038a/f4dc6/sample_repo1_graph1.webp 125w,\n/static/39a147beb4e94bc96f027ccb4b55038a/ec071/sample_repo1_graph1.webp 249w,\n/static/39a147beb4e94bc96f027ccb4b55038a/39aea/sample_repo1_graph1.webp 498w","type":"image/webp","sizes":"(min-width: 498px) 498px, 100vw"}]},"width":498,"height":779}}}},"relatedMarkdownRemarks":{"posts":[{"id":"3d71b3f9-8d6b-58a4-b6cb-8293daf99d74","frontmatter":{"draft":null}},{"id":"ed7af7f9-75f5-59be-9063-de564576eed7","frontmatter":{"draft":true}},{"id":"75696ec6-74a3-5046-8a3c-f39b36d92311","frontmatter":{"draft":null}},{"id":"c2249b7b-b97e-5cf4-8ea9-8024e96851b7","frontmatter":{"draft":true}},{"id":"9f1931f9-74a8-534b-8eab-3952e6520ab8","frontmatter":{"draft":null}},{"id":"f0a0e8a2-4d0b-510e-98c2-233ad96f11c2","frontmatter":{"draft":null}},{"id":"addc6dab-2819-51f8-a0f5-c48cb138eef1","frontmatter":{"draft":null}},{"id":"75550af2-8134-5467-a07d-abbb5a4f6b7c","frontmatter":{"draft":true}},{"id":"32eca2a3-4169-543c-9c2b-2c11988b3ffb","frontmatter":{"draft":null}},{"id":"0116f663-28d1-507a-b5ab-b189801dd408","frontmatter":{"draft":true}},{"id":"01deffb8-0d62-54c6-9e41-20832cbc3c6e","frontmatter":{"draft":null}},{"id":"067a602f-4581-5707-b896-73190dd8c889","frontmatter":{"draft":null}},{"id":"0bc9da5c-36cb-5e74-8b2f-bf514edbb710","frontmatter":{"draft":null}},{"id":"0c5568c9-6d87-56ed-ab0e-caeb9c1aafa4","frontmatter":{"draft":null}},{"id":"1086a735-7173-58cc-a813-c540a563aedf","frontmatter":{"draft":false}},{"id":"1162dccb-e1bf-576d-a5c6-0993394feb0a","frontmatter":{"draft":true}},{"id":"12222bfa-2e8e-51ee-99d8-8a19902351f5","frontmatter":{"draft":null}},{"id":"1509de3c-7308-5e40-a885-f5ebdb089774","frontmatter":{"draft":null}},{"id":"27f10a38-0ecb-539f-a717-7e40a41bbd10","frontmatter":{"draft":null}},{"id":"29b79017-f96d-5b04-8d01-5b8ee761ebed","frontmatter":{"draft":null}},{"id":"2cfd9e33-b4e1-53e4-884d-d8a6760f3387","frontmatter":{"draft":true}},{"id":"2f30c3f1-0d66-590b-8dba-7836df701d46","frontmatter":{"draft":null}},{"id":"3908aafc-c8d3-5c67-821f-0866592449f2","frontmatter":{"draft":true}},{"id":"3a3c4125-9986-53bb-8b96-ae29936c96ab","frontmatter":{"draft":null}},{"id":"3b696b96-130d-50de-a673-dc1367f32387","frontmatter":{"draft":null}},{"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a","frontmatter":{"draft":null}},{"id":"46a22c41-5455-557c-85d4-973a6e2220ee","frontmatter":{"draft":null}},{"id":"48c65a15-67ca-57d0-9edc-ebcb868f7ad2","frontmatter":{"draft":true}},{"id":"49cf25c1-03f6-575e-8c2f-638ccd6198ea","frontmatter":{"draft":null}},{"id":"4d43646f-8aa6-52b6-b0b6-5160f0be2b05","frontmatter":{"draft":null}},{"id":"4ed3b747-2001-54f4-9661-3acab89ce275","frontmatter":{"draft":null}},{"id":"4edc1b46-b395-5783-af6a-818b8fc9c2dc","frontmatter":{"draft":null}},{"id":"4efc4f86-56aa-5ff4-8994-3946583906ad","frontmatter":{"draft":null}},{"id":"50951bb1-eb92-5663-a3d8-8f35f73a1322","frontmatter":{"draft":null}},{"id":"50d3cc2a-de7a-5b9a-a8d8-754415fe4d94","frontmatter":{"draft":null}},{"id":"5888c50d-8414-5e8f-b0dc-28a31b29053d","frontmatter":{"draft":null}},{"id":"5dba01b8-593d-5295-b135-16df1c6295e5","frontmatter":{"draft":null}},{"id":"63f3c7ad-6c59-52b5-9816-78fd348955ff","frontmatter":{"draft":true}},{"id":"69a4aa90-b728-522c-b34f-abee49825c45","frontmatter":{"draft":true}},{"id":"6b318bb6-2c5f-5f38-93c7-5ed1cca1fff8","frontmatter":{"draft":null}},{"id":"73ab4455-f04d-5320-bf3a-90b9f7441d13","frontmatter":{"draft":null}},{"id":"73d6ab42-b3e6-5663-a175-b1f3d69c29e1","frontmatter":{"draft":null}},{"id":"7778d041-a5bf-536a-a36f-c0dbc5e08ac7","frontmatter":{"draft":true}},{"id":"78349b16-6e41-5fef-ae38-bcdc5ff297ef","frontmatter":{"draft":true}},{"id":"7a8fc278-a847-5b68-8b74-a83193ba3f55","frontmatter":{"draft":null}},{"id":"7d6499d9-277c-5f07-b8b1-98ae40c50c42","frontmatter":{"draft":true}},{"id":"7d79eb4b-cd4a-5621-a67a-91d9a24dce05","frontmatter":{"draft":null}},{"id":"82d43655-ea2a-52cd-97a3-16b7b28ad150","frontmatter":{"draft":null}},{"id":"84bf9a79-dd68-55d1-a1b3-60ffd3784554","frontmatter":{"draft":null}},{"id":"871ac696-39ea-5c64-94f3-5dc4b73b5770","frontmatter":{"draft":true}},{"id":"89ddbcc0-ed71-5a69-9d55-9677eab3e6cf","frontmatter":{"draft":null}},{"id":"8b3e46c2-1a1e-5af0-8900-7972c7285d15","frontmatter":{"draft":null}},{"id":"8f7b1b24-7738-5b97-bfb6-fd763f11a664","frontmatter":{"draft":true}},{"id":"961ec1e6-3f2b-59d9-a33f-dad76cf67f47","frontmatter":{"draft":null}},{"id":"97f01467-e3a1-58e1-b2a4-db77354cc1a3","frontmatter":{"draft":null}},{"id":"9f02de74-61a0-5daf-a048-1c1022e08fe4","frontmatter":{"draft":null}},{"id":"9f24363b-ee3e-54bf-8a18-46ea3b269bea","frontmatter":{"draft":null}},{"id":"a091877c-69b8-59f9-8963-1af334fd573c","frontmatter":{"draft":null}},{"id":"a190aac4-0483-5e02-b1d3-261f3b5f313a","frontmatter":{"draft":null}},{"id":"a6c64123-b824-5224-8027-90eb12040396","frontmatter":{"draft":null}},{"id":"b4251348-b618-5b5b-a2c8-e4c6b2431b83","frontmatter":{"draft":true}},{"id":"be594923-185e-5cca-95b6-5267b3c9fc8c","frontmatter":{"draft":null}},{"id":"bfee69af-7d7f-5d87-9680-d2e9b60f8416","frontmatter":{"draft":null}},{"id":"c2db052c-95c6-5094-935b-9eb39f5c762a","frontmatter":{"draft":null}},{"id":"c5e2431a-cf05-5024-b833-e1c69f680d44","frontmatter":{"draft":null}},{"id":"c6def021-b8da-5dbe-ad3e-811d9286424d","frontmatter":{"draft":true}},{"id":"c7a5adfb-149b-5469-ba35-7421e2101951","frontmatter":{"draft":null}},{"id":"cbdf3192-973c-5d87-9cf1-bb9110e9a169","frontmatter":{"draft":null}},{"id":"d29b4513-0609-5cfc-af49-817467dbed1f","frontmatter":{"draft":null}},{"id":"d4d1afa4-f2f9-5942-ae36-2826fb938af5","frontmatter":{"draft":null}},{"id":"db26c6b9-37b4-5cc4-b1ec-c61dc667863e","frontmatter":{"draft":null}},{"id":"dd0c41cf-0a03-5b89-b5a2-f64859aeae63","frontmatter":{"draft":null}},{"id":"e322eac2-bd89-5347-b20d-d050d303a6be","frontmatter":{"draft":null}},{"id":"e376b2d4-df91-5b82-af7a-a8d02763e922","frontmatter":{"draft":true}},{"id":"e4fb8478-b1ad-59eb-95e8-8c5e0500d3f4","frontmatter":{"draft":true}},{"id":"e83330dc-2312-5ae6-95fa-53e86909f42b","frontmatter":{"draft":true}},{"id":"eba9aa6a-6e21-5f1b-a0eb-7b6bfb1e04f1","frontmatter":{"draft":null}},{"id":"ebae7878-c4ee-505e-81e2-3d3fc47ea826","frontmatter":{"draft":true}},{"id":"f06a6ae0-e961-504c-8dab-a60489c0557a","frontmatter":{"draft":true}},{"id":"f49ce388-e81c-5425-af59-9902f125c20f","frontmatter":{"draft":null}},{"id":"f5a25ce1-67a6-51b2-9bf1-f9fbacb41ad1","frontmatter":{"draft":true}},{"id":"f920a8a8-f5fe-57c9-8792-95c93d2b74eb","frontmatter":{"draft":null}},{"id":"fc7ce496-d3b3-5f39-a04e-8e2dfb960626","frontmatter":{"draft":null}},{"id":"fd6eab68-17d3-5395-8b2b-54a6efe43ebb","frontmatter":{"draft":null}}]}},"pageContext":{"id":"5010f43b-fdb5-5b2b-8f0c-3b7434219588"}},"staticQueryHashes":["1800451590","2576926420","63159454"],"slicesMap":{}}