{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/SICPの感想文/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://sititou70.github.io"}},"markdownRemark":{"excerpt":"今年のお正月に、「無料で読めるポール・グレアムの「ハッカーと画家」+αの日本語訳のみのまとめ」がエントリに上がっていて、布団にこもりながらダラダラ眺めていたところ、前からSICPが気になっていたのを思い出したので、「いい機会だし読んでみるか〜」となり、約…","html":"<p>今年のお正月に、「<a href=\"https://b.hatena.ne.jp/entry/s/gist.github.com/sifue/b6506ea6b3f3d3a46a0c3bb885cd5ddf\">無料で読めるポール・グレアムの「ハッカーと画家」+αの日本語訳のみのまとめ</a>」がエントリに上がっていて、布団にこもりながらダラダラ眺めていたところ、前からSICPが気になっていたのを思い出した<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>ので、「いい機会だし読んでみるか〜」となり、約7ヶ月かかって読み終わりました。</p>\n<p>計算機プログラムの構造と解釈（Structure and Interpretation of Computer Programs）は、計算機科学の古典であり、MITのプログラミング入門講義で教科書として使用されていた本です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 144.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/6c9be/cover.webp 400w\"\n              sizes=\"(max-width: 400px) 100vw, 400px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png 400w\"\n            sizes=\"(max-width: 400px) 100vw, 400px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png\"\n            alt=\"計算機プログラムの構造と解釈の表紙。魔術師が描かれており、全体的に紫色。\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>通称、タイトルの頭文字をとってSICP（しくぴー）とか、表紙の絵から魔術師本とか、表紙の色から紫本などと呼ばれます。<a href=\"https://github.com/sititou70/sicp-exercises#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88\">原文および日本語訳</a>は無料で公開されています。日本語訳にもいくつかあるのですが、私は真鍋氏のものを読ませていただきました。</p>\n<p>取り組むにあたって、すべての練習問題に回答することにしました。わからない問題は、1日以上考えてもダメならネットで先人の回答を検索しても良いことにしました。ただし、練習問題4.79に含まれる「博士号が取れる自由回答問題」だけはスキップしています。（後述します）</p>\n<p>最終的な私の回答は以下にあります。他の人の回答や資料を参考にした場合は、参考元をコメント等で記載してあります。可能な限り裏取りをしていますが、間違いがあるかもしれません。しかし、私は先人の回答に助けられた場面が多かったので、これもなにかの役に立てばと思います。</p>\n<p><a href=\"https://github.com/sititou70/sicp-exercises\">https://github.com/sititou70/sicp-exercises</a></p>\n<p>この記事はSICPの読書感想文です。あまり難しい説明をせず、SICPを読んで感じたことを書きます。<a href=\"/SICP%E3%81%AE%E5%82%99%E5%BF%98%E9%8C%B2/\">備忘録</a>は別で書きました。</p>\n<h2 id=\"献辞前書き序文謝辞\" style=\"position:relative;\"><a href=\"#%E7%8C%AE%E8%BE%9E%E5%89%8D%E6%9B%B8%E3%81%8D%E5%BA%8F%E6%96%87%E8%AC%9D%E8%BE%9E\" aria-label=\"献辞前書き序文謝辞 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>献辞、前書き、序文、謝辞</h2>\n<blockquote>\n<p>この本を、尊敬と賛美を込めて、コンピュータの中に住む妖精に捧げます。</p>\n<p>出典：<a href=\"http://vocrf.net/docs_ja/jsicp.pdf\">SICP 非公式日本語版 翻訳改訂版</a>、以降同じものについて出典略</p>\n</blockquote>\n<p>だったり、</p>\n<blockquote>\n<p>プログラムは⼈間が読めるように書かなくてはならず、それがたまたま機械によって実行できるというだけのことです。</p>\n</blockquote>\n<p>だったり、いろいろと有名なやつが並びます。事前に読んでおくとモチベーションが高まります。SICPを終えたあとにもう一度読み直すと、「あ〜わかる」という気持ちになります。</p>\n<h2 id=\"1章\" style=\"position:relative;\"><a href=\"#1%E7%AB%A0\" aria-label=\"1章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1章</h2>\n<p>この本ではLispの方言であるSchemeを使います。1章では、Schemeの基本的な文法等について主に学びました。ここは特に苦労しませんでした。</p>\n<p><em>だったら退屈だったのか？</em></p>\n<p>というと、決してそんなことはありません。</p>\n<p>Schemeの導入以外にも、以下のような「どこかで聞いた気がするけど自信を持って説明できない」トピックがあり、勉強になりました。</p>\n<ul>\n<li>宣言的知識と手続き的知識</li>\n<li>適用順序と正規順序</li>\n<li>反復プロセスと再帰プロセス\n<ul>\n<li>再帰手続きと再帰プロセスの違い</li>\n<li>末尾再帰</li>\n</ul>\n</li>\n<li>増加オーダー</li>\n</ul>\n<p>特に、増加オーダーの件で<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Θ</mi></mrow><annotation encoding=\"application/x-tex\">Θ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Θ</span></span></span></span></span>（シータ）記法というものがあるのを初めて知りました。世間的によく使われるのは<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi></mrow><annotation encoding=\"application/x-tex\">O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span></span></span></span></span>（ビッグオー）記法だと思います。私が今まで<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi></mrow><annotation encoding=\"application/x-tex\">O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span></span></span></span></span>記法として使っていたのは、ほとんど<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Θ</mi></mrow><annotation encoding=\"application/x-tex\">Θ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Θ</span></span></span></span></span>記法の意味であり、盛大に勘違いしていました。</p>\n<p>簡単に言うと、「計算量は<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Θ</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Θ(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Θ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>だ」または「<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>だ」というとき、<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Θ</mi></mrow><annotation encoding=\"application/x-tex\">Θ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">Θ</span></span></span></span></span>記法は計算量を<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>の定数倍で上下からはさみます。<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi></mrow><annotation encoding=\"application/x-tex\">O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span></span></span></span></span>記法は<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>の定数倍で上からしか抑えません。</p>\n<h3 id=\"1章の練習問題\" style=\"position:relative;\"><a href=\"#1%E7%AB%A0%E3%81%AE%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C\" aria-label=\"1章の練習問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1章の練習問題</h3>\n<p>練習問題は思ったよりも多かったです。例えば、以下のような題材を扱います。</p>\n<ul>\n<li>逐次近似、ニュートン法、不動点、黄金比の近似、根の近似</li>\n<li>アッカーマン関数、テトレーション</li>\n<li>フィボナッチ数、一般項、対数時間でフィボナッチ数を求める方法（行列の結合性を使う方法は知っていたのですが、SICPの方法はそれよりも早く、感動しました）</li>\n<li>パスカルの三角形</li>\n<li>両替問題（特定の金額を表すための硬貨の枚数の組み合わせ）</li>\n<li>ユークリッドの互除法</li>\n<li>素数判定、素朴な方法、確率的判定、合同式、フェルマーテスト、カーマイケル数、ミラーラビンテスト</li>\n<li>数値積分、シンプソンの公式</li>\n<li>無限連分数、自然対数の底の近似、tanの近似</li>\n</ul>\n<p>「あー、入門としては定番だよね」というものから、「そこまでやる……？」というものまであります。特に素数判定のあたり。</p>\n<p>高校で合同式を習っていなかったので、「<a href=\"https://manabitimes.jp/math/683\">合同式(mod)の意味とよく使う６つの性質 | 高校数学の美しい物語</a>」とか、「 <a href=\"https://www.youtube.com/watch?v=6COGmURbrAw\">【高校数学(発展)】合同式①(modとは何か)【整数】 </a>」とかを見てました。最近はこういうわかりやすいやつがあるので最高ですね。</p>\n<p>そのうえで「結局わからん」となりながらフェルマーテストの原理を追ってました。</p>\n<p><em>「この前の休日？あぁ、フェルマーの小定理について考えてたよ」</em></p>\n<p>って、なんかかっこよくないですか。</p>\n<p>このへんで「そういえば練習問題って全部で何問くらいあるんだろう」と思い、集計したのが以下の表です。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">章</th>\n<th align=\"center\">問題の数</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">46問</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">97問</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">82問</td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">79問</td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">52問</td>\n</tr>\n</tbody>\n</table>\n<p><strong>泣いちゃった</strong></p>\n<h2 id=\"2章\" style=\"position:relative;\"><a href=\"#2%E7%AB%A0\" aria-label=\"2章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2章</h2>\n<h3 id=\"リスト\" style=\"position:relative;\"><a href=\"#%E3%83%AA%E3%82%B9%E3%83%88\" aria-label=\"リスト permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>リスト</h3>\n<p>リストを勉強しました。</p>\n<p>Lispの名前が「List Processor」から来ているのは知っていたので、「ついに来たか……」という感じでした。</p>\n<p><code class=\"language-text\">cons</code>、<code class=\"language-text\">car</code>、<code class=\"language-text\">cdr</code>にふれました。これらはリストを構成する「ペア」を操作する関数です。</p>\n<p><code class=\"language-text\">cons</code>はペアを構築（construct）します。<code class=\"language-text\">car</code>はペアの最初の要素を、<code class=\"language-text\">cdr</code>は残りの要素を取り出すのですが、名前は何かの機械語に由来するのだそうで、「わかりづらくね？」との声もあるらしいです。</p>\n<p>「ハッカーと画家」のグレアム氏に言わせれば、</p>\n<blockquote>\n<p>プログラムを読みやすくするために、 Lispはcarとcdrの代わりにfirstとrestを使うべきだとしばしば言われて来た。ま、最初の2時間くらいはそうかもしれない。だがハッカーは、carはリストの最初の要素でcdrは残りの要素だなんてことくらいすぐに覚えられる。</p>\n<p>出典：<a href=\"http://practical-scheme.net/trans/being-popular-j.html\">人気の言語を作るには ---Being Popular---</a></p>\n</blockquote>\n<p>とのことで、私がハッカーかはわかりませんが、確かに数時間で慣れました。</p>\n<h3 id=\"mapfilteraccumulate\" style=\"position:relative;\"><a href=\"#mapfilteraccumulate\" aria-label=\"mapfilteraccumulate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>map、filter、accumulate</h3>\n<p>map、filter、accumulateが出てきました。私はお仕事でJavaScriptを扱うので、これがArray.prototypeのmap、filter、reduceに対応することがすぐにわかりました。</p>\n<p>ただ、Schemeのmapとaccumulate（foldとも）は、JSのものよりも一般化されているのが面白かったです。</p>\n<p>JSのmapは、「1つのリスト（配列）」と「1引数の関数」で動作します。リストのi番目の要素を関数の引数に渡して、その戻り値であたらしいリストが作られます。</p>\n<p>Schemeの一般化されたmapは、「n個のリスト」と「n引数の関数」で動作します。n個のリストのi番目の要素を関数の引数に渡して、その戻り値であたらしいリストが作られます。</p>\n<p>これがJSのmapの自然な拡張になっているのが美しいなと思いました。accumulateも同様で、複数のリストを自然な形で渡せます。</p>\n<h3 id=\"データ\" style=\"position:relative;\"><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF\" aria-label=\"データ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>データ</h3>\n<p>「データとは何か」という節が興味深かったです。ここでは、データとは「コンストラクタ、セレクタ、満たさなければならない条件」の3つによって定義されるものと説明されます。</p>\n<p>例えば「分数」データがあるとします。分数のコンストラクタとセレクタは以下のように実装できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 分数コンストラクタ</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">makeFraction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">numer<span class=\"token punctuation\">,</span> denom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>numer<span class=\"token punctuation\">,</span> denom<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 分数セレクタ</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getNumer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fraction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> fraction<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getDenom</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fraction</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> fraction<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>満たさなければならない条件とは以下です。</p>\n<ul>\n<li><code class=\"language-text\">getNumer(makeFraction(a, b)) === a</code></li>\n<li><code class=\"language-text\">getDenom(makeFraction(a, b)) === b</code></li>\n</ul>\n<p>これらの3つが何らかの方法で実現されているなら、その実装言語、内部表現、デジタルかアナログかなどに関係なく、それは分数データに見えるし、そのように振る舞うだろうということみたいです。</p>\n<p>なるほどね？</p>\n<h3 id=\"メッセージパッシングと型によるディスパッチ\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%91%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0%E3%81%A8%E5%9E%8B%E3%81%AB%E3%82%88%E3%82%8B%E3%83%87%E3%82%A3%E3%82%B9%E3%83%91%E3%83%83%E3%83%81\" aria-label=\"メッセージパッシングと型によるディスパッチ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メッセージパッシングと型によるディスパッチ</h3>\n<p>データ抽象化の文脈でメッセージパッシングが登場しました。</p>\n<p>面白かったのは、メッセージパッシングスタイルは、プログラムをデータの種類（型）によってグループ化しているという視点でした。</p>\n<p>それとは逆に、演算の種類によってプログラムをグループ化すると、型によるディスパッチスタイルにつながるというのも興味深いです。</p>\n<p>いままではこれら2つをそのように結びつけて考えていなかったので新鮮でした。</p>\n<h3 id=\"2章の練習問題\" style=\"position:relative;\"><a href=\"#2%E7%AB%A0%E3%81%AE%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C\" aria-label=\"2章の練習問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2章の練習問題</h3>\n<p>練習問題は案の定多くて大変でした。好きなやつを2つ紹介します。</p>\n<p>1つは、以下のような1950年代のロックの歌詞をハフマン符号木によって圧縮する問題です。</p>\n<blockquote>\n<p>Get a job<br>\nSha na na na na na na na na<br>\nGet a job<br>\nSha na na na na na na na na<br>\nWah yip yip yip yip yip yip yip yip yip<br>\nSha boom</p>\n</blockquote>\n<p>なるほど。圧縮に対する <em>やりがい</em> を感じます。</p>\n<p>もう1つは、文字式の演算をする問題です。例えば以下のようなプログラムを書きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"scheme\"><pre class=\"language-scheme\"><code class=\"language-scheme\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> p1 <span class=\"token punctuation\">(</span><span class=\"token function\">make-polynomial</span> <span class=\"token symbol\">'x</span> <span class=\"token punctuation\">'</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> p2 <span class=\"token punctuation\">(</span><span class=\"token function\">make-polynomial</span> <span class=\"token symbol\">'x</span> <span class=\"token punctuation\">'</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token number\">-1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> p3 <span class=\"token punctuation\">(</span><span class=\"token function\">make-polynomial</span> <span class=\"token symbol\">'x</span> <span class=\"token punctuation\">'</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> p4 <span class=\"token punctuation\">(</span><span class=\"token function\">make-polynomial</span> <span class=\"token symbol\">'x</span> <span class=\"token punctuation\">'</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> <span class=\"token number\">-1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> rf1 <span class=\"token punctuation\">(</span><span class=\"token function\">make-rational</span> p1 p2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> rf2 <span class=\"token punctuation\">(</span><span class=\"token function\">make-rational</span> p3 p4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">add</span> rf1 rf2<span class=\"token punctuation\">)</span></code></pre></div>\n<p>数式で書くと以下のようになります。</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mi>x</mi><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{x + 1}{x^3 - 1} + \\frac{x}{x^2 - 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0908em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.8769em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>ようするに分数の足し算です。</p>\n<p>実行すると以下が出力されます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">'(rational\n  (polynomial x (3 -1) (2 -2) (1 -3) (0 -1))\n   polynomial x (4 -1) (3 -1) (1 1) (0 1))</code></pre></div>\n<p>数式で書くと、</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mfrac><mrow><mo>−</mo><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>3</mn><mi>x</mi><mo>−</mo><mn>1</mn></mrow><mrow><mo>−</mo><msup><mi>x</mi><mn>4</mn></msup><mo>−</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{- x^3 - 2x^2 - 3x - 1}{- x^4 - x^3 + x + 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.2604em;vertical-align:-0.7693em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4911em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7401em;\"><span style=\"top:-2.989em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">3</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></div>\n<p>正しく計算できているのがわかります。</p>\n<p>まぁたったこれだけなんですが、内部では</p>\n<ul>\n<li>多項式の除算</li>\n<li>多項式の最大公約数（？）\n<ul>\n<li>ユークリッドの互除法の拡張</li>\n<li>ユークリッド環（？）</li>\n<li>測度（？）</li>\n</ul>\n</li>\n<li>整数化因子（？）</li>\n<li>擬除算（？）と擬剰余（？）</li>\n</ul>\n<p>といった手法ないし概念が使われています。正直原理はよくわかっていません。特に、分数を既約にするためにこれらが必要です。</p>\n<p>ちなみに、今回は登場する文字が<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></span>だけだったのでまだ良かったのですが、ここに他の文字が追加されると、「型階層を見直して強制型変換で……」のようにさらにヤバくなります。</p>\n<p>ちょっと油断していると、SICPがプログラミング <strong>入門</strong> の教科書であったことを忘れてしまいます。</p>\n<p>まぁここで難しいのはプログラミングというよりは数学ですが、いずれにせよ <strong>MITってやべーな</strong> という気持ちと、<strong>じゃあテイラー展開とかフーリエ変換とかできる本格的な数式処理システムってどうなってんの……？</strong> という気持ちです。</p>\n<h2 id=\"3章\" style=\"position:relative;\"><a href=\"#3%E7%AB%A0\" aria-label=\"3章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3章</h2>\n<h3 id=\"代入\" style=\"position:relative;\"><a href=\"#%E4%BB%A3%E5%85%A5\" aria-label=\"代入 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>代入</h3>\n<p>「代入」という概念が登場しました。そういえばこれまで代入を使ってこなかったな〜〜という感覚です</p>\n<p>ここで、</p>\n<ul>\n<li>関数型プログラミングとは、代入を使用しないプログラミングスタイルである</li>\n<li>命令型プログラミングとは、代入を使用するプログラミングスタイルである</li>\n</ul>\n<p>と説明されていて、「そうだったのか」という気持ちになりました。</p>\n<p>また本文では、より厳密に参照透過性を引き合いに出しても説明しています。代入は、参照透過性を破ってしまう代表的な機能の1つです。</p>\n<p>これまでは <em>関数型プログラミングって何？</em> と聞かれたら</p>\n<p><em>えっと……関数を組み合わせてプログラミングすることだよ。</em></p>\n<p><em>……それは関数型プログラミング以外でもそうじゃない？</em></p>\n<p><em>いやでも、mapとかfilterとか便利なやつがあって、あとモナドっていうのがあるらしくて……</em></p>\n<p><em>ふーん？</em></p>\n<p>という、ふんわりした説明しかできなかったと思います。</p>\n<p>もちろんすべての言語に当てはまる定義ではないとは思いますが、理解度が高まって良かったです。</p>\n<h3 id=\"環境モデル\" style=\"position:relative;\"><a href=\"#%E7%92%B0%E5%A2%83%E3%83%A2%E3%83%87%E3%83%AB\" aria-label=\"環境モデル permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>環境モデル</h3>\n<p>代入によって、それを格納する「環境」が必要になるということで、環境モデルを学びました。</p>\n<ul>\n<li>環境とは、フレームの順序付き集合である。\n<ul>\n<li>ここで、ある環境Aの次にある環境Bは、Aの外側の環境（enclosing environment）である。</li>\n</ul>\n</li>\n<li>フレームとは、束縛の集合である。</li>\n<li>束縛とは、変数と値の対である。</li>\n</ul>\n<p>と理解しました。</p>\n<p>また、クロージャとは、「手続き（関数の本体）」と「それが評価（作成）された環境」の対であるとも理解しました。クロージャはその評価時に、その時点の環境を自身に保存します。そして適用時に、その環境をextendsした環境を作成し、そこで自身の手続きを評価します。</p>\n<p>レキシカル環境とかクロージャとか束縛とか、JavaScriptの文脈でも聞く用語が並んでいて面白かったです。「<a href=\"https://ksmakoto.hatenadiary.com/entry/2014/01/23/175535\">JavaScriptはSchemeの影響を受けている</a>」という話を聞いたことがあって、この辺がそうなのかもな〜と思いました。</p>\n<p>まぁ、これはSchemeの説明なので、JSの実際の事情はECMA-262を参照すべきです。</p>\n<p>がっつり読めてはいないのですが、例えば<a href=\"https://tc39.es/ecma262/#sec-ecmascript-function-objects\">10.2 ECMAScript Function Objects</a>を参照すると、関数オブジェクトの内部スロットに <code class=\"language-text\">[[ECMAScriptCode]]</code> と <code class=\"language-text\">[[Environment]]</code> があり、「手続き」と「環境」の対に相当するものがあるとわかります。</p>\n<p>関数評価（作成）時の抽象操作である<a href=\"https://tc39.es/ecma262/#sec-ordinaryfunctioncreate\">OrdinaryFunctionCreate</a>を見ると、 <code class=\"language-text\">13. Set F.[[Environment]] to env.</code> というステップがあり、その時点の環境を自身に保存しているのがわかります。また、関数呼び出しの抽象操作である<a href=\"https://tc39.es/ecma262/#sec-ecmascript-function-objects-call-thisargument-argumentslist\">[[Call]]</a>から呼ばれる<a href=\"https://tc39.es/ecma262/#sec-prepareforordinarycall\">PrepareForOrdinaryCall</a>から呼ばれる<a href=\"https://tc39.es/ecma262/#sec-newfunctionenvironment\">NewFunctionEnvironment</a>では、 <code class=\"language-text\">6. Set env.[[OuterEnv]] to F.[[Environment]].</code> というステップがあり、先程保存した環境を外部環境として新しい環境を作成（extends）しているとわかります。</p>\n<h3 id=\"ストリーム\" style=\"position:relative;\"><a href=\"#%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A0\" aria-label=\"ストリーム permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ストリーム</h3>\n<p>SICPでは、「要素の一部が遅延オブジェクトであるリスト」をストリームと呼んでいます。</p>\n<p>遅延オブジェクトのおかげで、必要な要素のみが計算され、無限の要素を持つストリームを表現できるということを学びました。</p>\n<p>せっかくなのでストリームをJSで実装してみました。パズル的な面白さがあるので、暇な方だけ見ていただければと思います。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 遅延オブジェクトは関数で表現することにする</span>\n\n<span class=\"token comment\">// 遅延オブジェクトの作成するには次のように書く：() => 評価を遅延したい式</span>\n\n<span class=\"token comment\">// 遅延オブジェクトを評価する。遅延オブジェクトでなければ何もしない</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">force</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> value <span class=\"token operator\">===</span> <span class=\"token string\">\"function\"</span> <span class=\"token operator\">?</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// streamを構築する。次のように残りのstreamを遅延させて呼び出す：consStream(streamの最初の要素, () => 残りのstream)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">consStream</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">first<span class=\"token punctuation\">,</span> rest</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>first<span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// streamの先頭の要素を得る</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">streamCar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> s<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 残りのstreamを得る</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">streamCdr</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">force</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// mapのstream版</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">streamMap</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">proc<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>streams</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">//</span>\n    <span class=\"token function\">proc</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>streams<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>streamCar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">streamMap</span><span class=\"token punctuation\">(</span>proc<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>streams<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>streamCdr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 2つのstreamの各要素を足したstreamを得る</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addStreams</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s1<span class=\"token punctuation\">,</span> s2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">streamMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v1<span class=\"token punctuation\">,</span> v2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> v1 <span class=\"token operator\">+</span> v2<span class=\"token punctuation\">,</span> s1<span class=\"token punctuation\">,</span> s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// streamを先頭からn個表示する</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">printStream</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">stream<span class=\"token punctuation\">,</span> n</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> s <span class=\"token operator\">=</span> stream<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">streamCar</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    s <span class=\"token operator\">=</span> <span class=\"token function\">streamCdr</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// main</span>\n<span class=\"token keyword\">const</span> ones <span class=\"token operator\">=</span> <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ones<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">printStream</span><span class=\"token punctuation\">(</span>ones<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 1</span>\n\n<span class=\"token keyword\">const</span> integers <span class=\"token operator\">=</span> <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">addStreams</span><span class=\"token punctuation\">(</span>ones<span class=\"token punctuation\">,</span> integers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">printStream</span><span class=\"token punctuation\">(</span>integers<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// 3</span>\n<span class=\"token comment\">// 4</span>\n<span class=\"token comment\">// 5</span>\n\n<span class=\"token keyword\">const</span> fibs <span class=\"token operator\">=</span> <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span>\n  <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">addStreams</span><span class=\"token punctuation\">(</span><span class=\"token function\">streamCdr</span><span class=\"token punctuation\">(</span>fibs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fibs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">printStream</span><span class=\"token punctuation\">(</span>fibs<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 0</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// 3</span>\n<span class=\"token comment\">// 5</span>\n<span class=\"token comment\">// 8</span>\n<span class=\"token comment\">// 13</span>\n<span class=\"token comment\">// 21</span>\n<span class=\"token comment\">// 34</span></code></pre></div>\n<p><code class=\"language-text\">ones</code>、<code class=\"language-text\">integers</code>、<code class=\"language-text\">fibs</code>が、なぜ所望のストリームを表示するか、ぱっと見てわかりますか？</p>\n<p>サクッとわかったあなたは人間ではありません。私のような普通の人間は、この節で頭が爆発します。</p>\n<p>SICPには更に複雑なものが載っています。素数のストリームを作ってみたり、tanのべき級数を求めてみたり、円周率をエイトケン加速で近似してみたり、電子回路をシミュレートしてみたり、微分方程式を解いてみたりと、やりたい放題です。こわいです。</p>\n<h2 id=\"4章\" style=\"position:relative;\"><a href=\"#4%E7%AB%A0\" aria-label=\"4章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4章</h2>\n<p>4章がSICPのメインディッシュです。</p>\n<h3 id=\"メタ循環評価器\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%82%BF%E5%BE%AA%E7%92%B0%E8%A9%95%E4%BE%A1%E5%99%A8\" aria-label=\"メタ循環評価器 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メタ循環評価器</h3>\n<p>メタ循環評価器とは、あるプログラミング言語上で構築された、そのプログラミング言語のインタプリタです。つまり、この節ではSchemeでScheme（のインタプリタ）を作ります。</p>\n<p><em>そんなことして何になるんだ？</em></p>\n<p>と思われるかもしれません。私は思いました。</p>\n<p>この節より後では、解きたい問題に対して、それに適した新たな言語を作ります（！）</p>\n<p>メタ循環評価器は、そのためのベースラインとなります。</p>\n<h4 id=\"評価器の仕組み\" style=\"position:relative;\"><a href=\"#%E8%A9%95%E4%BE%A1%E5%99%A8%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\" aria-label=\"評価器の仕組み permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>評価器の仕組み</h4>\n<p>評価器は、evalとapplyの相互再帰呼出しによって動作していきます。</p>\n<p>evalは環境で式を評価します。式が手続き適用であればapplyを呼び出します。applyは適用を処理します。手続きが複合手続きであれば環境をextendし、その中で本体を評価するためにevalを呼び出します。</p>\n<p>このようにeval、apply、eval、apply……と互いに呼び出し合う様子を表したのが以下の図で、おそらくSICPで最も重要かつ有名な図です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4aab038aa16736d98005dcbf8a1dbc44/6cf5a/fig4.1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.75274725274725%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVR42qWSx3LCQAyG/f7PRe7hxIESwB5MNXjdG8p+GsRA8C17WVmW/qJVICNnGAa53+8ac3ddJ33fP/83TfP2/XqCvwmanXMa13WtcZ7nkmWZFEWh+cPhIEmSPAk/AEnaDwAANTDUmmqAjSxN06fK1/43hRSghGYarIg8quI4lvV6rcBt2+r9YTnzjBTu93u1VJalAuQPi8zLpU5Wq5Usl0uZz+dyOp2UDFL64t1Ozuez5gKSFEdRJLfbTaqqUhAKiLF+PB5ls9nIbDbztT8KZC4AozfcbrU+AHXwiuw1mREx1hj85XKRMAzVMvHWN+ICUrMMuG3GxyvbsGnCIsqwtfNKIMEuBzdjqxOM7SAquBk81lEHEA9m6wTh6B7SCDvFAFAMu9ryMbnUP8o1ueqMqqrUsTRNq9+MiZztaND3nXxNJvI9nfoXXKiSKAr9vBIFzvNCH8VUkmO2gBoxYzL1apmkc6m4R/I/5xdAZ6Jjiv9ewwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4aab038aa16736d98005dcbf8a1dbc44/f4a91/fig4.1.webp 728w,\n/static/4aab038aa16736d98005dcbf8a1dbc44/2cb6c/fig4.1.webp 1211w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4aab038aa16736d98005dcbf8a1dbc44/beb58/fig4.1.png 728w,\n/static/4aab038aa16736d98005dcbf8a1dbc44/6cf5a/fig4.1.png 1211w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4aab038aa16736d98005dcbf8a1dbc44/beb58/fig4.1.png\"\n            alt=\"図4.1: eval-applyサイクルが明らかにするコンピュータ⾔語の本質\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>あまりに重要なので、よく見ると表紙にも描かれています。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 144.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/6c9be/cover.webp 400w\"\n              sizes=\"(max-width: 400px) 100vw, 400px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png 400w\"\n            sizes=\"(max-width: 400px) 100vw, 400px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a725acd84c0cea1d01a5d87e7fbfba7e/61e72/cover.png\"\n            alt=\"計算機プログラムの構造と解釈の表紙。魔術師が描かれており、全体的に紫色。よく見るとevalとapplyの相互再帰呼出しのサイクルが描かれている\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"遅延評価\" style=\"position:relative;\"><a href=\"#%E9%81%85%E5%BB%B6%E8%A9%95%E4%BE%A1\" aria-label=\"遅延評価 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>遅延評価</h3>\n<p>なんと、メタ循環評価器を少し改造するだけで、遅延評価版のSchemeが作れてしまうので感動します。</p>\n<p>基層のSchemeは適用順序なのに、そのうえで正規順序Schemeが動作するのは、インタプリタが基層言語の1つ上の抽象レベルに引き上げてくれるからです。</p>\n<p>遅延評価で嬉しいことはいくつかあるのですが、例えば無限ストリームが素直に書けるようになります。前述したJSのストリームは、遅延オブジェクトを明示的に扱っていました。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ones <span class=\"token operator\">=</span> <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ones<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>これは、本当は次のように書きたいのですが、</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ones <span class=\"token operator\">=</span> <span class=\"token function\">consStream</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> ones<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ReferenceError: Cannot access 'ones' before initialization</span></code></pre></div>\n<p>適用順序評価の環境だと、onesを初期化する前に参照してしまいうまく行きません。</p>\n<p>ところが正規順序評価の環境では、引数の評価は必要になるまで評価が遅延されるため、このようにきれいに書けるのです。やった〜〜</p>\n<h3 id=\"決定性計算\" style=\"position:relative;\"><a href=\"#%E6%B1%BA%E5%AE%9A%E6%80%A7%E8%A8%88%E7%AE%97\" aria-label=\"決定性計算 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⾮決定性計算</h3>\n<p>非決定性計算は、まるで時間が巻き戻るようなプログラミングパラダイムです。SFみを感じます。</p>\n<p><code class=\"language-text\">amb</code>は、いくつかの式に「曖昧に」評価される特別な式です。JSで無理やり表現すると、次のようになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token function\">amb</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token function\">amb</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>このプログラムを実行すると、<code class=\"language-text\">[1, 3]</code>と表示され、いったん停止します。しかし、非決定性計算の環境では、「他の可能性は？」と処理系に尋ねることができます。</p>\n<p>そうすると、処理系は最後の<code class=\"language-text\">amb</code>の時点に <strong>時間を戻して</strong> 、<code class=\"language-text\">b</code>への代入を別の選択肢である4でやり直し、<code class=\"language-text\">[1, 4]</code>を表示します。</p>\n<p>さらに「他の可能性は？」と尋ねると、<code class=\"language-text\">amb(3, 4)</code>で取れる選択肢はなくなったため、それより前の<code class=\"language-text\">amb(1, 2)</code>に戻ってaの代入を2でやり直し、<code class=\"language-text\">[2, 3]</code>が表示されます。更に尋ねると、同様に<code class=\"language-text\">[2, 4]</code>が表示され、更に尋ねると「これ以上の可能性はない」と返します。</p>\n<p>まるで<code class=\"language-text\">amb</code>のたびに世界線が分岐しているようにも見えます。SICPには、このパラダイムを使って様々な論理パズルを解く方法が載っており、とても面白いため興味のある方は参照されると良いと思います。</p>\n<p>これを実現するために、evalとapplyは、成功継続（ambが成功した場合の残りの計算）と失敗継続（ambが失敗した、つまり選択肢がない場合に実行すべき残りの計算、前のambの残りの選択肢を選ぶ処理だったり、代入を復元する処理だったり）を渡し合います。</p>\n<p>ここらへんで「継続」という用語があまり怖くなくなった気がします。</p>\n<h3 id=\"論理プログラミング\" style=\"position:relative;\"><a href=\"#%E8%AB%96%E7%90%86%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0\" aria-label=\"論理プログラミング permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>論理プログラミング</h3>\n<p>「論理プログラミング」というと馴染みが薄く戸惑ってしまうのですが、「Prolog」と言われると「なんか聞いたことあるわね」となりました。いや聞いたことがあるだけで、触ったことはないんですけども。</p>\n<p>この節で私が一番驚いたのは、手続きが双方向に計算できるということです。</p>\n<p>例によってJSで説明します。</p>\n<p>例えば、以下のような<code class=\"language-text\">append</code>関数を実装<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>し、実行したとします。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">append</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">list1<span class=\"token punctuation\">,</span> list2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>list1<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>list2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// [1, 2, 3, 4]</span></code></pre></div>\n<p>これは「<code class=\"language-text\">append([1, 2], [3, 4])</code>の結果は？」という質問に処理系が答えてくれたということになります。ここまでが普通のプログラミングです。</p>\n<p>しかし論理プログラミングの処理系では、「結果が<code class=\"language-text\">[1, 2, 3, 4]</code>となる<code class=\"language-text\">append([1, 2], ?x)</code>は？」と質問することもできます。<code class=\"language-text\">?x</code>はパターン変数と呼ばれる特殊な記法で、命名は適当です。</p>\n<p>これには「<code class=\"language-text\">append([1, 2], [3, 4])</code>」という回答が返ります。</p>\n<p>さらに、「結果が<code class=\"language-text\">[1, 2, 3, 4]</code>となる<code class=\"language-text\">append(?x, ?y)</code>は？」と質問することもできます。この場合、</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>が回答されます。</p>\n<p>まるで出力から入力を、結論から仮定を推論しているようで、「なんでこんなことができるんだ……？」と感心してしまいます。</p>\n<p>このような挙動を実現するために、ユニフィケーション（単一化）というアルゴリズムを学びました。これは進化版applyといった感じです。</p>\n<p>これまでの関数適用は、変数と値の対を扱えばいいので簡単でした。例えば、<code class=\"language-text\">append([1, 2], [3, 4])</code>を適用するときは、「<code class=\"language-text\">list1</code>と<code class=\"language-text\">[1, 2]</code>の束縛」、「<code class=\"language-text\">list2</code>と<code class=\"language-text\">[3, 4]</code>の束縛」を作れば良いです。</p>\n<p>一方で、<code class=\"language-text\">append(?x, ?y)</code>を処理する場合、実引数側にも変数が現れます。またここでは説明しませんでしたが、仮引数側に値が現れることもあります。しかもその値は複雑な複合オブジェクトであるかもしれず、さらに中に変数を含んでいるかもしれません。また、実引数側の変数名と仮引数側の変数名が衝突する場合も考えられます。これを考慮しないと、最終的な推論がうまく行きません。</p>\n<p>などなど、いろいろ難しい論理プログラミングですが、そのパワーはすごいものだと感じました。Prologは全くわからないのですが、そのメカニズムの重要な部分に単一化が関わっていそうだという感覚を持てました。</p>\n<h3 id=\"自由回答問題\" style=\"position:relative;\"><a href=\"#%E8%87%AA%E7%94%B1%E5%9B%9E%E7%AD%94%E5%95%8F%E9%A1%8C\" aria-label=\"自由回答問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自由回答問題</h3>\n<p>4章には唯一スキップした練習問題があります。以下は練習問題4.79です、</p>\n<blockquote>\n<p><strong>練習問題 4.79:</strong> 4.1節でLisp評価器を実装したとき、局所環境を使って別々の手続きの引数同士で名前が衝突しないようにする方法を学んだ。</p>\n<p>（略）</p>\n<p>クエリ⾔語で、変数のリネームではなく、環境を使う規則適⽤の手法を実装せよ。その環境構造の上に、ブロック構造手続きの規則版のような、大規模システムを扱うためのクエリ⾔語の構築物を作ることはできるだろうか。これらの問題と、問題解決の手法として文脈の中で推論を行うという問題（例えば、\"もしPが真であると仮定すると、AとBが推論できる\"）とを関連づけることはできるか。（この問題は自由回答だ。うまい解答ができれば博士号が取れるだろう。）</p>\n</blockquote>\n<p>スキップしたのは「これらの問題と、問題解決の手法として文脈の中で推論を行うという問題（例えば、\"もしPが真であると仮定すると、AとBが推論できる\"）とを関連づけることはできるか。」の部分で、自由回答とされています。</p>\n<p>正直、何を問われているのかもわかりません。手も足もでません。おそらく、先程書いた「結論から仮定を推論しているよう」が関連している気はするのですが、「<a href=\"https://github.com/sititou70/sicp-exercises/blob/master/chapter4/section4/ex4.79/main.rkt\">博士号をとりたくなったらまた考えることにする</a>」というふざけたコメントでお茶をまぜまぜしておきました。</p>\n<h2 id=\"5章\" style=\"position:relative;\"><a href=\"#5%E7%AB%A0\" aria-label=\"5章 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5章</h2>\n<p>仮想的なレジスタマシンのエミュレータを実装し、その機械語のうえで4章のメタ循環評価器を実装しました。</p>\n<p>これにより、例えばSchemeはどのようにしてメモリを消費せずに末尾呼び出しを行っているかという疑問が解決します。</p>\n<p>実際に、手続きの最後の処理が手続き呼び出しである場合、その後呼び出しの後何もすることがない（継続がない）ため、スタックに何も積まず次の手続きへgotoできることが示されます。<a href=\"http://practical-scheme.net/docs/cont-j.html\">なんでも継続</a>で、「継続の考え方を使うと末尾再帰の最適化は自然に導かれる」と言っていた意味がちょっとわかった気がします。</p>\n<p>また、Schemeのプログラムを仮想マシンの命令列に変換するコンパイラも実装しました。ここらへんまで来ると、自分が何をやっているのかよくわからなくなってきます。</p>\n<h3 id=\"5章の練習問題\" style=\"position:relative;\"><a href=\"#5%E7%AB%A0%E3%81%AE%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C\" aria-label=\"5章の練習問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5章の練習問題</h3>\n<p>最後の2問の練習問題、5.51と5.52がSICPのラスボスです。</p>\n<h4 id=\"551\" style=\"position:relative;\"><a href=\"#551\" aria-label=\"551 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5.51</h4>\n<blockquote>\n<p><strong>練習問題 5.51:</strong> 5.4節の明示制御評価器を翻訳することによって、C言語（または好きな低レベル言語）によるSchemeの基本的な実装を開発せよ。このコードを動かすためには、適切なメモリ割り当てルーチンや、その他の実行時サポートを用意する必要があるだろう。</p>\n</blockquote>\n<p>一見するとけっこうヤバいことを言っているようですが、実際ヤバいです。</p>\n<p>次のようになりました。</p>\n<ul>\n<li>データオブジェクトの表現\n<ul>\n<li>Schemeの数値：すべて浮動小数点数にする</li>\n<li>Schemeの文字列：サポートしない</li>\n<li>Schemeのシンボル：文字列</li>\n<li>Schemeのペア：ポインタ2つの構造体</li>\n</ul>\n</li>\n<li>GC：単純なmark-and-sweep</li>\n<li>パーサ：再帰下降構文解析を勘で実装</li>\n</ul>\n<p>デモのために、以下のようなSchemeの各言語機能を試す簡単なプログラムsample.rktを作成しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"scheme\"><pre class=\"language-scheme\"><code class=\"language-scheme\">#lang racket\n\n<span class=\"token comment\">; self-evaluating</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">displayln</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">; 1</span>\n\n<span class=\"token comment\">; quote</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">displayln</span> <span class=\"token symbol\">'quote_value</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">displayln</span> <span class=\"token symbol\">'2</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">; (quote quote_value)</span>\n<span class=\"token comment\">; 2</span>\n\n<span class=\"token comment\">; definition, variable assignment</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">define</span> a <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">displayln</span> a<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">set!</span> a <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token function\">displayln</span> a<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">; 3</span>\n<span class=\"token comment\">; 4</span>\n<span class=\"token comment\">; ...</span></code></pre></div>\n<p><a href=\"https://github.com/sititou70/sicp-exercises/blob/master/chapter5/section5/ex5.51/sample.rkt\">sample.rktのすべてのコード</a></p>\n<p>sample.rktは、もちろんSchemeの処理系（今回はRacketを使用）で実行できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ racket sample.rkt\n<span class=\"token number\">1</span>\nquote_value\n<span class=\"token number\">2</span>\n<span class=\"token number\">3</span>\n<span class=\"token number\">4</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>そして、今回作成したインタプリタでも実行できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> ./main sample.rkt\nmake: <span class=\"token string\">'default'</span> に対して行うべき事はありません.\n<span class=\"token number\">1.000000</span>\nquote_value\n<span class=\"token number\">2.000000</span>\n<span class=\"token number\">3.000000</span>\n<span class=\"token number\">4.000000</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>今回、CUnitによるC言語のテストを初めて書いてみたのですが、めちゃくちゃ快適でした。70件のテストに2.7秒しかかかりません。</p>\n<p>このうち3件は、1万回データオブジェクトを生成してGCを試したり、10万回の末尾呼び出しで末尾再帰をテストしたり、まったくの最適化なしで25番目のフィボナッチ数をevalするといった極端なものです。</p>\n<p>それらを除外すると、テストは0.15秒で終わります。今回の実装では、いじっているところと全く関係ない部分のテストが落ちたりしてたので、テスト全体を素早く実行できるのは大変助かりました。</p>\n<p>実装上妥協した点がいくつかあります。例えば、型情報の保持に<a href=\"https://en.wikipedia.org/wiki/Tagged_pointer\">Tagged pointer</a>を使ってみたかったのですが諦めました。私自身、CPUやメモリに詳しくないということと、変なハマり方を避けて、いったん動くところを目指したかったからです。他にも、null値が同値でなかったり、同じ文字列のシンボルなのに個別でmallocしていたりと、わかる人からすると効率の悪いところが結構あります。ゆるして……</p>\n<p>だいたい10日くらいでsample.rktが動くようになりました。</p>\n<h4 id=\"552\" style=\"position:relative;\"><a href=\"#552\" aria-label=\"552 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5.52</h4>\n<blockquote>\n<p><strong>練習問題 5.52:</strong> 練習問題 5.51と対応するものとして、コンパイラを修正してSchemeの手続きをC言語の命令列にコンパイルするようにせよ。4.1節のメタ循環評価器をコンパイルして、C言語で書かれたSchemeインタプリタを生成せよ。</p>\n</blockquote>\n<p>実は5.51の一部を流用できるため、追加の実装はそこまで多くありません。</p>\n<p>いじるのはSchemeなので、デバッグもしやすいですしね。</p>\n<p>……と思っていたのですが、ここにきて5.51側のバグがやっぱり見つかったので、けっきょくC言語の世界に<code class=\"language-text\">return</code>しました。</p>\n<p>そのバグというのがどれも結構厄介で、ちょっと考えたくらいではわからないものでした。ここでは、地道に原因を追求していくのが近道なんだなぁということを改めて学びました。</p>\n<p>例えば、上層のSchemeで「変数を定義した後、その直後は変数を参照できるが、数行以上経過するとUnboundになる」というバグがありました。普通にプログラミングしている分にはまずありえない状況なので、一周回ってウケちゃいますね。</p>\n<p>ぼく「まずは、これがコンパイラのバグなのか、レジスタマシンのバグなのかを切り分けよう……。生成されたCのコードを読んでみると、コンパイラは問題なさそうだ。じゃあレジスタマシンの基本演算の実装がおかしい？いや、SICPのをほぼそのまま移植しているので大丈夫なはず……。よくわからんから環境をユーティリティでprintデバッグしてみよう。あれ、環境をprintするとセグフォするぞ……。しかもprintしてもセグフォしない環境もある……？これはまずユーティリティのバグを直さないと……」</p>\n<p>といった感じです。結論としては、GCが微妙なタイミングで起きるとダメとか、mallocの数を±1だけ間違ってたとか、そういう細かい原因でした。</p>\n<p>そんなこんなを繰り返して3日経ったころ、ようやくサンプルコードやメタ循環評価器が動くようになりました。</p>\n<p>まず、sample.rktをコンパイルしてみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ racket compile-to-c.rkt sample.rkt <span class=\"token operator\">></span> main.c <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">wc</span> main.c\n<span class=\"token number\">1631</span>  <span class=\"token number\">2607</span> <span class=\"token number\">45829</span> main.c</code></pre></div>\n<p>コンパイルの結果、1,631行のCのコードが生成されました。これを更にコンパイルして実行してみると……</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ ./main\n<span class=\"token number\">1.000000</span>\nquote_value\n<span class=\"token number\">2.000000</span>\n<span class=\"token number\">3.000000</span>\n<span class=\"token number\">4.000000</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>確かにsample.rktが実行されました。</p>\n<p>次に、<a href=\"https://github.com/sititou70/sicp-exercises/blob/master/chapter5/section5/ex5.52/m-eval.rkt\">m-eval.rkt</a>をコンパイルしてみます。これは4章のメタ循環評価器です。</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ racket compile-to-c.rkt m-eval.rkt <span class=\"token operator\">></span> main.c <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">wc</span> main.c\n<span class=\"token number\">8334</span>  <span class=\"token number\">13665</span> <span class=\"token number\">247755</span> main.c</code></pre></div>\n<p>コンパイルの結果、8,334行のCのコードが生成されました。うおお</p>\n<p>これを更にコンパイルして、sample.rktを指定して実行してみると……</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ ./main sample.rkt\n<span class=\"token number\">1.000000</span>\nquote_value\n<span class=\"token number\">2.000000</span>\n<span class=\"token number\">3.000000</span>\n<span class=\"token number\">4.000000</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n<p>sample.rktが実行されました！</p>\n<p>ちなみに、これまでの環境でsample.rktの実行時間を比較してみます。20回の計測の平均をとりました。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">環境</th>\n<th align=\"right\">sample.rktの実行時間</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">Racket</td>\n<td align=\"right\">408.1 ms</td>\n</tr>\n<tr>\n<td align=\"left\">Cで実装したインタプリタ</td>\n<td align=\"right\">11.6 ms</td>\n</tr>\n<tr>\n<td align=\"left\">Cへのコンパイル</td>\n<td align=\"right\">8.8 ms</td>\n</tr>\n<tr>\n<td align=\"left\">メタ循環評価器をコンパイルして作成したインタプリタ</td>\n<td align=\"right\">614.6 ms</td>\n</tr>\n</tbody>\n</table>\n<p>RacketがCのインタプリタやコンパイルよりも遅いのは、標準ライブラリを読み込んでたり、いろいろ実用的な機能を備えているからだと思います。</p>\n<p>インタプリタに比べて、コンパイルすると若干早くなってますね。</p>\n<p>メタ循環評価器をコンパイルした環境はさすがに遅いです。他の環境と違って、マシン組み込みとしていた演算の一部を自分で処理しているので、メモリ使用量が多く、GCも複数回発生していました。</p>\n<h3 id=\"解釈とコンパイル\" style=\"position:relative;\"><a href=\"#%E8%A7%A3%E9%87%88%E3%81%A8%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB\" aria-label=\"解釈とコンパイル permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>解釈とコンパイル</h3>\n<p>ここまでやることで、以下の説明にだいぶ納得感が出ました。</p>\n<blockquote>\n<p>インタプリタはマシンをユーザープログラムのレベルに上げるもので、コンパイラはユーザープログラムを機械語のレベルに落とすものです。</p>\n</blockquote>\n<p>4章では、遅延評価、非決定性計算、論理プログラミングなどのいろいろなインタプリタを書いてSchemeのレベルを上げました。</p>\n<p>5章では、コンパイラによってSchemeをレジスタマシンの命令列やC言語に変換し、レベルを落としました。</p>\n<p>今まで、インタプリタとコンパイラはそれぞれ全くの別物というイメージでした。しかし、（少なくともSICPにおいては）その原理的な部分は結構似ているし、レベルを上げるものと落とすものという、対称性があることもわかりました。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>お正月からSICPを読み始め、仕事、SICP、仕事、SICP……のサイクルを回してきました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 728px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f93ae901073ed9fcd3005409e95cd21b/03eda/work-sicp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.71428571428572%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAC4jAAAuIwF4pT92AAABVElEQVR42pWTa66CQAyF2f+m+EdcAdEYBFEBAQUUeamM+ZrMBJHc5DYpDNP29PSBpRbk/X7LexzHJbO5f71ePz7W3BmnqqrMd9d1qixLo03TmIS+76ssy76S/AAS1LatnG+3m3yTBBAUwKIoBID7PM9NAgOo0YdhUNfrVc73+10A53buAUGRuq7lTvtZ015ggAFyuVy++vN8PlUYhiqKItHNZmN8NQnDEON+v5fyoN/3vWQmgD4BTl89zxNf3uv12rAE8PF4SKxFWa7riiPBCEacAHIcRx2PRzlvt1tl27ZarVYCqluCLU1TaYnFAwMgZIQdmQjWw4FtEATqfD7LVAGgfGIWS9YCGBNECIQ17GhHkiSiMDkcDnKP0Jbp8Kz5spIN1gjBu93OgMVxLMwAZEjaX58X9xCW9JTJ6/VhqoCcTiepQNsomXb8udi6jOmy/ufX+wCwQaAVM9X2SQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f93ae901073ed9fcd3005409e95cd21b/f4a91/work-sicp.webp 728w,\n/static/f93ae901073ed9fcd3005409e95cd21b/373da/work-sicp.webp 811w\"\n              sizes=\"(max-width: 728px) 100vw, 728px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f93ae901073ed9fcd3005409e95cd21b/beb58/work-sicp.png 728w,\n/static/f93ae901073ed9fcd3005409e95cd21b/03eda/work-sicp.png 811w\"\n            sizes=\"(max-width: 728px) 100vw, 728px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f93ae901073ed9fcd3005409e95cd21b/beb58/work-sicp.png\"\n            alt=\"仕事とSICPのサイクルを表す図。仕事はSICPを読むための衣食住を提供する。SICPが仕事にどう作用するかは不明\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>仕事はSICPを読むための衣食住を提供します。ではSICPが仕事にどう役立つのかというと、読んだ直後なのでまだよくわかっていません。</p>\n<p>ただ、SICPによって、今までぼやけていた部分が鮮明になった気がします。プロセスとはなにか、データとはなにかなど、そういう基礎的な部分は、仕事に限らず、今後いろいろなことを考える際に効いてくる気がしています。</p>\n<p>練習問題を（自由回答を除いて）すべて解いたのは良かったです。私は他人と比べて理解力が弱いので、問題を解くことではじめて自分の勘違いに気づけましたし、他の人の回答と比べることで理解が深まりました。</p>\n<p>SICPのすべてを理解したとは思っていないので、間違いがありましたらご指摘いただけると嬉しいです。</p>\n<p>著者、翻訳者、TeX、LaTeX周りを整備してくださった方、先人の回答、その他すべての関係者に感謝します。</p>\n<p>ここまで読んでいただきありがとうございました。</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">「前」とは小学生のころで、当時、パソコンもインターネット環境も無いが漠然とハッカーに憧れていた田舎のクソガキの私は、ジャスコ（死語）に入っていた本屋の書籍検索に「ハッカー」と打ち込み、唯一ヒットした「ハッカーと画家」を立ち読みしていました。そこでポール・グレアム氏が「<a href=\"http://practical-scheme.net/trans/hp-j.html\"> プログラミングに関して皆に一つだけ引用文句を覚えてもらえるならば</a>」としてSICPの冒頭を挙げているのを見て、「すごいハッカーが引用するくらいだから元の本もすごいんだろう」と漠然と感じた記憶を思い出しました。<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">本文における実際の<code class=\"language-text\">append</code>の実装は、これとは異なりもう少し複雑です。ここではあくまでも例であることをご了承ください<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","frontmatter":{"title":"SICPの感想文","date":"2023/07/29"},"fields":{"slug":"/SICPの感想文/"},"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a"},"firstImage":{"imageFile":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#180868","images":{"fallback":{"src":"/static/a725acd84c0cea1d01a5d87e7fbfba7e/1ac44/cover.png","srcSet":"/static/a725acd84c0cea1d01a5d87e7fbfba7e/bc36c/cover.png 100w,\n/static/a725acd84c0cea1d01a5d87e7fbfba7e/92fa2/cover.png 200w,\n/static/a725acd84c0cea1d01a5d87e7fbfba7e/1ac44/cover.png 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/a725acd84c0cea1d01a5d87e7fbfba7e/a9bd8/cover.webp 100w,\n/static/a725acd84c0cea1d01a5d87e7fbfba7e/c6b99/cover.webp 200w,\n/static/a725acd84c0cea1d01a5d87e7fbfba7e/762af/cover.webp 400w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":579}}}},"relatedMarkdownRemarks":{"posts":[{"id":"f920a8a8-f5fe-57c9-8792-95c93d2b74eb","frontmatter":{"draft":null}},{"id":"5dba01b8-593d-5295-b135-16df1c6295e5","frontmatter":{"draft":null}},{"id":"84bf9a79-dd68-55d1-a1b3-60ffd3784554","frontmatter":{"draft":null}},{"id":"3d71b3f9-8d6b-58a4-b6cb-8293daf99d74","frontmatter":{"draft":null}},{"id":"8f7b1b24-7738-5b97-bfb6-fd763f11a664","frontmatter":{"draft":true}},{"id":"e4fb8478-b1ad-59eb-95e8-8c5e0500d3f4","frontmatter":{"draft":true}},{"id":"3a3c4125-9986-53bb-8b96-ae29936c96ab","frontmatter":{"draft":null}},{"id":"29b79017-f96d-5b04-8d01-5b8ee761ebed","frontmatter":{"draft":null}},{"id":"75696ec6-74a3-5046-8a3c-f39b36d92311","frontmatter":{"draft":null}},{"id":"a6c64123-b824-5224-8027-90eb12040396","frontmatter":{"draft":null}},{"id":"50d3cc2a-de7a-5b9a-a8d8-754415fe4d94","frontmatter":{"draft":null}},{"id":"c5e2431a-cf05-5024-b833-e1c69f680d44","frontmatter":{"draft":null}},{"id":"73ab4455-f04d-5320-bf3a-90b9f7441d13","frontmatter":{"draft":null}},{"id":"fc7ce496-d3b3-5f39-a04e-8e2dfb960626","frontmatter":{"draft":null}},{"id":"0116f663-28d1-507a-b5ab-b189801dd408","frontmatter":{"draft":true}},{"id":"01deffb8-0d62-54c6-9e41-20832cbc3c6e","frontmatter":{"draft":null}},{"id":"067a602f-4581-5707-b896-73190dd8c889","frontmatter":{"draft":null}},{"id":"0bc9da5c-36cb-5e74-8b2f-bf514edbb710","frontmatter":{"draft":null}},{"id":"0c5568c9-6d87-56ed-ab0e-caeb9c1aafa4","frontmatter":{"draft":null}},{"id":"1086a735-7173-58cc-a813-c540a563aedf","frontmatter":{"draft":false}},{"id":"1162dccb-e1bf-576d-a5c6-0993394feb0a","frontmatter":{"draft":true}},{"id":"12222bfa-2e8e-51ee-99d8-8a19902351f5","frontmatter":{"draft":null}},{"id":"1509de3c-7308-5e40-a885-f5ebdb089774","frontmatter":{"draft":null}},{"id":"27f10a38-0ecb-539f-a717-7e40a41bbd10","frontmatter":{"draft":null}},{"id":"2cfd9e33-b4e1-53e4-884d-d8a6760f3387","frontmatter":{"draft":true}},{"id":"2f30c3f1-0d66-590b-8dba-7836df701d46","frontmatter":{"draft":null}},{"id":"3908aafc-c8d3-5c67-821f-0866592449f2","frontmatter":{"draft":true}},{"id":"3b696b96-130d-50de-a673-dc1367f32387","frontmatter":{"draft":null}},{"id":"46a22c41-5455-557c-85d4-973a6e2220ee","frontmatter":{"draft":null}},{"id":"48c65a15-67ca-57d0-9edc-ebcb868f7ad2","frontmatter":{"draft":true}},{"id":"49cf25c1-03f6-575e-8c2f-638ccd6198ea","frontmatter":{"draft":null}},{"id":"4d43646f-8aa6-52b6-b0b6-5160f0be2b05","frontmatter":{"draft":null}},{"id":"4ed3b747-2001-54f4-9661-3acab89ce275","frontmatter":{"draft":null}},{"id":"4edc1b46-b395-5783-af6a-818b8fc9c2dc","frontmatter":{"draft":null}},{"id":"4efc4f86-56aa-5ff4-8994-3946583906ad","frontmatter":{"draft":null}},{"id":"5010f43b-fdb5-5b2b-8f0c-3b7434219588","frontmatter":{"draft":null}},{"id":"50951bb1-eb92-5663-a3d8-8f35f73a1322","frontmatter":{"draft":null}},{"id":"5888c50d-8414-5e8f-b0dc-28a31b29053d","frontmatter":{"draft":null}},{"id":"63f3c7ad-6c59-52b5-9816-78fd348955ff","frontmatter":{"draft":true}},{"id":"69a4aa90-b728-522c-b34f-abee49825c45","frontmatter":{"draft":true}},{"id":"6b318bb6-2c5f-5f38-93c7-5ed1cca1fff8","frontmatter":{"draft":null}},{"id":"73d6ab42-b3e6-5663-a175-b1f3d69c29e1","frontmatter":{"draft":null}},{"id":"75550af2-8134-5467-a07d-abbb5a4f6b7c","frontmatter":{"draft":true}},{"id":"7778d041-a5bf-536a-a36f-c0dbc5e08ac7","frontmatter":{"draft":true}},{"id":"78349b16-6e41-5fef-ae38-bcdc5ff297ef","frontmatter":{"draft":true}},{"id":"7a8fc278-a847-5b68-8b74-a83193ba3f55","frontmatter":{"draft":null}},{"id":"7d6499d9-277c-5f07-b8b1-98ae40c50c42","frontmatter":{"draft":true}},{"id":"7d79eb4b-cd4a-5621-a67a-91d9a24dce05","frontmatter":{"draft":null}},{"id":"82d43655-ea2a-52cd-97a3-16b7b28ad150","frontmatter":{"draft":null}},{"id":"871ac696-39ea-5c64-94f3-5dc4b73b5770","frontmatter":{"draft":true}},{"id":"89ddbcc0-ed71-5a69-9d55-9677eab3e6cf","frontmatter":{"draft":null}},{"id":"8b3e46c2-1a1e-5af0-8900-7972c7285d15","frontmatter":{"draft":null}},{"id":"961ec1e6-3f2b-59d9-a33f-dad76cf67f47","frontmatter":{"draft":null}},{"id":"97f01467-e3a1-58e1-b2a4-db77354cc1a3","frontmatter":{"draft":null}},{"id":"9f02de74-61a0-5daf-a048-1c1022e08fe4","frontmatter":{"draft":null}},{"id":"9f24363b-ee3e-54bf-8a18-46ea3b269bea","frontmatter":{"draft":null}},{"id":"a091877c-69b8-59f9-8963-1af334fd573c","frontmatter":{"draft":null}},{"id":"a190aac4-0483-5e02-b1d3-261f3b5f313a","frontmatter":{"draft":null}},{"id":"b4251348-b618-5b5b-a2c8-e4c6b2431b83","frontmatter":{"draft":true}},{"id":"be594923-185e-5cca-95b6-5267b3c9fc8c","frontmatter":{"draft":null}},{"id":"bfee69af-7d7f-5d87-9680-d2e9b60f8416","frontmatter":{"draft":null}},{"id":"c2249b7b-b97e-5cf4-8ea9-8024e96851b7","frontmatter":{"draft":true}},{"id":"c2db052c-95c6-5094-935b-9eb39f5c762a","frontmatter":{"draft":null}},{"id":"c6def021-b8da-5dbe-ad3e-811d9286424d","frontmatter":{"draft":true}},{"id":"c7a5adfb-149b-5469-ba35-7421e2101951","frontmatter":{"draft":null}},{"id":"cbdf3192-973c-5d87-9cf1-bb9110e9a169","frontmatter":{"draft":null}},{"id":"d29b4513-0609-5cfc-af49-817467dbed1f","frontmatter":{"draft":null}},{"id":"d4d1afa4-f2f9-5942-ae36-2826fb938af5","frontmatter":{"draft":null}},{"id":"db26c6b9-37b4-5cc4-b1ec-c61dc667863e","frontmatter":{"draft":null}},{"id":"dd0c41cf-0a03-5b89-b5a2-f64859aeae63","frontmatter":{"draft":null}},{"id":"e322eac2-bd89-5347-b20d-d050d303a6be","frontmatter":{"draft":null}},{"id":"e376b2d4-df91-5b82-af7a-a8d02763e922","frontmatter":{"draft":true}},{"id":"e83330dc-2312-5ae6-95fa-53e86909f42b","frontmatter":{"draft":true}},{"id":"eba9aa6a-6e21-5f1b-a0eb-7b6bfb1e04f1","frontmatter":{"draft":null}},{"id":"ebae7878-c4ee-505e-81e2-3d3fc47ea826","frontmatter":{"draft":true}},{"id":"ed7af7f9-75f5-59be-9063-de564576eed7","frontmatter":{"draft":true}},{"id":"f06a6ae0-e961-504c-8dab-a60489c0557a","frontmatter":{"draft":true}},{"id":"f49ce388-e81c-5425-af59-9902f125c20f","frontmatter":{"draft":null}},{"id":"f5a25ce1-67a6-51b2-9bf1-f9fbacb41ad1","frontmatter":{"draft":true}},{"id":"fd6eab68-17d3-5395-8b2b-54a6efe43ebb","frontmatter":{"draft":null}}]}},"pageContext":{"id":"3c14921d-1ba3-5a7a-93a2-757f3a03ee3a"}},"staticQueryHashes":["1800451590","2576926420","63159454"],"slicesMap":{}}